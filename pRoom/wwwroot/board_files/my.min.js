var AJson,Color,classes,DrawLine,DrawFreehand,DrawObject,DrawText,MyMath,Unicode,DrawImage,DrawRectangle,Geometry,ImageLoader,ref,Layer,BoardLayer,BoardGroupedLayer,extend,hasProp,slice,indexOf,ConvCall,ConvPeerConnection,idroo,ui,boardName;this.Fonts=function(){function f(){}var o,t,e,i,r,n,s,u,h,c;for(i=["Open Sans","Quando","Handlee","Julee","Lemon","Inconsolata","Alegreya SC"],n={},r=function(t){null==n[t]&&(n[t]={loaded:!1,listeners:[]})},e=function(t){var i,u,f,r;for(n[t].loaded=!0,r=n[t].listeners,i=0,u=r.length;u>i;i++)(f=r[i])()},c=function(n){return WebFont.load({google:{families:[n]},fontloading:r,fontactive:e})},WebFont.load({google:{families:i},custom:{families:["IDroo Math"]},fontloading:r,fontactive:e}),s=$("#fonts-list"),u=0,h=i.length;h>u;u++)t=i[u],s.append($("<div>",{"class":"button",css:{fontFamily:t},text:t,data:{value:t}}));return f.afterLoaded=o=function(t,i){var u;return n[t]||r(t),u=n[t],u.loaded?i():void u.listeners.push(i)},f.unlessLoaded=function(t,i){var r;if(null!=(r=n[t])?!r.loaded:!0)return o(t,i)},f}(),function(){function n(n){"use strict";var i={fill:0},u=function(n){return n+1+(56>n%64?56:120)-n%64+8},s=function(n,t){for(var i=t>>2;i<n.length;i++)n[i]=0},h=function(n,t){n[t>>2]|=128<<24-(t%4<<3);n[((t>>2)+2&-16)+15]=t<<3},c=function(n,t,i){for(var r=0;i>r;r=r+4|0)t[r>>2]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3)},r=function(n,t,i){for(var f=i%4,u=i-f,r=0;u>r;r=r+4|0)t[r>>2]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3];switch(f){case 0:t[u>>2]|=n[u+3];case 3:t[u>>2]|=n[u+2]<<8;case 2:t[u>>2]|=n[u+1]<<16;case 1:t[u>>2]|=n[u]<<24}},l=function(n,t,i){if("string"==typeof n)return c(n,t,i);if(n instanceof Array||"undefined"!=typeof global&&"undefined"!=typeof global.Buffer&&n instanceof global.Buffer)return r(n,t,i);if(n instanceof ArrayBuffer)return r(new Uint8Array(n),t,i);if(n.buffer instanceof ArrayBuffer)return r(new Uint8Array(n.buffer),t,i);throw new Error("Unsupported data type.");},a=function(n){for(var t,i="0123456789abcdef",u=[],r=0;r<n.length;r++)t=n[r],u[r]=i.charAt(t>>28&15)+i.charAt(t>>24&15)+i.charAt(t>>20&15)+i.charAt(t>>16&15)+i.charAt(t>>12&15)+i.charAt(t>>8&15)+i.charAt(t>>4&15)+i.charAt(t>>0&15);return u.join("")},v=function(n){for(var t=1;n>t;)t<<=1;return t},f=function(n){i.sizeHint=n;i.heap=new ArrayBuffer(v(u(n)+320));i.core=t({Int32Array:Int32Array},{},i.heap)},e,o;f(n||0);e=function(n){var t=new Int32Array(i.heap,n<<2,5);t[0]=1732584193;t[1]=-271733879;t[2]=-1732584194;t[3]=271733878;t[4]=-1009589776;i.core.hash(n)};o=this.rawDigest=function(n){var t=n.byteLength||n.length,r;return t>i.sizeHint&&f(t),r=new Int32Array(i.heap,0,u(t)>>2),s(r,t),l(n,r,t),h(r,t),e(r.length),new Int32Array(i.heap,0,5)};this.digest=this.digestFromString=this.digestFromBuffer=this.digestFromArrayBuffer=function(n){return a(o(n))}}function t(n,t,i){"use asm";function u(n){n=n|0;var c=0,t=0,u=0,l=0,i=0,a=0,f=0,v=0,e=0,y=0,o=0,p=0,h=0,s=0;for(u=r[n+0<<2>>2]|0,i=r[n+1<<2>>2]|0,f=r[n+2<<2>>2]|0,e=r[n+3<<2>>2]|0,o=r[n+4<<2>>2]|0,c=0;(c|0)<(n|0);c=c+16|0){for(l=u,a=i,v=f,y=e,p=o,t=0;(t|0)<16;t=t+1|0)s=r[c+t<<2>>2]|0,h=((u<<5|u>>>27)+(i&f|~i&e)|0)+((s+o|0)+1518500249|0)|0,o=e,e=f,f=i<<30|i>>>2,i=u,u=h,r[n+t<<2>>2]=s;for(t=n+16|0;(t|0)<(n+20|0);t=t+1|0)s=(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])<<1|(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])>>>31,h=((u<<5|u>>>27)+(i&f|~i&e)|0)+((s+o|0)+1518500249|0)|0,o=e,e=f,f=i<<30|i>>>2,i=u,u=h,r[t<<2>>2]=s;for(t=n+20|0;(t|0)<(n+40|0);t=t+1|0)s=(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])<<1|(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])>>>31,h=((u<<5|u>>>27)+(i^f^e)|0)+((s+o|0)+1859775393|0)|0,o=e,e=f,f=i<<30|i>>>2,i=u,u=h,r[t<<2>>2]=s;for(t=n+40|0;(t|0)<(n+60|0);t=t+1|0)s=(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])<<1|(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])>>>31,h=((u<<5|u>>>27)+(i&f|i&e|f&e)|0)+((s+o|0)-1894007588|0)|0,o=e,e=f,f=i<<30|i>>>2,i=u,u=h,r[t<<2>>2]=s;for(t=n+60|0;(t|0)<(n+80|0);t=t+1|0)s=(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])<<1|(r[t-3<<2>>2]^r[t-8<<2>>2]^r[t-14<<2>>2]^r[t-16<<2>>2])>>>31,h=((u<<5|u>>>27)+(i^f^e)|0)+((s+o|0)-899497514|0)|0,o=e,e=f,f=i<<30|i>>>2,i=u,u=h,r[t<<2>>2]=s;u=u+l|0;i=i+a|0;f=f+v|0;e=e+y|0;o=o+p|0}r[0]=u;r[1]=i;r[2]=f;r[3]=e;r[4]=o}var r=new n.Int32Array(i);return{hash:u}}if("undefined"!=typeof module&&(module.exports=n),"undefined"!=typeof window&&(window.Rusha=n),"undefined"!=typeof FileReaderSync){var i=new FileReaderSync,r=new n(4194304);self.onmessage=function(n){var u,t=n.data.data;if(t instanceof Blob)try{t=i.readAsBinaryString(t)}catch(f){return void self.postMessage({id:n.data.id,error:f.name})}u=r.digest(t);self.postMessage({id:n.data.id,hash:u})}}}();Array.prototype.filter||(Array.prototype.filter=function(n){var i,t,r,e,u,f;for(u=this,f=[],t=r=0,e=u.length;e>r;t=++r)i=u[t],n(i,t,this)&&f.push(i);return f});Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){var i,r,f,u;for(null==t&&(t=0),i=r=f=0>t?this.length+t:t,u=this.length;u>=r;i=r+=1)if(this[i]===n)return i;return-1});Array.prototype.remove=function(n,t){var i;return i=this.slice((t||n)+1||this.length),this.length=0>n?this.length+n:n,this.push.apply(this,i)};Array.prototype.removeItem=function(n){for(var t=0;(t=this.indexOf(n,t))>=0;)this.remove(t);return this};Array.prototype.removeItems=function(n){for(var i,t=0,r=n.length;r>t;t++)i=n[t],this.removeItem(i);return this},function(){var v,s,u,f,h,e,i,t,r,o,c,n,l,a;for(e="native",i=Date.now||function(){return(new Date).getTime()},n=window.requestAnimationFrame,o=["webkit","moz","o","ms"],u=0,h=o.length;h>u;u++)a=o[u],null==n&&(n=window[a+"RequestAnimationFrame"]);return null==n&&(e="timer",f=0,r=0,t=l=null,n=function(n){var u,e;return null!=t?(t[++r]=n,r):(e=i(),u=Math.max(0,16.66-(e-f)),t={},t[++r]=n,f=e+u,l=setTimeout(s,u),r)},v=function(n){delete t[n]},s=function(){var r,i,n;n=t;t=null;for(i in n)(r=n[i])(f)}),n(function(t){var r,u;1e12>t?null!=(null!=(u=window.performance)?u.now:void 0)?(n.now=function(){return window.performance.now()},n.method="native-highres"):(r=i()-t,n.now=function(){return i()-r},n.method="native-highres-noperf"):n.now=i}),n.now=null!=(null!=(c=window.performance)?c.now:void 0)?function(){return window.performance.now()}:i,n.method=e,window.requestAnimationFrame=n}();("undefined"!=typeof window&&null!==window?window:module.exports).MyMath=MyMath={POW10:[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10],limit:function(n,t,i){return n>i?n:i>t?t:i},minmax:function(n,t){return n>t?[t,n]:[n,t]},round:function(n){return Math.round(n)},round1:function(n){return Math.round(10*n)/10},round2:function(n){return Math.round(100*n)/100},roundN:function(n,t){var i;return i=MyMath.POW10[t],Math.round(n*i)/i}};hasProp={}.hasOwnProperty;"undefined"!=typeof MyMath&&null!==MyMath||(MyMath=require("./mymath").MyMath);("undefined"!=typeof window&&null!==window?window:module.exports).AJson=AJson=function(){function l(){}var i,u,s,b,a,f,n,v,h,k,d,g,t,e,y,p,w,nt,r,c,o;return f="",e=0,r={},c=0,i={},u=0,y=function(){return f="",e=0,r={},c=0,i={},u=0},g=Object.prototype.toString,v=function(n){return"[object Array]"===g.apply(n)},h=function(n){return e+=n,f.substr(e-n,n)},k=function(){return p(f[e++])},d=function(n){var r,t,u,i;for(i=[],r=t=1,u=n;u>=t;r=t+=1)i.push(p(f[e++]));return i},s=function(n){return 12===n?n=99:57===n?n=100:n+=35,String.fromCharCode(n)},b=function(n){var r,t,u,i;for(i=[],t=0,u=n.length;u>t;t++)r=n[t],i.push(s(r));return i.join("")},p=function(n){var t;return t=n.charCodeAt(0),99>t?t-35:99===t?12:57},n=function(n){var t,i,u,r;if(~~(t=n)===t){if(t>=0&&9>=t)return t.toString();t>0&&(t-=10);i=0}else~~(t*=10)===t?i=6:(t*=10,i=12);for(0>t&&(t=-t,i+=32),t=~~(t+.5),u=0,r=[s(63&t)];0<(t>>=6);)u++,r.unshift(s(63&t));return r.unshift(String.fromCharCode(u+65+i)),r.join("")},nt=function(n){var t,e,u,r,f,o,i;for(t=-65+n.charCodeAt(0),(f=t>31)&&(t-=32),r=1,t>11?r=100:t>5&&(r=10),t%=6,i=0,e=u=0,o=t;o>=u;e=u+=1)i<<=6,i+=k();return f||1!==r||(i+=10),i/=r,f?-i:i},a=function(n,t,i){var s,e,l,r,u,h,c,o,f,a,v;for(s=[],h=6*i-t-1,c=(1<<h)-1,u=c>>1,a=23===t?Math.pow(2,-24)-Math.pow(2,-77):0,o=0,l=1,v=0>n||0===n&&0>1/n?1:0,n=Math.abs(n),isNaN(n)||Infinity===n?(f=isNaN(n)?1:0,r=c):(r=Math.floor(Math.log(n)/Math.LN2),n*(e=Math.pow(2,-r))<1&&(r--,e*=2),n+=r+u>=1?a/e:a*Math.pow(2,1-u),n*e>=2&&(r++,e/=2),r+u>=c?(f=0,r=c):r+u>=1?(f=(n*e-1)*Math.pow(2,t),r+=u):(f=n*Math.pow(2,u-1)*Math.pow(2,t),r=0));t>=6;)s[o]=63&f,o+=l,f/=64,t-=6;for(r=r<<t|f,h+=t;h>0;)s[o]=63&r,o+=l,r/=64,h-=6;return s[o-l]|=32*v,b(s)},w=function(n,t){var o,s,r,h,c,l,u,f,i,e;for(o=d(t),c=6*t-n-1,l=(1<<c)-1,h=l>>1,i=-5,u=t-1,s=-1,e=o[u],u+=s,r=e&(1<<-i)-1,e>>=-i,i+=c;i>0;)r=64*r+o[u],u+=s,i-=6;for(f=r&(1<<-i)-1,r>>=-i,i+=n;i>0;)f=64*f+o[u],u+=s,i-=6;if(0===r)r=1-h;else{if(r===l)return f?NaN:Infinity*(e?-1:1);f+=Math.pow(2,n);r-=h}return(e?-1:1)*f*Math.pow(2,r-n)},l.stringify=function(n){var t;return t=o(n),y(),t},o=function(t){var ht,ct,p,h,s,l,w,b,k,d,lt,at,vt,yt,pt,it,rt,e,ut,g,nt,y,f,tt,wt,ft,et,ot,st;switch(typeof t){case"string":return t in r?"@"+n(r[t]):(d=t.length,d>3&&(r[t]=c++),d?1===d?"="+t:"$"+n(t.length)+t:"_");case"number":return(0|t)===t||MyMath.round2(t)===t?n(t):t.toExponential().replace(/^[0.]+|\.|e.*$/g,"").length<6&&!isNaN(t)?":"+a(t,23,5):";"+a(t,52,11);case"boolean":return t?"+":"-";case"undefined":return"?";case"null":return"!";case"object":if(!t)return"!";if(f=[],v(t)){if(0===t.length)return"["+n(0);if(2===t.length){if("number"==typeof t[0]&&"number"==typeof t[1]){if(~~t[0]===t[0]&&~~t[1]===t[1]||MyMath.round2(t[0])===t[0]&&MyMath.round2(t[1])===t[1])return"."+n(t[0])+n(t[1]);if(~~(ht=100*t[0])===ht&&~~(ct=100*t[1])===ct)return","+n(100*t[0])+n(100*t[1])}}else if(t.length>2){for(s=!0,h=!0,l=!0,w=0,lt=t.length;lt>w&&(e=t[w],s&&(v(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]?~~e[0]===e[0]&&~~e[1]===e[1]||MyMath.round2(e[0])===e[0]&&MyMath.round2(e[1])===e[1]||(s=!1):s=!1),h&&("number"==typeof e&&MyMath.round2(e)===e||(h=!1)),l&&"number"!=(y=typeof e)&&"string"!==y&&"boolean"!==y&&"undefined"!==y&&"null"!==y&&(l=!1),h||s||l);w++);if(h){for(ut=0,k=0,at=t.length;at>k;k++)rt=t[k],f.push(n(rt-ut+5)),ut=rt;return f="#"+n(t.length)+f.join(""),f in i?"]"+n(i[f]):(i[f]=u++,f)}if(s){for(ft=ot=0,f.push("*"),f.push(n(t.length)),g=0,vt=t.length;vt>g;g++)e=t[g],et=e[0],st=e[1],f.push(n(et-ft)),f.push(n(st-ot)),ft=et,ot=st;return f.join("")}if(l){for(nt=0,yt=t.length;yt>nt;nt++)p=t[nt],f.push(o(p));return f="["+n(t.length)+f.join(""),f in i?"]"+n(i[f]):(i[f]=u++,f)}}for(tt=0,pt=t.length;pt>tt;tt++)p=t[tt],f.push(o(p));return"["+n(t.length)+f.join("")}it=0;for(b in t)hasProp.call(t,b)&&(wt=t[b],f.push(o(b)),f.push(o(wt)),it++);return f.unshift(n(it)),f.unshift("{"),f.join("")}},l.parse=function(n){var i;return f=n,i=t(),y(),i},t=function(){var f,e,y,p,b,s,g,k,d,tt,l,it,rt,ut,n,v,a,o,ft,et;if(a=h(1),isNaN(f=a.charCodeAt(0)))return null;if(f>=48&&57>=f)return f-48;if(f>=65&&83>f||f>=97&&115>f)return nt(a);switch(a){case"?":return;case"!":return null;case"+":return!0;case"-":return!1;case":":return o=w(23,5),MyMath.roundN(o,6-(~~Math.abs(o)).toString().length);case";":return w(52,11);case"[":for(n=[],v=!0,e=y=1,tt=t();tt>=y;e=y+=1)n.push(o=t()),v&&"number"!=(l=typeof o)&&"string"!==l&&"boolean"!==l&&"undefined"!==l&&"null"!==l&&(v=!1);return v&&n.length>2&&(i[u++]=n.slice()),n;case"#":for(g=0,n=[],e=p=1,it=t();it>=p;e=p+=1)n.push(MyMath.round2(g+=t()-5));return i[u++]=n.slice(),n;case"*":for(s=[0,0],n=[],e=k=1,rt=t();rt>=k;e=k+=1)ft=s[0]+t(),et=s[1]+t(),s=[MyMath.round2(ft),MyMath.round2(et)],n.push(s);return n;case"]":return i[t()].slice();case".":return[t(),t()];case",":return[t()/100,t()/100];case"{":for(n={},e=d=1,ut=t();ut>=d;e=d+=1)n[t()]=t();return n;case"_":return"";case"=":return h(1);case"$":return b=t(),o=h(b),b>3&&(r[c++]=o),o;case"@":return r[t()];default:throw"Unknown type: "+a;}},l}();slice=[].slice;MyMath=(classes="undefined"!=typeof window&&null!==window?window:require("./classes/classes")).MyMath;("undefined"!=typeof window&&null!==window?window:module.exports).Geometry=Geometry=function(){function n(){}var v,d,et,h,o,ot,g,nt,st,ht,ct,c,lt,at,vt,i,oi,yt,pt,wt,tt,bt,kt,dt,gt,ni,si,hi,ci,li,t,y,p,it,ti,ai,vi,l,yi,pi,wi,bi,ii,ki,ri,di,gi,nr,w,ui,tr,fi,ir,ei,rr,ur,b,fr,er,or,a,r,f,rt,ut,k,e,s,ft,u;return ot=function(n){var t;return(t=1-n)*t*t},g=function(n){var t;return 3*n*(t=1-n)*t},nt=function(n){return 3*n*n*(1-n)},st=function(n){return n*n*n},i=function(n,t,i,r){var u,f;return u=i-n,f=r-t,u*u+f*f},n.v2Negate=ut=function(n){return[-n[0],-n[1]]},n.v2Add=r=function(n,t){return[n[0]+t[0],n[1]+t[1]]},n.v2Sub=u=function(n,t){return[n[0]-t[0],n[1]-t[1]]},n.v2Dot=f=function(n,t){return n[0]*t[0]+n[1]*t[1]},n.v2ScaleII=s=function(n,t){return[n[0]*t,n[1]*t]},n.v2SquaredLength=ft=function(n){return n[0]*n[0]+n[1]*n[1]},n.v2Length=rt=function(n){return Math.sqrt(ft(n))},n.v2Scale=e=function(n,t){var i,r;return r=rt(n),i=r?t/r:1,[n[0]*i,n[1]*i]},n.v2Normalize=k=function(n){var t;return(t=rt(n))?[n[0]/t,n[1]/t]:[1,0]},n.isLeft=ai=function(n,t,i){return(t[0]-n[0])*(i[1]-n[1])-(t[1]-n[1])*(i[0]-n[0])>0},n.translateMatrix=a=function(n,t){return[1,0,0,1,n,t]},n.scaleMatrix=ei=function(n,t){return[n,0,0,t,0,0]},n.rotateMatrix=fi=function(n){var t,i;return[t=Math.cos(n),i=Math.sin(n),-i,t,0,0]},n.skewXMatrix=rr=function(n){return[1,0,Math.tan(n),1,0,0]},n.skewYMatrix=ur=function(n){return[1,Math.tan(n),0,1,0,0]},n.transform=b=function(){var i,r,y,u,f,p,o,s,h,c,l,a,w,n,e,t,v;for(n=arguments[0],v=2<=arguments.length?slice.call(arguments,1):[],e=0,w=v.length;w>e;e++)t=v[e],o=t[0],c=t[1],s=t[2],l=t[3],h=t[4],a=t[5],i=n[0],u=n[1],r=n[2],f=n[3],y=n[4],p=n[5],n=[i*o+r*c,u*o+f*c,i*s+r*l,u*s+f*l,h*i+y+r*a,h*u+p+f*a];return n},n.inverseMatrix=ti=function(n){var i,r,e,u,f,o,t;return i=n[0],u=n[1],r=n[2],f=n[3],e=n[4],o=n[5],t=1/(i*f-r*u),[t*f,t*-u,t*-r,t*i,t*(r*o-e*f),t*(e*u-i*o)]},n.scaleFromToMatrix=ir=function(n,t){var i,r,e,c,o,l,v,y,u,f,s,p,h,w;return e=n[0],o=n[1],c=n[2],l=n[3],s=t[0],h=t[1],p=t[2],w=t[3],i=MyMath.round2(c-e),r=MyMath.round2(l-o),u=MyMath.round2(p-s),f=MyMath.round2(w-h),.01>Math.abs(i)&&(i=1),.01>Math.abs(r)&&(r=1),.01>Math.abs(u)&&(u=1),.01>Math.abs(f)&&(f=1),v=u/i,y=f/r,b(a(s,h),ei(v,y),a(-e,-o))},n.rotateFromToMatrix=tr=function(n,t,i){var r,u;return r=n[0],u=n[1],b(a(r,u),fi(ht(n,t,i)),a(-r,-u))},n.transformFromToMatrix=fr=function(n,t,i,r,u,f){var c,l,a,v,e,y,p,o,w,k,s,d,g,h;return w=n[0],d=n[1],k=t[0],g=t[1],s=i[0],h=i[1],a=r[0],y=r[1],v=u[0],p=u[1],e=f[0],o=f[1],c=[a-e,y-o,v-e,p-o,e,o],l=[w-s,d-h,k-s,g-h,s,h],b(c,ti(l))},n.transformPoints=or=function(n,t){var o,s,h,c,l,a,v,i,r,u,f,e;for(o=t[0],c=t[1],s=t[2],l=t[3],h=t[4],a=t[5],u=[],i=0,v=n.length;v>i;i++)r=n[i],f=r[0],e=r[1],u.push([MyMath.roundN(h+o*f+s*e,5),MyMath.roundN(a+c*f+l*e,5)]);return u},n.transformPoint=er=function(n,t){var u,f,e,o,s,h,i,r;return i=n[0],r=n[1],u=t[0],o=t[1],f=t[2],s=t[3],e=t[4],h=t[5],[MyMath.roundN(e+u*i+f*r,5),MyMath.roundN(h+o*i+s*r,5)]},n.distanceFromPoint=t=function(n,t){var i,r;return i=t[0]-n[0],r=t[1]-n[1],Math.sqrt(i*i+r*r)},n.distanceFromLine=li=function(n,i,r,u){var f,e,s,o;if(f=r[0]-i[0],e=r[1]-i[1],s=f*f+e*e,!s)return t(n,i);if(o=((n[0]-i[0])*f+(n[1]-i[1])*e)/s,!u){if(0>o)return t(n,i);if(o>1)return t(n,r)}return t(n,[i[0]+o*f,i[1]+o*e])},n.nearestPointOnLine=ki=function(n,t,i){var r,u,e,f;return r=i[0]-t[0],u=i[1]-t[1],(e=r*r+u*u)?(f=((n[0]-t[0])*r+(n[1]-t[1])*u)/e,[t[0]+f*r,t[1]+f*u]):t},n.directionalDistance=si=function(n,t,i){var f,e,r,u,o,s;return r=i[0]-t[0],u=i[1]-t[1],o=r*r+u*u,f=n[0]-t[0],e=n[1]-t[1],o?(s=(f*r+e*u)/o-1,[s*r,s*u]):[f,e]},n.distanceFromEllipse=ci=function(n,t,i){var wt,a,k,d,v,bt,u,g,et,b,kt,dt,nt,ei,gt,oi,ot,st,y,ni,si,hi,ht,ct,ti,s,ii,yi,lt,ci,ri,r,ui,h,p,tt,e,at,vt,yt,fi,it,rt,li,ut,pt,w,f,c,l,ai,vi,o,ft;if(h=1/3,ht=.01,ai=n[0],vi=n[1],e=Math.abs(ai-(t[0]+i[0])/2),o=Math.abs(vi-(t[1]+i[1])/2),hi=Math.abs(t[0]-i[0]),si=Math.abs(t[1]-i[1]),v=hi/2,et=si/2+.0001,ct=1-et/v,ni=ct*(2-ct),Math.max(e,o)<2&&Math.min(v,et)>3)return-Math.min(v,et);if(ft=o*o,at=e*e,ti=1-ct,s=ti*ti,bt=v*v,ii=s*(at-bt),yi=ii-ft,lt=ii+ft,y=Math.sqrt(at+ft),ri=0>=lt,nt=e/y,rt=o/y,ut=o/(e+y),ei=nt*nt,li=rt*rt,d=s*ei+li,u=s*e*nt+o*rt,b=s*(at-bt)+ft,g=u*u,r=b/(u+Math.sqrt(g-d*b)),p=Math.atan2(o-r*rt,s*(e-r*nt)),ht>y)return Math.min(d,u);if(ht*y>Math.abs(r))return r;for(ci=ui=0;50>=ui;ci=++ui){if(d=lt+s*(2*e+r)*r,u=-4*r*o/d,b=2*(lt+(1+ni)*r*r)/d,gt=u,u+=ut,b+=ut,gt+=ut,g=u*u,a=(3*b-g)/9,k=(u*(9*b-2*g)-27*gt)/54,wt=a*a*a+k*k,wt>=0?(fi=Math.sqrt(wt),vt=k-fi,yt=k+fi,f=(yt>0?Math.pow(yt,h):-Math.pow(-yt,h))+(vt>0?Math.pow(vt,h):-Math.pow(-vt,h))-u*h,c=f*f,l=3+c,w=Math.atan2(o*l-2*r*f,s*(e*l-r*(1-c)))):(a=-a,tt=Math.sqrt(a),pt=Math.acos(k/(a*tt)),f=2*tt*Math.cos(pt*h)-u*h,c=f*f,l=3+c,w=Math.atan2(o*l-2*r*f,s*(e*l-r*(1-c))),0>w*p&&(f=2*tt*Math.cos((pt+2*Math.PI)*h)-u*h,c=f*f,l=3+c,w=Math.atan2(o*l-2*r*f,s*(e*l-r*(1-c))),0>w*p&&(f=2*tt*Math.cos((pt+4*Math.PI)*h)-u*h,c=f*f,l=3+c,w=Math.atan2(o*l-2*r*f,s*(e*l-r*(1-c)))))),oi=Math.abs(.5*(w-p)),p=.5*(p+w),kt=Math.cos(p),it=Math.sin(p),dt=Math.sqrt(1-ni*it*it),ht>oi)return e*kt+o*it-v*dt;u=v/dt;ot=e-kt*u;st=o-it*u*s;r=Math.sqrt(ot*ot+st*st);ri&&(r=-r);ut=st/(r+ot)}return ri?-y:y},n.distanceFromBezier=hi=function(n,i){return t(n,ii(n,i))},ii=function(n,i){var r,u,h,e,f,o,c,s,l;for(l=gt(n,i),r=i[0],u=t(n,r),s=y(l,0),f=0,h=s.length;h>f;f++)c=s[f],o=ct(i,c),e=t(n,o),u>e&&(u=e,r=o);return u>t(n,i[3])&&(r=i[3]),r},gt=function(n,t){var c,l,e,a,i,v,o,y,r,p,w,g,b,k,rt,nt,h,tt,d,it;for(c=[],a=[[],[],[]],l=[[],[],[]],it=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],d=[[0,0],[.2,0],[.4,0],[.6,0],[.8,0],[1,0]],i=k=0;3>=k;i=++k)c[i]=u(t[i],n);for(i=v=0;2>=v;i=++v)a[i]=s(u(t[i+1],t[i]),3);for(h=y=0;2>=y;h=++y)for(e=p=0;3>=p;e=++p)l[h][e]=f(a[h],c[e]);for(r=w=0;5>=w;r=++w)for(g=Math.max(0,r-2),tt=Math.min(r,3),i=b=rt=g,nt=tt;nt>=b;i=b+=1)o=r-i,d[i+o][1]+=l[o][i]*it[o][i];return d},y=function(n,t){var i,u,r;switch(ni(n)){case 0:return[];case 1:if(t>15)return[(n[0][0]+n[5][0])/2];if(dt(n))return[kt(n)]}return u=lt(n,.5),i=u[0],r=u[1],i=y(i,t+1),r=y(r,t+1),i.concat(r)},ct=function(n,t){for(var f,r,e,o,u=[n,[[],[],[]],[[],[]],[[]]],i=e=1;3>=e;i=++e)for(r=f=0,o=3-i;o>=f;r=f+=1)u[i][r][0]=(1-t)*u[i-1][r][0]+t*u[i-1][r+1][0],u[i][r][1]=(1-t)*u[i-1][r][1]+t*u[i-1][r+1][1];return u[3][0]},lt=function(n,t){for(var f,u,e,o,s,h,l,c,r=[n,[[],[],[],[],[]],[[],[],[],[]],[[],[],[]],[[],[]],[[]]],i=h=1;5>=h;i=++h)for(u=f=0,l=5-i;l>=f;u=f+=1)r[i][u][0]=(1-t)*r[i-1][u][0]+t*r[i-1][u+1][0],r[i][u][1]=(1-t)*r[i-1][u][1]+t*r[i-1][u+1][1];for(s=[],i=e=0;5>=e;i=++e)s[i]=r[i][0];for(c=[],i=o=0;5>=o;i=++o)c[i]=r[5-i][i];return[s,c]},ni=function(n){var t,i,r,u,f;for(i=0,u=n[0][1]>0,t=r=1;5>=r;t=++r)f=n[t][1]>0,f!==u&&(i++,u=f);return i},dt=function(n){var i,v,y,p,r,u,f,e,c,t,l,w,o,s,h,a,b;for(i=n[0][1]-n[5][1],r=n[5][0]-n[0][0],e=n[0][0]*n[5][1]-n[5][0]*n[0][1],p=i*i+r*r,s=0,h=0,o=a=1;5>=a;o=++a)t=i*n[o][0]+r*n[o][1]+e,b=t>0,t=t*t/p,b?t>s&&(s=t):(t=-t,h>t&&(h=t));return v=c=0,u=1,y=i,f=r,w=v*f-y*u,l=1/w,.5*Math.abs((u*(e+s)-f*c)*l-(u*(e+h)-f*c)*l)<1e-15},kt=function(n){var t;return t=n[5][1]-n[0][1],((n[5][0]-n[0][0])*n[0][1]-t*n[0][0])/-t},n.lineOverLine=l=function(n,t,i,r,u,f,e,o){var s,y,c,l,p,a,v,h;return s=i!==n,l=e!==u,s||l?(c=s?(r-t)/(i-n):0,a=l?(o-f)/(e-u):0,s&&l&&c===a?!1:s&&l?(y=t-c*n,p=f-a*u,v=(p-y)/(c-a),v>n==i>v&&v>u==e>v):s?n>u==i>u?!1:(h=t+c*(u-n),h>f==o>h):u>n==e>n?!1:(h=f+a*(n-u),h>t==r>h)):!1},n.lineOverRectangle=yi=function(n,t,i){var r,u,f,e,o,s,h,c;return r=n[0],u=n[1],f=t[0],e=t[1],o=i[0],h=i[1],s=i[2],c=i[3],l(r,u,f,e,o,h,s,h)||l(r,u,f,e,o,h,o,c)||l(r,u,f,e,o,c,s,c)||l(r,u,f,e,s,h,s,c)},n.lineOverEllipse=vi=function(n,t,i,r){var s,e,tt,h,b,k,d,c,g,nt,l,o,a,v,y,p,w,u,f;return y=(r[0]-i[0])/2,l=(r[1]-i[1])/2,g=i[0]+y,nt=i[1]+l,p=n[0]-g,u=n[1]-nt,w=t[0]-g,f=t[1]-nt,p===w&&(w+=.0001),u===f&&(f+=.0001),o=w-p,a=f-u,c=l*l,d=y*y*a*a,v=p*a-u*o,s=o*o*c+d,e=2*o*c*v,tt=c*(v*v-d),h=e*e-4*s*tt,0>h?!1:(b=(-e-Math.sqrt(h))/2/s,k=(-e+Math.sqrt(h))/2/s,b>u==f>b||k>u==f>k)},n.rectangleOverRectangle=nr=function(n,t){var i,r,u,f,e,o,s,h,c,l,a,v;return i=n[0],u=n[1],r=n[2],f=n[3],e=t[0],s=t[1],o=t[2],h=t[3],e>i==(l=o>i)&&l===(c=e>r)&&c===o>r?!1:s>u!=(v=h>u)||v!==(a=s>f)||a!==h>f},n.pointInRectangle=di=function(n,t){var i,u,f,r,e,o;return i=n[0],r=n[1],u=t[0],e=t[1],f=t[2],o=t[3],i>u==f>i&&r>e==o>r},n.pointInSquare=gi=function(n,t,i,r,u){return n>i-u==i+u>n&&t>r-u==r+u>t},n.bounding=vt=function(){var n,c,r,s,h,t,u,f,i,e,o;for(n=arguments[0],h=2<=arguments.length?slice.call(arguments,1):[],null==n&&(n=[0,0]),f=u=n[0],o=e=n[1],r=0,c=h.length;c>r;r++)s=h[r],t=s[0],i=s[1],f>t?f=t:t>u&&(u=t),o>i?o=i:i>e&&(e=i);return[f,o,u,e]},n.linesToBezier=pi=function(n,t){var i,r;return n.length?1===n.length?[n[0],n[0],n[0],n[0]]:(i=0===t[0]&&0===t[1]?wt(n,0):ut(t),r=bt(n,n.length-1),p(n,0,n.length-1,i,r)):[[0,0],[0,0],[0,0],[0,0]]},p=function(n,i,u,f,o){var b,nt,rt,ft,et,s,ot,c,k,l,st,ct,a,lt,d,ht,wt,at,vt,h,y,v,w,g;if(h=0,lt=8,d=u-i+1,2===d)return ot=t(n[u],n[i])/3,s=[0,0,0,0],s[0]=n[i],s[3]=n[u],s[1]=r(s[0],e(f,ot)),s[2]=r(s[3],e(o,ot)),s;for(b=0,l=ht=wt=i,at=u-1;at>=ht;l=ht+=1)b+=t(n[l],n[l+1]);if(k=d>4?b/d:b/2,ct=Math.pow(k,1.3),w=yt(n,i,u),s=it(n,i,u,w,f,o),v=tt(n,i,u,s,w),a=v[0],h=v[1],c=.8*t(s[0],s[3]),k>a&&t(s[0],s[1])<c&&t(s[3],s[2])<c)return s;if(ct>a){for(rt=k,l=st=1,vt=lt;vt>=st;l=st+=1)g=ui(n,i,u,w,s),s=it(n,i,u,g,f,o),v=tt(n,i,u,s,g),a=v[0],h=v[1],c=.8*t(s[0],s[3]),rt>a&&t(s[0],s[1])<c&&t(s[3],s[2])<c&&(nt=s,rt=a),w=g;if(null!=nt)return nt}return y=pt(n,h),ft=[],h>i&&(ft=p(n,i,h,f,y)),y=ut(y),et=[[0,0]],u>h&&(et=p(n,h,u,y,o)),ft.concat(et.slice(1))},ui=function(n,t,i,r,u){var f,e,h,s,o;for(o=[],f=e=h=t,s=i;s>=e;f=e+=1)o.push(ri(u,n[f],r[f-t]));return o},ri=function(n,t,i){var s,r,h,v,l,u,f,o,a,e;for(u=[[0,0],[0,0],[0,0]],o=[[0,0],[0,0]],e=c(3,n,i),r=l=0;2>=l;r=++l)u[r][0]=3*(n[r+1][0]-n[r][0]),u[r][1]=3*(n[r+1][1]-n[r][1]);for(r=h=0;1>=h;r=++h)o[r][0]=2*(u[r+1][0]-u[r][0]),o[r][1]=2*(u[r+1][1]-u[r][1]);return f=c(2,u,i),a=c(1,o,i),v=(e[0]-t[0])*f[0]+(e[1]-t[1])*f[1],s=f[0]*f[0]+f[1]*f[1]+(e[0]-t[0])*a[0]+(e[1]-t[1])*a[1],s?i-v/s:i},c=function(n,t,i){var e,o,u,s,c,f,h,l,a,r;for(r=[],f=0,c=t.length;c>f;f++)h=t[f],r.push([h[0],h[1]]);for(e=o=1,l=n;l>=o;e=o+=1)for(u=s=0,a=n-e;a>=s;u=s+=1)r[u][0]=(1-i)*r[u][0]+i*r[u+1][0],r[u][1]=(1-i)*r[u][1]+i*r[u+1][1];return r[0]},it=function(n,i,o,h,c,l){var y,k,d,p,v,b,ct,lt,a,ut,ft,tt,et,at,vt,yt,ht,it,rt,w;for(v=[[0,0],[0,0]],w=[0,0],p=[[0,0],[0,0],[0,0],[0,0]],tt=Math.abs(o-i+1),y=[],a=et=1,at=tt;at>=et;a=et+=1)y.push([[0,0],[0,0]]);for(a=ut=0,vt=tt-1;vt>=ut;a=ut+=1)it=c,rt=l,it=e(it,g(h[a])),rt=e(rt,nt(h[a])),y[a][0]=it,y[a][1]=rt;for(a=ft=0,yt=tt-1;yt>=ft;a=ft+=1)v[0][0]+=f(y[a][0],y[a][0]),v[0][1]+=f(y[a][0],y[a][1]),v[1][0]=v[0][1],v[1][1]+=f(y[a][1],y[a][1]),ht=u(n[i+a],r(s(n[i],ot(h[a])),r(s(n[i],g(h[a])),r(s(n[o],nt(h[a])),s(n[o],st(h[a])))))),w[0]+=f(y[a][0],ht),w[1]+=f(y[a][1],ht);return b=v[0][0]*v[1][1]-v[1][0]*v[0][1],ct=v[0][0]*w[1]-v[0][1]*w[0],lt=w[0]*v[1][1]-w[1]*v[0][1],b||(b=v[0][0]*v[1][1]*1e-11),k=lt/b,d=ct/b,(0>k||0>d)&&(k=d=t(n[o],n[i])/3),p[0]=n[i],p[3]=n[o],p[1]=r(p[0],e(c,k)),p[2]=r(p[3],e(l,d)),p},tt=function(n,t,i,r,u){var o,f,e,s,h,v,a,l;for(e=0,l=Math.floor((i+t+1)/2),f=s=v=t+1,a=i-1;a>=s;f=s+=1)h=c(3,r,u[f-t]),o=ft([h[0]-n[f][0],h[1]-n[f][1]]),o>=e&&(e=o,l=f);return[e,l]},yt=function(n,i,r){var u,e,o,c,s,l,h,f;for(f=[0],u=o=c=i+1,s=r;s>=o;u=o+=1)f.push(f[u-i-1]+t(n[u],n[u-1]));for(u=e=l=i+1,h=r;h>=e;u=e+=1)f[u-i]=f[u-i]/f[r-i];return f},wt=function(n,t){return k(u(n[t+1],n[t]))},bt=function(n,t){var i,r,f,e,o,s,h;return i=n[t-1],r=t>1?n[t-2]:i,f=t>2?n[t-3]:r,e=.5,o=1/3,s=1/6,h=[i[0]*e+r[0]*o+f[0]*s,i[1]*e+r[1]*o+f[1]*s],k(u(h,n[t]))},pt=function(n,t){var i,r;return i=t>0?u(n[t-1],n[t]):[.01,0],r=t<n.length-1?u(n[t],n[t+1]):[.01,0],k([i[0]+r[0],i[1]+r[1]])},n.bezierPoints=at=function(n){var t,i,r,u,f,e,c,l,o,s,a,v,h;return i=n[0],e=i[0],s=i[1],r=n[1],c=r[0],a=r[1],u=n[2],l=u[0],v=u[1],f=n[3],o=f[0],h=f[1],t=[],t.push([e,s]),w(t,e,s,c,a,l,v,o,h,0),t.push([o,h]),t},et=8,o=.25,d=1e-8,v=.09,h=.5,w=function(n,t,r,u,f,e,s,c,l,a){var p,b,y,nt,k,g,tt,ut,ft,ot,it,st,ht,ct,lt,at,rt,vt,yt;if(a>et)return void n.push([u,f]);switch(it=(u+e)/2,rt=(f+s)/2,k=c-t,g=l-r,p=Math.abs((u-c)*g-(f-l)*k),b=Math.abs((e-c)*g-(s-l)*k),((p>d)<<1)+(b>d)){case 0:if(tt=k*k+g*g,0===tt)p=i(t,r,u,f),b=i(c,l,e,s);else{if(tt=1/tt,y=u-t,nt=f-r,p=tt*(y*k+nt*g),y=e-t,nt=s-r,b=tt*(y*k+nt*g),p>0&&1>p&&b>0&&1>b)return;p=0>=p?i(u,f,t,r):p>=1?i(u,f,c,l):i(u,f,t+p*k,r+p*g);b=0>=b?i(e,s,t,r):b>=1?i(e,s,c,l):i(e,s,t+b*k,r+b*g)}if(p>b){if(o>p)return void n.push([u,f])}else if(o>b)return void n.push([e,s]);break;case 1:if(o*(k*k+g*g)>=b*b){if(y=Math.abs(Math.atan2(l-s,c-e)-Math.atan2(s-f,e-u)),y>=Math.PI&&(y=2*Math.PI-y),v>y)return n.push([u,f]),void n.push([e,s]);if(y>h)return void n.push([e,s])}break;case 2:if(o*(k*k+g*g)>=p*p){if(y=Math.abs(Math.atan2(s-f,e-u)-Math.atan2(f-r,u-t)),y>=Math.PI&&(y=2*Math.PI-y),v>y)return n.push([u,f]),void n.push([e,s]);if(y>h)return void n.push([u,f])}break;case 3:if(o*(k*k+g*g)>=(p+b)*(p+b)){if(tt=Math.atan2(s-f,e-u),y=Math.abs(tt-Math.atan2(f-r,u-t)),nt=Math.abs(Math.atan2(l-s,c-e)-tt),y>=Math.PI&&(y=2*Math.PI-y),nt>=Math.PI&&(nt=2*Math.PI-nt),v>y+nt)return void n.push([it,rt]);if(y>h)return void n.push([u,f]);if(nt>h)return void n.push([e,s])}}ut=(t+u)/2;ct=(r+f)/2;ht=(e+c)/2;yt=(s+l)/2;ft=(ut+it)/2;lt=(ct+rt)/2;st=(it+ht)/2;vt=(rt+yt)/2;ot=(ft+st)/2;at=(lt+vt)/2;w(n,t,r,ut,ct,ft,lt,ot,at,a+1);w(n,ot,at,st,vt,ht,yt,c,l,a+1)},n.angleBetweenVectors=ht=function(n,t,i){var h,o,s,r,u,f,e;return r=t[0]-n[0],u=t[1]-n[1],f=i[0]-n[0],e=i[1]-n[1],h=Math.sqrt(r*r+u*u)*Math.sqrt(f*f+e*e),o=0,h>1e-10&&(s=(r*f+u*e)/h,s>=-1&&1>=s&&(o=Math.acos(s))),r*e-u*f>0?o:-o},n.makeCurvesPath=bi=function(n,t){var r,e,i,o,s,u,f;if(o=(i=t)[0],u=o[0],f=o[1],"number"==typeof u){if(n.beginPath(),n.moveTo(u,f),4===i.length&&u===i[3][0]&&f===i[3][1])return void n.lineTo(u+.01,f+.01);for(r=e=1,s=i.length-1;s>=e;r=e+=3)n.bezierCurveTo(i[r][0],i[r][1],i[r+1][0],i[r+1][1],i[r+2][0],i[r+2][1])}},n.calculateCurvesBounds=oi=function(n){var i,r,u,f,t,v,y,k,d,p,g,w,b,c,l,e,o,a,s,h;for(i=r=n[0][0],u=f=n[0][1],t=y=3,d=n.length;d>y;t=y+=3)p=n[t],l=p[0],a=p[1],i>l?i=l:l>r&&(r=l),u>a?u=a:a>f&&(f=a);for(t=v=0,g=n.length-2;g>=v;t=v+=3)w=n[t+1],e=w[0],s=w[1],b=n[t+2],o=b[0],h=b[1],(i>e||e>r||u>s||s>f||i>o||o>r||u>h||h>f)&&(k=at(n.slice(t,t+4)),c=vt.apply(null,k),e=c[0],s=c[1],o=c[2],h=c[3],i>e&&(i=e),u>s&&(u=s),o>r&&(r=o),h>f&&(f=h));return[i,u,r,f]},n.makeBracketPath=wi=function(n,t,i,r,u,f){var d,y,s,a,p,g,v,o,h,c,k,b,e,w,l;switch(o=i[0],e=i[1],d=1,y=.05*f,g=r,r-=y,")"!==t&&"}"!==t&&"]"!==t&&"⌉"!==t&&"⌋"!==t&&"⟩"!==t||(o+=g,r*=-1,d=-1),s=y*d,t){case"(":case")":n.moveTo(o,e+u/2);n.quadraticCurveTo(o,e+u/6,o+r-s/2,e);n.lineTo(o+r,e);n.quadraticCurveTo(o+s,e+u/6,o+s,e+u/2);n.quadraticCurveTo(o+s,e+5*u/6,o+r,e+u);n.lineTo(o+r-s/2,e+u);n.quadraticCurveTo(o,e+5*u/6,o,e+u/2);n.closePath();break;case"|":b=o+r/2;p=s/2;h=b-p;c=b+p;n.moveTo(h,e);n.lineTo(c,e);n.lineTo(c,e+u);n.lineTo(h,e+u);n.closePath();break;case"[":case"]":case"⌈":case"⌉":case"⌊":case"⌋":n.moveTo(o,e);n.lineTo(o,e+u);"⌈"===t||"⌉"===t?n.lineTo(o+s,e+u):(n.lineTo(o+r,e+u),n.lineTo(o+r,e+u-y/2),n.lineTo(o+s,e+u-y/2));"⌊"===t||"⌋"===t?n.lineTo(o+s,e):(n.lineTo(o+s,e+y/2),n.lineTo(o+r,e+y/2),n.lineTo(o+r,e));n.closePath();break;case"{":case"}":w=e+u;k=o+r;l=e+u/2;b=o+r/2;p=s/2;h=b-p;c=b+p;v=Math.abs(r/2);a=y/4;n.moveTo(o,l-a);n.quadraticCurveTo(h,l-a,h,l-v);n.lineTo(h,e+v);n.quadraticCurveTo(h,e,k,e);n.lineTo(k,e+a);n.quadraticCurveTo(c,e+a,c,e+v);n.lineTo(c,l-v);n.quadraticCurveTo(c,l,o+p,l);n.quadraticCurveTo(c,l,c,l+v);n.lineTo(c,w-v);n.quadraticCurveTo(c,w-a,k,w-a);n.lineTo(k,w);n.quadraticCurveTo(h,w,h,w-v);n.lineTo(h,l+v);n.quadraticCurveTo(h,l+a,o,l+a);n.closePath();break;case"⟨":case"⟩":n.moveTo(o,e+u/2);n.lineTo(o+r-s,e);n.lineTo(o+r,e);n.lineTo(o+s,e+u/2);n.lineTo(o+r,e+u);n.lineTo(o+r-s,e+u);n.closePath()}},n}();this.Graphics=function(){function n(){}return n.drawRotationHelper=function(n,t,i,r){n.setLineDash&&n.setLineDash([4]);n.lineDashOffset=.5;n.beginPath();n.moveTo(i[0],i[1]);n.lineTo(t[0],t[1]);n.lineTo(r[0],r[1]);n.strokeStyle="rgba(0,0,0,.4)";n.setLineDash&&n.setLineDash([]);n.stroke()},n.drawActiveBounds=function(n,t){var i,u,r,f;i=t[0];r=t[1];u=t[2];f=t[3];n.lineJoin="miter";n.lineCap="butt";n.strokeStyle="rgba(0,0,0,.4)";n.setLineDash&&n.setLineDash([4]);n.lineDashOffset=.5;n.strokeRect(i-.5,r-.5,u-i+1,f-r+1);n.setLineDash&&n.setLineDash([]);n.lineDashOffset=0},n.drawHandlePoint=function(n,t,i){var e,f,s,r,h,u,c,o,l;o=t[0];l=t[1];n.beginPath();r=Math.PI;u=3;f=i-u;s=o-f;h=o+f;c=l-f;e=l+f;n.moveTo(o-i,e);n.arc(s,c,u,r,1.5*r);n.arc(h,c,u,1.5*r,0);n.arc(h,e,u,0,.5*r);n.arc(s,e,u,.5*r,r);n.fillStyle="hsla(90,60%,50%,.8)";n.strokeStyle="hsla(90,60%,30%,.9)";n.lineWidth=1;n.fill();n.stroke()},n.drawSelectionRectangle=function(n,t){var u,f,i,e,r,o;i=t[0];r=t[1];e=t[2];o=t[3];f=e-i;u=o-r;n.save();n.translate(.5,.5);n.strokeStyle="rgba(0,0,200,.3)";n.lineWidth=1;n.fillStyle="rgba(0,0,200,.05)";n.fillRect(i,r,f,u);n.strokeRect(i,r,f,u);n.restore()},n.drawEditorCursor=function(n,t,i,r,u,f){var e,o;e=t[0];o=t[1];null==u&&(u=0);null==f&&(f=1);n.save();n.translate(e,o);n.globalAlpha=f;n.lineJoin="round";n.beginPath();n.moveTo(0,0);n.rotate(u);n.quadraticCurveTo(2,-4,4,-12);n.quadraticCurveTo(12,-16,18,-24);n.quadraticCurveTo(22,-22,24,-18);n.quadraticCurveTo(16,-12,12,-4);n.quadraticCurveTo(4,-2,0,0);n.closePath();n.strokeStyle="rgba(255,255,255,.7)";n.lineWidth=3;n.stroke();n.strokeStyle="rgba(0,0,0,.8)";n.lineWidth=.8;n.stroke();n.fillStyle=i;n.fill();n.beginPath();n.moveTo(12,-4);n.quadraticCurveTo(6,-6,4,-12);n.lineWidth=.5;n.stroke();n.beginPath();n.moveTo(0,0);n.lineTo(2,-5);n.quadraticCurveTo(3,-3,5,-2);n.lineTo(0,0);n.fillStyle="#000";n.fill();null!=r&&(n.font="14px Open Sans",n.fillStyle="#000",n.fillText(r,20,0));n.restore()},n}();("undefined"!=typeof window&&null!==window?window:module.exports).Unicode=Unicode=function(){function t(){}var rt,ut,ft,gt,ni,r,et,ot,st,ti,ii,v,e,ri,o,ui,fi,ei,y,s,ht,oi,si,hi,ci,li,ct,ai,p,vi,yi,pi,wi,w,lt,h,at,bi,ki,di,gi,nr,i,tr,vt,yt,u,ir,b,c,k,d,pt,wt,g,rr,nt,bt,f,l,tt,a,n,kt,it,dt;return n=function(){for(it=[],a=0;39>=a;a++)it.push(a);return it}.apply(this),di=n[0],ti=n[1],ri=n[2],tr=n[3],oi=n[4],bi=n[5],ei=n[6],ir=n[7],vi=n[8],nr=n[9],gi=n[10],ki=n[11],ut=n[12],ci=n[13],ct=n[14],ai=n[15],li=n[16],gt=n[17],ni=n[18],ft=n[19],rr=n[20],ii=n[21],wt=n[22],si=n[23],hi=n[24],yi=n[25],wi=n[26],pi=n[27],fi=n[28],vt=n[29],u=n[30],r=n[31],o=n[32],h=n[33],at=n[34],ot=n[35],yt=n[36],rt=n[37],g=n[38],st=n[39],w=[/[\u0028\u005B\u007B\u00A1\u00BF\u0F3A\u0F3C\u169B\u201A\u201E\u2045\u207D\u208D\u2308\u230A\u2329\u2768\u276A\u276C\u276E\u2770\u2772\u2774\u27C5\u27E6\u27E8\u27EA\u27EC\u27EE\u2983\u2985\u2987\u2989\u298B\u298D\u298F\u2991\u2993\u2995\u2997\u29D8\u29DA\u29FC\u2E18\u2E22\u2E24\u2E26\u2E28\u2E42\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\u301A\u301D\uFD3F\uFE17\uFE35\uFE37\uFE39\uFE3B\uFE3D\uFE3F\uFE41\uFE43\uFE47\uFE59\uFE5B\uFE5D\uFF08\uFF3B\uFF5B\uFF5F\uFF62]/,/[\u007D\u0F3B\u0F3D\u169C\u2046\u207E\u208E\u2309\u230B\u232A\u2769\u276B\u276D\u276F\u2771\u2773\u2775\u27C6\u27E7\u27E9\u27EB\u27ED\u27EF\u2984\u2986\u2988\u298A\u298C\u298E\u2990\u2992\u2994\u2996\u2998\u29D9\u29DB\u29FD\u2E23\u2E25\u2E27\u2E29\u3001-\u3002\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\u301B\u301E-\u301F\uFD3E\uFE11-\uFE12\uFE18\uFE36\uFE38\uFE3A\uFE3C\uFE3E\uFE40\uFE42\uFE44\uFE48\uFE50\uFE52\uFE5A\uFE5C\uFE5E\uFF09\uFF0C\uFF0E\uFF3D\uFF5D\uFF60-\uFF61\uFF63-\uFF64]/,/[\u0029\u005D]/,/[\u0022\u0027\u00AB\u00BB\u2018-\u2019\u201B-\u201D\u201F\u2039-\u203A\u275B-\u2760\u2E00-\u2E0D\u2E1C-\u2E1D\u2E20-\u2E21]/,/[\u00A0\u034F\u035C-\u0362\u0F08\u0F0C\u0F12\u0FD9-\u0FDA\u180E\u2007\u2011\u202F]/,/[\u17D6\u203C-\u203D\u2047-\u2049\u3005\u301C\u303B-\u303C\u309B-\u309E\u30A0\u30FB\u30FD-\u30FE\uA015\uFE54-\uFE55\uFF1A-\uFF1B\uFF65\uFF9E-\uFF9F]/,/[\u0021\u003F\u05C6\u061B\u061E-\u061F\u06D4\u07F9\u0F0D-\u0F11\u0F14\u1802-\u1803\u1808-\u1809\u1944-\u1945\u2762-\u2763\u2CF9\u2CFE\u2E2E\uA60E\uA876-\uA877\uFE15-\uFE16\uFE56-\uFE57\uFF01\uFF1F]/,/[\u002F]/,/[\u002C\u002E\u003A-\u003B\u037E\u0589\u060C-\u060D\u07F8\u2044\uFE10\uFE13-\uFE14]/,/[\u0024\u002B\u005C\u00A3-\u00A5\u00B1\u058F\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20A6\u20A8-\u20B5\u20B7-\u20BA\u20BC-\u20BD\u20BF-\u20CF\u2116\u2212-\u2213\uFE69\uFF04\uFFE1\uFFE5-\uFFE6]/,/[\u0025\u00A2\u00B0\u0609-\u060B\u066A\u09F2-\u09F3\u09F9\u0D79\u2030-\u2037\u20A7\u20B6\u20BB\u20BE\u2103\u2109\uA838\uFDFC\uFE6A\uFF05\uFFE0]/,/[\u0030-\u0039\u0660-\u0669\u066B-\u066C\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9]/,/[\u0023\u0026\u002A\u003C-\u003E\u0040-\u005A\u005E-\u007A\u007E\u00A6\u00A9\u00AC\u00AE-\u00AF\u00B5\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C6\u02CE-\u02CF\u02D1-\u02D7\u02DC\u02DE\u02E0-\u02FF\u0370-\u0377\u037A-\u037D\u037F\u0384-\u038A\u038C\u038E-\u03A1\u03A3-\u0482\u048A-\u052F\u0531-\u0556\u0559-\u055F\u0561-\u0587\u058D-\u058E\u05C0\u05C3\u05F3-\u05F4\u0600-\u0608\u060E-\u060F\u0620-\u064A\u066D-\u066F\u0671-\u06D3\u06D5\u06DD-\u06DE\u06E5-\u06E6\u06E9\u06EE-\u06EF\u06FA-\u070D\u070F-\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F7\u07FA\u0800-\u0815\u081A\u0824\u0828\u0830-\u083E\u0840-\u0858\u085E\u08A0-\u08B4\u08B6-\u08BD\u08E2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0970-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u09F4-\u09F8\u09FA\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF0\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B70-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0BF0-\u0BF8\u0BFA\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C78-\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E-\u0D4F\u0D54-\u0D56\u0D58-\u0D61\u0D70-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DF4\u0E4F\u0F00\u0F05\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F2A-\u0F33\u0F36\u0F38\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u0FC0-\u0FC5\u0FC7-\u0FCC\u0FCE-\u0FCF\u0FD4-\u0FD8\u104C-\u104F\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FF\u1200-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1360\u1362-\u137C\u1380-\u1399\u13A0-\u13F5\u13F8-\u13FD\u1401-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u17D9\u17F0-\u17F9\u1800-\u1801\u1807\u180A\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1940\u19E0-\u1A16\u1A1E-\u1A1F\u1B05-\u1B33\u1B45-\u1B4B\u1B5C\u1B61-\u1B6A\u1B74-\u1B7C\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1BFC-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CC0-\u1CC7\u1CD3\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFC\u1FFE\u2017\u2022-\u2023\u2038\u203E-\u2043\u204A-\u2055\u2057\u205C\u2061-\u2064\u2070-\u2071\u2075-\u207C\u2080\u2085-\u208C\u2090-\u209C\u2100-\u2102\u2104\u2106-\u2108\u210A-\u2112\u2114-\u2115\u2117-\u2120\u2123-\u212A\u212C-\u2153\u2156-\u215A\u215C-\u215D\u215F\u216C-\u216F\u217A-\u2188\u218A-\u218B\u219A-\u21D1\u21D3\u21D5-\u21FF\u2201\u2204-\u2206\u2209-\u220A\u220C-\u220E\u2210\u2214\u2216-\u2219\u221B-\u221C\u2221-\u2222\u2224\u2226\u222D\u222F-\u2233\u2238-\u223B\u223E-\u2247\u2249-\u224B\u224D-\u2251\u2253-\u225F\u2262-\u2263\u2268-\u2269\u226C-\u226D\u2270-\u2281\u2284-\u2285\u2288-\u2294\u2296-\u2298\u229A-\u22A4\u22A6-\u22BE\u22C0-\u22EE\u22F0-\u2307\u230C-\u2311\u2313-\u2319\u231C-\u2328\u232B-\u23EF\u23F4-\u23FE\u2400-\u2426\u2440-\u244A\u24FF\u254C-\u254F\u2575-\u257F\u2590-\u2591\u2596-\u259F\u25A2\u25AA-\u25B1\u25B4-\u25B5\u25B8-\u25BB\u25BE-\u25BF\u25C2-\u25C5\u25C9-\u25CA\u25CC-\u25CD\u25D2-\u25E1\u25E6-\u25EE\u25F0-\u25FF\u2604\u2607-\u2608\u260A-\u260D\u2610-\u2613\u2619\u2620-\u2638\u263C-\u263F\u2641\u2643-\u265F\u2662\u2666\u266B\u266E\u2670-\u267E\u2680-\u269D\u26A0-\u26BC\u26CE\u26E2\u26E4-\u26E7\u2705-\u2707\u270E-\u2756\u2758-\u275A\u2761\u2765-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B54\u2B5A-\u2B73\u2B76-\u2B95\u2B98-\u2BB9\u2BBD-\u2BC8\u2BCA-\u2BD1\u2BEC-\u2BEF\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CEE\u2CF2-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E16\u2E1A-\u2E1B\u2E1E-\u2E1F\u2E2F\u2E32\u2E35-\u2E39\u2E3F\u4DC0-\u4DFF\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA673\uA67E-\uA69D\uA6A0-\uA6EF\uA6F2\uA700-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA828-\uA82B\uA830-\uA837\uA839\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA95F\uA984-\uA9B2\uA9C1-\uA9C6\uA9CA-\uA9CD\uA9CF\uA9DE-\uA9DF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA5C\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB65\uAB70-\uABE2\uFB00-\uFB06\uFB13-\uFB17\uFB29\uFB50-\uFBC1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFDFD\uFE70-\uFE74\uFE76-\uFEFC\uFFE8-\uFFEE]/,/[\u05D0-\u05EA\u05F0-\u05F2\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFB4F]/,/[\u231A-\u231B\u23F0-\u23F3\u2600-\u2603\u2614-\u2615\u2618\u261A-\u261C\u261E-\u261F\u2639-\u263B\u2668\u267F\u26BD-\u26C8\u26CD\u26CF-\u26D1\u26D3-\u26D4\u26D8-\u26D9\u26DC\u26DF-\u26E1\u26EA\u26F1-\u26F5\u26F7-\u26F8\u26FA\u26FD-\u2704\u2708-\u2709\u2764\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3003-\u3004\u3006-\u3007\u3012-\u3013\u3020-\u3029\u3030-\u3034\u3036-\u303A\u303D-\u303F\u3042\u3044\u3046\u3048\u304A-\u3062\u3064-\u3082\u3084\u3086\u3088-\u308D\u308F-\u3094\u309F\u30A2\u30A4\u30A6\u30A8\u30AA-\u30C2\u30C4-\u30E2\u30E4\u30E6\u30E8-\u30ED\u30EF-\u30F4\u30F7-\u30FA\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u3200-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA014\uA016-\uA48C\uA490-\uA4C6\uF900-\uFAFF\uFE30-\uFE34\uFE45-\uFE46\uFE49-\uFE4F\uFE51\uFE58\uFE5F-\uFE66\uFE68\uFE6B\uFF02-\uFF03\uFF06-\uFF07\uFF0A-\uFF0B\uFF0D\uFF0F-\uFF19\uFF1C-\uFF1E\uFF20-\uFF3A\uFF3C\uFF3E-\uFF5A\uFF5C\uFF5E\uFF66\uFF71-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE2-\uFFE4]/,/[\u2024-\u2026\u22EF\uFE19]/,/[\u002D]/,/[\u0009\u007C\u00AD\u058A\u05BE\u0964-\u0965\u0E5A-\u0E5B\u0F0B\u0F34\u0F7F\u0F85\u0FBE-\u0FBF\u0FD2\u104A-\u104B\u1361\u1400\u1680\u16EB-\u16ED\u1735-\u1736\u17D4-\u17D5\u17D8\u17DA\u1804-\u1805\u1B5A-\u1B5B\u1B5D-\u1B60\u1C3B-\u1C3F\u1C7E-\u1C7F\u2000-\u2006\u2008-\u200A\u2010\u2012-\u2013\u2027\u2056\u2058-\u205B\u205D-\u205F\u2CFA-\u2CFC\u2CFF\u2D70\u2E0E-\u2E15\u2E17\u2E19\u2E2A-\u2E2D\u2E30-\u2E31\u2E33-\u2E34\u2E3C-\u2E3E\u2E40-\u2E41\u2E43-\u2E44\u3000\uA4FE-\uA4FF\uA60D\uA60F\uA6F3-\uA6F7\uA8CE-\uA8CF\uA92E-\uA92F\uA9C7-\uA9C9\uAA5D-\uAA5F\uAAF0-\uAAF1\uABEB]/,/[\u00B4\u02C8\u02CC\u02DF\u0F01-\u0F04\u0F06-\u0F07\u0F09-\u0F0A\u0FD0-\u0FD1\u0FD3\u1806\u1FFD\uA874-\uA875\uA8FC]/,/[\u2014\u2E3A-\u2E3B]/,/[\u200B]/,/[\u0000-\u0008\u000E-\u001F\u007F-\u0084\u0086-\u009F\u0300-\u034E\u0350-\u035B\u0363-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u061C\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962-\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7-\u09C8\u09CB-\u09CD\u09D7\u09E2-\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A70-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2-\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47-\u0B48\u0B4B-\u0B4D\u0B56-\u0B57\u0B62-\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56\u0C62-\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5-\u0CD6\u0CE2-\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62-\u0D63\u0D82-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2-\u0DF3\u0F18-\u0F19\u0F35\u0F37\u0F39\u0F3E-\u0F3F\u0F71-\u0F7E\u0F80-\u0F84\u0F86-\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u180B-\u180D\u1885-\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8-\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u200C\u200E-\u200F\u202A-\u202E\u2066-\u206F\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3035\u3099-\u309A\uA66F-\uA672\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880-\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uAA29-\uAA36\uAA43\uAA4C-\uAA4D\uAAEB-\uAAEF\uAAF5-\uAAF6\uABE3-\uABEA\uABEC-\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFFF9-\uFFFB]/,/[\u2060\uFEFF]/,/[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]/,/[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]/,/[\u1100-\u115F\uA960-\uA97C]/,/[\u1160-\u11A7\uD7B0-\uD7C6]/,/[\u11A8-\u11FF\uD7CB-\uD7FB]/,/[\u261D\u26F9\u270A-\u270D]/,/[\u0E01-\u0E3A\u0E40-\u0E4E\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0EDC-\u0EDF\u1000-\u103F\u1050-\u108F\u109A-\u109F\u1780-\u17D3\u17D7\u17DC-\u17DD\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19DA\u19DE-\u19DF\u1A20-\u1A5E\u1A60-\u1A7C\u1AA0-\u1AAD\uA9E0-\uA9EF\uA9FA-\uA9FE\uAA60-\uAAC2\uAADB-\uAADF]/,/[\u0020]/,/[\u000B-\u000C\u2028-\u2029]/,/[\u000D]/,/[\u000A]/,/[\u0085]/,/[\uFFFC]/,/[\uD800-\uDFFF]/,/[\u00A7-\u00A8\u00AA\u00B2-\u00B3\u00B6-\u00BA\u00BC-\u00BE\u00D7\u00F7\u02C7\u02C9-\u02CB\u02CD\u02D0\u02D8-\u02DB\u02DD\u2015-\u2016\u2020-\u2021\u203B\u2074\u207F\u2081-\u2084\u2105\u2113\u2121-\u2122\u212B\u2154-\u2155\u215B\u215E\u2160-\u216B\u2170-\u2179\u2189\u2190-\u2199\u21D2\u21D4\u2200\u2202-\u2203\u2207-\u2208\u220B\u220F\u2211\u2215\u221A\u221D-\u2220\u2223\u2225\u2227-\u222C\u222E\u2234-\u2237\u223C-\u223D\u2248\u224C\u2252\u2260-\u2261\u2264-\u2267\u226A-\u226B\u226E-\u226F\u2282-\u2283\u2286-\u2287\u2295\u2299\u22A5\u22BF\u2312\u2460-\u24FE\u2500-\u254B\u2550-\u2574\u2580-\u258F\u2592-\u2595\u25A0-\u25A1\u25A3-\u25A9\u25B2-\u25B3\u25B6-\u25B7\u25BC-\u25BD\u25C0-\u25C1\u25C6-\u25C8\u25CB\u25CE-\u25D1\u25E2-\u25E5\u25EF\u2605-\u2606\u2609\u260E-\u260F\u2616-\u2617\u2640\u2642\u2660-\u2661\u2663-\u2665\u2667\u2669-\u266A\u266C-\u266D\u266F\u269E-\u269F\u26C9-\u26CC\u26D2\u26D5-\u26D7\u26DA-\u26DB\u26DD-\u26DE\u26E3\u26E8-\u26E9\u26EB-\u26F0\u26F6\u26FB-\u26FC\u2757\u2776-\u2793\u2B55-\u2B59\u3248-\u324F\uFFFD]/,/[\uE000-\uF8FF]/,/[\u3041\u3043\u3045\u3047\u3049\u3063\u3083\u3085\u3087\u308E\u3095-\u3096\u30A1\u30A3\u30A5\u30A7\u30A9\u30C3\u30E3\u30E5\u30E7\u30EE\u30F5-\u30F6\u30FC\u31F0-\u31FF\uFF67-\uFF70]/],lt=["^^^^^^^^^^^^^^^^^^^^^@^^^^^^^","_^^%%^^^^%%_____%%__^#^______","_^^%%^^^^%%%%%__%%__^#^______","^^^%%%^^^%%%%%%%%%%%^#^%%%%%%","%^^%%%^^^%%%%%%%%%%%^#^%%%%%%","_^^%%%^^^_______%%__^#^______","_^^%%%^^^______%%%__^#^______","_^^%%%^^^__%_%__%%__^#^______","_^^%%%^^^__%%%__%%__^#^______","%^^%%%^^^__%%%%_%%__^#^%%%%%%","%^^%%%^^^__%%%__%%__^#^______","%^^%%%^^^%%%%%_%%%__^#^______","%^^%%%^^^%%%%%_%%%__^#^______","%^^%%%^^^%%%%%_%%%__^#^______","_^^%%%^^^_%____%%%__^#^______","_^^%%%^^^______%%%__^#^______","_^^%_%^^^__%____%%__^#^______","_^^%_%^^^_______%%__^#^______","%^^%%%^^^%%%%%%%%%%%^#^%%%%%%","_^^%%%^^^_______%%_^^#^______","____________________^________","%^^%%%^^^%%%%%_%%%__^#^______","%^^%%%^^^%%%%%%%%%%%^#^%%%%%%","_^^%%%^^^_%____%%%__^#^___%%_","_^^%%%^^^_%____%%%__^#^____%_","_^^%%%^^^_%____%%%__^#^%%%%__","_^^%%%^^^_%____%%%__^#^___%%_","_^^%%%^^^_%____%%%__^#^____%_","_^^%%%^^^_%____%%%__^#^______"],et={_:ui=0,"%":p=1,"#":v=2,"@":e=3,"^":i=4,"!":y=5},bt=function(n){for(var r,i,t=i=0,u=w.length;u>i;t=++i)if(r=w[t],r.test(n))return t;return g},kt=function(n){switch(n){case g:case rt:case vt:case yt:return ut;case ot:return ft;case at:return r;case st:return ct;default:return n}},dt=function(n){var r,t,u,i;for(i=[],t=0,u=n.length;u>t;t++)r=n[t],i.push(kt(bt(r)));return i},s=[/[\u000D]/,/[\u000A]/,/[\u0000-\u0009\u000B-\u000C\u000E-\u001F\u007F-\u009F\u00AD\u061C\u180E\u200B\u200E-\u200F\u2028-\u202E\u2060-\u206F\uD800-\uDFFF\uFEFF\uFFF0-\uFFFB]/,/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962-\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2-\u09E3\u0A01-\u0A02\u0A3C\u0A41-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A70-\u0A71\u0A75\u0A81-\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7-\u0AC8\u0ACD\u0AE2-\u0AE3\u0B01\u0B3C\u0B3E-\u0B3F\u0B41-\u0B44\u0B4D\u0B56-\u0B57\u0B62-\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56\u0C62-\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC-\u0CCD\u0CD5-\u0CD6\u0CE2-\u0CE3\u0D01\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62-\u0D63\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86-\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039-\u103A\u103D-\u103E\u1058-\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085-\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B4-\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885-\u1886\u18A9\u1920-\u1922\u1927-\u1928\u1932\u1939-\u193B\u1A17-\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80-\u1B81\u1BA2-\u1BA5\u1BA8-\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8-\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8-\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099-\u309A\uA66F-\uA672\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1\uA802\uA806\uA80B\uA825-\uA826\uA8C4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9E5\uAA29-\uAA2E\uAA31-\uAA32\uAA35-\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7-\uAAB8\uAABE-\uAABF\uAAC1\uAAEC-\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E-\uFF9F]/,/[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E-\u094F\u0982-\u0983\u09BF-\u09C0\u09C7-\u09C8\u09CB-\u09CC\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB-\u0ACC\u0B02-\u0B03\u0B40\u0B47-\u0B48\u0B4B-\u0B4C\u0BBF\u0BC1-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0C01-\u0C03\u0C41-\u0C44\u0C82-\u0C83\u0CBE\u0CC0-\u0CC1\u0CC3-\u0CC4\u0CC7-\u0CC8\u0CCA-\u0CCB\u0D02-\u0D03\u0D3F-\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D82-\u0D83\u0DD0-\u0DD1\u0DD8-\u0DDE\u0DF2-\u0DF3\u0E33\u0EB3\u0F3E-\u0F3F\u0F7F\u1031\u103B-\u103C\u1056-\u1057\u1084\u17B6\u17BE-\u17C5\u17C7-\u17C8\u1923-\u1926\u1929-\u192B\u1930-\u1931\u1933-\u1938\u1A19-\u1A1A\u1A55\u1A57\u1A6D-\u1A72\u1B04\u1B35\u1B3B\u1B3D-\u1B41\u1B43-\u1B44\u1B82\u1BA1\u1BA6-\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2-\u1BF3\u1C24-\u1C2B\u1C34-\u1C35\u1CE1\u1CF2-\u1CF3\uA823-\uA824\uA827\uA880-\uA881\uA8B4-\uA8C3\uA952-\uA953\uA983\uA9B4-\uA9B5\uA9BA-\uA9BB\uA9BD-\uA9C0\uAA2F-\uAA30\uAA33-\uAA34\uAA4D\uAAEB\uAAEE-\uAAEF\uAAF5\uABE3-\uABE4\uABE6-\uABE7\uABE9-\uABEA\uABEC]/,/[\u1100-\u115F\uA960-\uA97C]/,/[\u1160-\u11A7\uD7B0-\uD7C6]/,/[\u11A8-\u11FF\uD7CB-\uD7FB]/,/[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]/,/[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]/],ht=["_x_________","___________","___xx______","___xx______","___xx______","___xxxxxxx_","___xx_xx___","___xx__x___","___xx_xx___","___xx__x___","___xx______"],nt=function(n){for(var r,i,t=i=0,u=s.length;u>i;t=++i)if(r=s[t],r.test(n))return t;return s.length},l=function(n,t){return"_"===ht[nt(n[t-1])][nt(n[t])]},c=[/[\u000D]/,/[\u000A]/,/[\u000B-\u000C\u0085\u2028-\u2029]/,/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962-\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7-\u09C8\u09CB-\u09CD\u09D7\u09E2-\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A70-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2-\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47-\u0B48\u0B4B-\u0B4D\u0B56-\u0B57\u0B62-\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56\u0C62-\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5-\u0CD6\u0CE2-\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62-\u0D63\u0D82-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2-\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19\u0F35\u0F37\u0F39\u0F3E-\u0F3F\u0F71-\u0F84\u0F86-\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885-\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8-\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099-\u309A\uA66F-\uA672\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880-\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C-\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7-\uAAB8\uAABE-\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5-\uAAF6\uABE3-\uABEA\uABEC-\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E-\uFF9F]/,/[\u00AD\u0600-\u0605\u061C\u06DD\u070F\u08E2\u180E\u200E-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]/,/[\u3031-\u3035\u309B-\u309C\u30A0-\u30FA\u30FC-\u30FF\u31F0-\u31FF\u32D0-\u32FE\u3300-\u3357\uFF66-\uFF9D]/,/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05F3\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1A00-\u1A16\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u24B6-\u24E9\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u303B-\u303C\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFB00-\uFB06\uFB13-\uFB17\uFB50-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,/[\u003A\u00B7\u02D7\u0387\u05F4\u2027\uFE13\uFE55\uFF1A]/,/[\u002C\u003B\u037E\u0589\u060C-\u060D\u066C\u07F8\u2044\uFE10\uFE14\uFE50\uFE54\uFF0C\uFF1B]/,/[\u002E\u2018-\u2019\u2024\uFE52\uFF07\uFF0E]/,/[\u0030-\u0039\u0660-\u0669\u066B\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9]/,/[\u005F\u202F\u203F-\u2040\u2054\uFE33-\uFE34\uFE4D-\uFE4F\uFF3F]/],k=5,b=6,d=10,pt=["_x___________","_____________","_____________","___xx________","___xx________","___xxx_____x_","___xx_x>_>xx_","___xx_<______","___xx_____<__","___xx_<___<__","___xx_x_>>xx_","___xxxx___xx_","___xx________"],f=function(n){for(var r,i,t=i=0,u=c.length;u>i;t=++i)if(r=c[t],r.test(n))return t;return c.length},tt=function(n,t){var i,r,u;switch(u=pt[i=f(n[t-1])][r=f(n[t])]){case"_":return[!0,i,r];case"x":return[!1,i,r];case"<":return[2>t||r!==(i=f(n[t-2],i,r))];case">":return[t>n.length-2||i!==(r=f(n[t+1],i,r))]}},t.findLBRPoints=function(n){var t,r,u,s,f,o;for(f=this.findLBR(n),o=[],r=u=0,s=f.length;s>u;r=++u)t=f[r],t!==i&&t!==e&&o.push([r,t===y]);return o},t.findLBR=function(n){var l,s,t,c,f;if(!n.length)return[];for(f=dt(n),t=0,c=[i];t<f.length;){for(s=f[t],s===u?s=wt:s===h&&(s=r);++t<f.length&&s!==r&&(s!==o||f[t]===h);)if(f[t]!==r&&f[t]!==h)if(f[t]!==o)if(f[t]!==u){if(l=et[lt[s][f[t]]],c[t]=l,l===p)c[t]=f[t-1]===u?p:i;else if(l===v){if(c[t]=i,f[t-1]!==u)continue;c[t]=v}else if(l===e&&(c[t]=e,f[t-1]!==u))continue;s=f[t]}else c[t]=i;else c[t]=i,s=o;else c[t]=i,s=r;c[t]=y}return c},t.isGCB=function(n,t){return l(n,t)},t.findGCBLeft=function(n,t){if(2>t)return 0;if(t>n.length)return n.length;for(;!l(n,--t););return t},t.findGCBRight=function(n,t){if(t>n.length-2)return n.length;if(0>t)return 0;for(;!l(n,++t););return t},t.findWBLeft=function(n,t){var e,i,f,r,u;if(2>t)return 0;if(t>n.length)return n.length;for(i=!1;--t>0&&(r=tt(n,t),f=r[0],e=r[1],u=r[2],i||(i=u===k||u===b||u===d),!f||!i););return t},t.findWBRight=function(n,t){var i,f,r,u;if(t>n.length-2)return n.length;if(0>t)return 0;for(i=!1;++t<n.length&&(u=tt(n,t),f=u[0],r=u[1],i||(i=r===k||r===b||r===d),!f||!i););return t},t.isHighSurrogate=function(n){var t;return 55296<=(t=n.charCodeAt(0))&&56319>=t},t.isLowSurrogate=function(n){var t;return 56320<=(t=n.charCodeAt(0))&&57343>=t},t}(),function(){var t,n;return n=function(n,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?n+6*(t-n)*i:.5>i?t:2/3>i?n+(t-n)*(2/3-i)*6:n},("undefined"!=typeof window&&null!==window?window:module.exports).Color=t={hsl2rgb:function(t){var o,s,u,i,e,f,h,r;return u=t[0],r=t[1],i=t[2],u/=360,r/=100,i/=100,0===r?h=s=o=i:(f=.5>i?i*(1+r):i+r-i*r,e=2*i-f,h=n(e,f,u+1/3),s=n(e,f,u),o=n(e,f,u-1/3)),[Math.round(255*h),Math.round(255*s),Math.round(255*o)]},rgba:function(n,t){var i,r,u;return u=n[0],r=n[1],i=n[2],"rgba("+u+","+r+","+i+","+t+")"}}}(),function(){return function(){var n;return n=function(n,t){var i,r;i="/vies";r=['<?xml version="1.0" encoding="UTF-8"?>','<SOAP-ENV:Envelope xmlns:ns0="urn:ec.europa.eu:taxud:vies:services:checkVat:types" ','xmlns:ns1="http://schemas.xmlsoap.org/soap/envelope/" ','xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ','xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">',"<SOAP-ENV:Header/><ns1:Body><ns0:checkVat>","<ns0:countryCode>",n.slice(0,2).toUpperCase(),"<\/ns0:countryCode><ns0:vatNumber>",n.slice(2),"<\/ns0:vatNumber><\/ns0:checkVat><\/ns1:Body><\/SOAP-ENV:Envelope>"].join("");$.ajax({url:i,data:r,method:"POST",dataType:"xml",success:function(n){var r,u,s,f,e,i,o;if(o=$(n),0===o.find("checkVatResponse").length)return void t("invalid");for(e={},f=["countryCode","vatNumber","requestDate","valid","name","address"],u=0,s=f.length;s>u;u++)i=f[u],r=o.find(i),e[i]="requestDate"===i?r.text().slice(0,10):"valid"===i?"true"===r.text():r.text();t(null,e)},error:function(n,i){t(i)}})},window.checkVat=function(t,i){return t?t.length<7||t.length>20?i("This is not a VAT number."):void n(t,function(n,t){return n?i("Sorry, but VIES appears to be down. (The error code is "+n+".)"):i(null,t)}):i("No VAT number specified.")}}}(this)();idroo=this.idroo={window:$(window),plan:idrooPlan||{},action:"point",objectType:null,style:{}};slice=[].slice;ref=classes="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;Color=ref.Color;("undefined"!=typeof window&&null!==window?window:module.exports).DrawObject=DrawObject=function(){function n(t){this.locked=!1;this.rawPoints=this.points||(this.points=[]);this.transform=!1;this.style=i(!0,{},n.defaultStyle,t||{});this.changed={};this.rebound()}var i,r,t;return r=2,t=5,i=("undefined"!=typeof $&&null!==$?$.extend:void 0)||require("extend"),n.defaultStyle={stroke:!0,strokeColor:[0,0,0],strokeAlpha:100,strokeWidth:3,fill:!1,fillColor:[0,100,90],fillAlpha:100,font:"Open Sans",textSize:16,textColor:[0,0,0],textAlpha:100,formulaColor:[0,0,0],formulaAlpha:100},n.byType=function(n){return classes["Draw"+n]},n.restore=function(t){var i;return i=new(n.byType(t.T)),i.restoreChange(t),i},n.makeColor=function(n,t){return null==t&&(t=100),Color.rgba(Color.hsl2rgb(n),t/100)},n.prototype.type="",n.prototype.lineJoin="miter",n.prototype.update=function(){},n.prototype.repair=function(){},n.prototype.setPointChanged=function(){var r,t,i,n,u;for(i=1<=arguments.length?slice.call(arguments,0):[],(r=this.changed).points||(r.points={}),n=0,u=i.length;u>n;n++)t=i[n],this.changed.points[t]=this.rawPoints[t]},n.prototype.rebound=function(){this.calculateBounds();this.calculateOuterBounds()},n.prototype.calculateBounds=function(){this.bounds=Geometry.bounding.apply(Geometry,this.points)},n.prototype.calculateOuterBounds=function(){var n,i,r,u,f,e;this.style.stroke?(n=this.style.strokeWidth/2+t,i=this.bounds,r=i[0],f=i[1],u=i[2],e=i[3],this.outerBounds=[r-n,f-n,u+n,e+n]):this.outerBounds=this.bounds},n.prototype.setLocked=function(n){this.locked=n;this.changed.locked=n},n.prototype.move=function(n,t){this.addChangeTransform(Geometry.translateMatrix(n,t))},n.prototype.scale=function(n,t){this.addChangeTransform(Geometry.scaleFromToMatrix(n,t))},n.prototype.rotate=function(n,t,i){this.addChangeTransform(Geometry.rotateFromToMatrix(n,t,i))},n.prototype.addChangeTransform=function(n){this.applyTransform(n);this.changed.transform=null!=this.changed.transform?Geometry.transform(n,this.changed.transform):n},n.prototype.applyTransform=function(n){this.transform=this.transform?Geometry.transform(n,this.transform):n;this.refreshPoints()},n.prototype.refreshPoints=function(){this.points=this.transform?Geometry.transformPoints(this.rawPoints,this.transform):this.rawPoints.slice(0);this.rebound()},n.prototype.trySetStyle=function(n,t){var i;if(null==t[n]||this.style[n]===(i=t[n]))return!1;switch(n){case"fillColor":case"fillAlpha":this.fillStyle=null;break;case"strokeColor":case"strokeAlpha":this.strokeStyle=null;break;case"textColor":case"textAlpha":this.textStyle=null;break;case"formulaColor":case"formulaAlpha":this.formulaStyle=null}return this.style[n]=i,null==this.changed.style&&(this.changed.style={}),this.changed.style[n]=!0,!0},n.prototype.setStyle=function(n){var t,r,i,u;for(i=["stroke","strokeColor","strokeAlpha","strokeWidth","fill","fillColor","fillAlpha"],t=0,r=i.length;r>t;t++)u=i[t],this.trySetStyle(u,n);null==n.stroke&&null==n.strokeWidth||this.calculateOuterBounds()},n.prototype.toDataURL=function(){var i,n,f,t,e,r,o,u,s;if(t=this.outerBounds,r=t[0],u=t[1],o=t[2],s=t[3],e=o-r,f=s-u,"undefined"==typeof document||null===document)throw new Error("Dont have canvas");return n=document.createElement("canvas"),n.width=e,n.height=f,i=n.getContext("2d"),i.translate(-r,-u),this.draw(i,{fill:!0,stroke:!0,extra:!0}),n.toDataURL()},n.prototype.draw=function(n,t){null==t&&(t={});this.prepareDraw(n);t.highlight&&this.drawHighlight(n,t.highlight);t.fill&&this.style.fill!==!1&&this.drawFill(n);t.stroke&&this.style.stroke!==!1&&this.drawStroke(n);t.extra&&this.drawExtra(n,t)},n.prototype.prepareDraw=function(n){this.makePath(n)},n.prototype.drawFill=function(t){t.fillStyle=null!=this.fillStyle?this.fillStyle:this.fillStyle=n.makeColor(this.style.fillColor,this.style.fillAlpha);t.fill()},n.prototype.drawStroke=function(t){t.strokeStyle=null!=this.strokeStyle?this.strokeStyle:this.strokeStyle=n.makeColor(this.style.strokeColor,this.style.strokeAlpha);t.lineWidth=this.style.strokeWidth;t.lineJoin=this.lineJoin;t.lineCap="round";t.stroke()},n.prototype.drawExtra=function(){},n.prototype.drawHighlight=function(n,t){n.strokeStyle=t;n.lineWidth=r+(this.style.stroke?this.style.strokeWidth:0);n.lineJoin=this.lineJoin;n.lineCap="round";n.stroke()},n.prototype.makePath=function(n){n.beginPath()},n.prototype.pickUp=function(n,t){return Geometry.pointInRectangle([n,t],this.outerBounds)?this.canPickFill()&&this.pickFillLocal(n,t)?!0:!(!this.style.stroke||!this.pickStrokeLocal(n,t)):!1},n.prototype.pickStrokeLocal=function(){return!1},n.prototype.pickFillLocal=function(){return!1},n.prototype.canPickFill=function(){return this.style.fill!==!1},n.prototype.isOver=function(n){return n<this.style.strokeWidth/2+t},n.prototype.isOverLine=function(n,t,i){return this.isOver(Geometry.distanceFromLine(n,t,i))},n.prototype.rectangleOver=function(n){var t,i,r,u;return Geometry.rectangleOverRectangle(n,this.outerBounds)?this.rectangleContains(n)?!0:(t=n[0],r=n[1],i=n[2],u=n[3],this.canPickFill()&&(this.pickFillLocal(t,r)||this.pickFillLocal(i,u)||this.pickFillLocal(t,u)||this.pickFillLocal(i,r))?!0:!!this.rectangleOverLine(n)):!1},n.prototype.rectangleContains=function(){return!1},n.prototype.rectangleOverLine=function(){return!1},n.prototype.serialize=function(){var t;return t={T:this.type,P:this.rawPoints.slice(0),S:{}},this.style.stroke!==n.defaultStyle.stroke&&(t.S.L=this.style.stroke),idroo.utils.colorsEqual(this.style.strokeColor,n.defaultStyle.strokeColor)||(t.S.S=this.style.strokeColor),this.style.strokeAlpha!==n.defaultStyle.strokeAlpha&&(t.S.O=this.style.strokeAlpha),this.style.strokeWidth!==n.defaultStyle.strokeWidth&&(t.S.W=this.style.strokeWidth),this.style.fill!==n.defaultStyle.fill&&(t.S.B=this.style.fill),idroo.utils.colorsEqual(this.style.fillColor,n.defaultStyle.fillColor)||(t.S.F=this.style.fillColor),this.style.fillAlpha!==n.defaultStyle.fillAlpha&&(t.S.A=this.style.fillAlpha),this.transform&&(t.M=this.transform),this.locked&&(t.L=!0),t},n.prototype.serializeChange=function(){var n;return n=this.changes(),this.changed={},n},n.prototype.changes=function(){var n;return n={},null!=this.changed.style&&(n.S={},null!=this.changed.style.stroke&&(n.S.L=this.style.stroke),null!=this.changed.style.strokeColor&&(n.S.S=this.style.strokeColor),null!=this.changed.style.strokeAlpha&&(n.S.O=this.style.strokeAlpha),null!=this.changed.style.strokeWidth&&(n.S.W=this.style.strokeWidth),null!=this.changed.style.fill&&(n.S.B=this.style.fill),null!=this.changed.style.fillColor&&(n.S.F=this.style.fillColor),null!=this.changed.style.fillAlpha&&(n.S.A=this.style.fillAlpha)),null!=this.changed.transform&&(n.N=this.changed.transform),null!=this.changed.points&&(n.E=this.changed.points),null!=this.changed.locked&&(n.L=this.changed.locked),n},n.prototype.restoreChange=function(n){var t,r,i;if(null!=n.L&&(this.locked=n.L),null!=n.S&&(null!=n.S.L&&(this.style.stroke=n.S.L),null==n.S.S&&null==n.S.O||(null!=n.S.S&&(this.style.strokeColor=n.S.S),null!=n.S.O&&(this.style.strokeAlpha=n.S.O),this.strokeStyle=null),null!=n.S.W&&(this.style.strokeWidth=n.S.W),null!=n.S.B&&(this.style.fill=n.S.B),null==n.S.F&&null==n.S.A||(null!=n.S.F&&(this.style.fillColor=n.S.F),null!=n.S.A&&(this.style.fillAlpha=n.S.A),this.fillStyle=null)),null!=n.P&&(this.rawPoints=n.P.slice(0)),null!=n.E){i=n.E;for(t in i)r=i[t],this.rawPoints[t]=r}null!=n.M&&(this.transform=n.M);null!=n.N&&this.applyTransform(n.N);null==n.P&&null==n.E&&null==n.M||null!=n.N?null==n.S||null==n.S.L&&null==n.S.W||this.calculateOuterBounds():this.refreshPoints()},n}();var DrawGroup,DrawObject,Geometry,ref,extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},hasProp={}.hasOwnProperty,slice=[].slice;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawObject=ref.DrawObject;("undefined"!=typeof window&&null!==window?window:module.exports).DrawGroup=DrawGroup=function(n){function t(){var n;n=1<=arguments.length?slice.call(arguments,0):[];this.objects=n;this.updateChangeCaller();t.__super__.constructor.call(this,{stroke:!1});this.objects&&this.rebound()}return extend(t,n),t.prototype.type="Group",t.prototype.changeCaller=!1,t.prototype.objects=null,t.prototype.updateChangeCaller=function(){var n,r,t,i;for(i=this.objects,n=0,r=i.length;r>n;n++)t=i[n],t.changeCaller&&(this.changeCaller=!0,t.callChange=function(n){return function(){return n.callChange()}}(this))},t.prototype.callChange=function(){},t.prototype.calculateBounds=function(){var o,s,h,c,i,l,y,a,v,n,t,r,u,f,e;for(v=this.objects,i=l=0,y=v.length;y>l;i=++l)a=v[i],i?(n=a.bounds,o=n[0],h=n[1],s=n[2],c=n[3],r>o&&(r=o),f>h&&(f=h),s>u&&(u=s),c>e&&(e=c)):(t=a.bounds,r=t[0],f=t[1],u=t[2],e=t[3]);this.bounds=[r,f,u,e]},t.prototype.calculateOuterBounds=function(){var o,s,h,c,i,l,y,a,v,n,t,r,u,f,e;for(v=this.objects,i=l=0,y=v.length;y>l;i=++l)a=v[i],i?(n=a.outerBounds,o=n[0],h=n[1],s=n[2],c=n[3],r>o&&(r=o),f>h&&(f=h),s>u&&(u=s),c>e&&(e=c)):(t=a.outerBounds,r=t[0],f=t[1],u=t[2],e=t[3]);this.outerBounds=[r,f,u,e]},t.prototype.applyTransform=function(n){var t,r,u,i;for(i=this.objects,t=0,r=i.length;r>t;t++)u=i[t],u.applyTransform(n);this.rebound()},t.prototype.setStyle=function(){},t.prototype.draw=function(n,t){var i,u,f,r;for(null==t&&(t={}),r=this.objects,i=0,u=r.length;u>i;i++)f=r[i],f.draw(n,t)},t.prototype.canPickFill=function(){return!0},t.prototype.pickFillLocal=function(n,t){var i,u,f,r;for(r=this.objects,i=0,u=r.length;u>i;i++)if(f=r[i],f.pickUp(n,t))return!0;return!1},t.prototype.rectangleOver=function(n){var t,r,u,i;if(!Geometry.rectangleOverRectangle(n,this.outerBounds))return!1;for(i=this.objects,t=0,r=i.length;r>t;t++)if(u=i[t],u.rectangleOver(n))return!0;return!1},t.prototype.serialize=function(){var t,n;return n={T:this.type},n.o=function(){var n,u,i,r;for(i=this.objects,r=[],n=0,u=i.length;u>n;n++)t=i[n],r.push(t.serialize());return r}.call(this),n},t.prototype.restoreChange=function(n){var i;t.__super__.restoreChange.call(this,n);null!=n.o&&(this.objects=function(){var t,f,r,u;for(r=n.o,u=[],t=0,f=r.length;f>t;t++)i=r[t],u.push(DrawObject.restore(i));return u}(),this.updateChangeCaller(),this.rebound())},t}(DrawObject);extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};hasProp={}.hasOwnProperty;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawObject=ref.DrawObject;("undefined"!=typeof window&&null!==window?window:module.exports).DrawLine=DrawLine=function(n){function t(n,i,r){null==n&&(n=0);null==i&&(i=0);this.points=[[n,i],[n+.5,i+.5]];t.__super__.constructor.call(this,r)}return extend(t,n),t.prototype.type="Line",t.prototype.update=function(n,t){this.points[1]=[n,t];this.setPointChanged(1);this.rebound()},t.prototype.makePath=function(n){var i,r,u,f,e,o,t;n.beginPath();i=this.points;r=i[0];f=r[0];o=r[1];u=i[1];e=u[0];t=u[1];n.moveTo(f,o);n.lineTo(e,t===o&&e===f?t+.01:t)},t.prototype.pickStrokeLocal=function(n,t){return this.isOverLine([n,t],this.points[0],this.points[1])},t.prototype.rectangleContains=function(n){return Geometry.pointInRectangle(this.points[0],n)||Geometry.pointInRectangle(this.points[1],n)},t.prototype.rectangleOverLine=function(n){return Geometry.lineOverRectangle(this.points[0],this.points[1],n)},t}(DrawObject);extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};hasProp={}.hasOwnProperty;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawLine=ref.DrawLine;("undefined"!=typeof window&&null!==window?window:module.exports).DrawRectangle=DrawRectangle=function(n){function t(){var n,i,r,u,f,e,o;t.__super__.constructor.apply(this,arguments);n=this.points;i=n[0];u=i[0];e=i[1];r=n[1];f=r[0];o=r[1];this.points.push([f,e],[u,o])}return extend(t,n),t.prototype.type="Rectangle",t.prototype.update=function(n,i){var r,u,f;r=this.points[0];u=r[0];f=r[1];this.points[2]=[n,f];this.points[3]=[u,i];this.setPointChanged(2,3);t.__super__.update.apply(this,arguments)},t.prototype.makePath=function(n){var t,i,r,u,f,e,s,h,c,o,l,a,v;n.beginPath();t=this.points;i=t[0];e=i[0];o=i[1];r=t[1];s=r[0];l=r[1];u=t[2];h=u[0];a=u[1];f=t[3];c=f[0];v=f[1];n.moveTo(e,o);n.lineTo(h,a);n.lineTo(s,l);n.lineTo(c,v);n.lineTo(e,o);n.closePath()},t.prototype.pickStrokeLocal=function(n,t){var i,u,f,e,o,r;return i=[n,t],r=this.points,u=r[0],f=r[1],e=r[2],o=r[3],this.isOverLine(i,u,e)||this.isOverLine(i,e,f)||this.isOverLine(i,f,o)||this.isOverLine(i,o,u)},t.prototype.pickFillLocal=function(n,t){var f,r,o,i,u,e;for(u=[this.points[0],this.points[2],this.points[1],this.points[3]],r=u[u.length-1],e=0,t+=1e-5,f=0,o=u.length;o>f;f++)i=u[f],r[1]<=t?i[1]>t&&Geometry.isLeft(r,i,[n,t])&&e++:i[1]<=t&&Geometry.isLeft(i,r,[n,t])&&e--,r=i;return 0!==e},t.prototype.rectangleContains=function(n){return t.__super__.rectangleContains.apply(this,arguments)||Geometry.pointInRectangle(this.points[2],n)||Geometry.pointInRectangle(this.points[3],n)},t.prototype.rectangleOverLine=function(n){var i,r,u,f,t;return t=this.points,i=t[0],r=t[1],u=t[2],f=t[3],Geometry.lineOverRectangle(i,u,n)||Geometry.lineOverRectangle(u,r,n)||Geometry.lineOverRectangle(r,f,n)||Geometry.lineOverRectangle(f,i,n)},t}(DrawLine);var DrawEllipse,DrawRectangle,Geometry,ref,extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},hasProp={}.hasOwnProperty,slice=[].slice;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawRectangle=ref.DrawRectangle;("undefined"!=typeof window&&null!==window?window:module.exports).DrawEllipse=DrawEllipse=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}var i,u,r;return extend(t,n),t.prototype.type="Ellipse",t.prototype.curves=[],i=.2238576,u=.7761424,r=function(n,t,r){var h,c,f,l,e,o,a,s;return f=n[0],o=n[1],l=t[0],a=t[1],e=r[0],s=r[1],[[(h=u*f)+i*l,(c=u*o)+i*a],[h+i*e,c+i*s],[(f+e)/2,(o+s)/2]]},t.prototype.makeCurves=function(){var n,u,f,t,i;4===this.points.length&&(i=this.points,n=i[0],u=i[1],f=i[2],t=i[3],this.curves=[[(n[0]+t[0])/2,(n[1]+t[1])/2]].concat(slice.call(r(n,t,f)),slice.call(r(f,n,u)),slice.call(r(u,f,t)),slice.call(r(t,u,n))))},t.prototype.makePath=function(n){this.makeCurves();Geometry.makeCurvesPath(n,this.curves)},t.prototype.rebound=function(){return this.makeCurves(),t.__super__.rebound.apply(this,arguments)},t.prototype.calculateBounds=function(){return this.curves.length?void(this.bounds=Geometry.calculateCurvesBounds(this.curves)):t.__super__.calculateBounds.apply(this,arguments)},t.prototype.pickStrokeLocal=function(n,t){for(var r,o,s,u,h,c,f,l,a,e,v,y,p,i=p=0,w=this.curves.length-4;w>=p;i=p+=3)if(r=this.curves[i],o=r[0],s=r[1],u=this.curves[i+1],h=u[0],c=u[1],f=this.curves[i+2],l=f[0],a=f[1],e=this.curves[i+3],v=e[0],y=e[1],this.isOver(Math.min(o,h,l,v)-n)&&this.isOver(Math.min(s,c,a,y)-t)&&this.isOver(n-Math.max(o,h,l,v))&&this.isOver(t-Math.max(s,c,a,y))&&this.isOver(Geometry.distanceFromBezier([n,t],[r,u,f,e])))return!0;return!1},t.prototype.pickFillLocal=function(n,t){var r,s,e,u,c,f,i,h,l,a,v,y,o;for(i=this.curves,u=i[i.length-1],o=0,t+=1e-5,r=s=0,l=i.length-2;l>=s;r=s+=3)if(u[0]<n&&i[r][0]<n&&i[r+1][0]<n&&i[r+2][0]<n&&i[r+3][0]<n||u[1]<t==(y=i[r][1]<t)&&y===(v=i[r+1][1]<t)&&v===(a=i[r+2][1]<t)&&a===i[r+3][1]<t)u=i[r+3];else for(h=Geometry.bezierPoints([i[r],i[r+1],i[r+2],i[r+3]]),e=0,c=h.length;c>e;e++)f=h[e],u[1]<=t?f[1]>t&&Geometry.isLeft(u,f,[n,t])&&o++:f[1]<=t&&Geometry.isLeft(f,u,[n,t])&&o--,u=f;return 0!==o},t.prototype.rectangleContains=function(n){for(var i,t=i=0,r=this.curves.length;r>=i;t=i+=3)if(Geometry.pointInRectangle(this.curves[t],n))return!0;return!1},t.prototype.rectangleOverLine=function(n){var o,t,r,f,e,i,u,s,h;for(i=this.curves,t=f=0,s=i.length-2;s>=f;t=f+=3)if(o=Geometry.bounding(i[t],i[t+1],i[t+2],i[t+3]),Geometry.rectangleOverRectangle(n,o))for(u=Geometry.bezierPoints([i[t],i[t+1],i[t+2],i[t+3]]),r=e=1,h=u.length-1;h>=e;r=e+=1)if(Geometry.lineOverRectangle(u[r-1],u[r],n))return!0;return!1},t}(DrawRectangle);extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};hasProp={}.hasOwnProperty;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawObject=ref.DrawObject;MyMath=ref.MyMath;("undefined"!=typeof window&&null!==window?window:module.exports).DrawFreehand=DrawFreehand=function(n){function t(n,i,r){this.raw=[];this.points=[];this.lastRawLength=0;this.fixedLength=1;this.lastSerialized=0;this.minStep=1e20;this.lastHat=[0,0];this.lastPointTime=new Date/1;this.pathCache=null;null!=n&&null!=i&&(this.raw.push([n,i]),this.points.push([n,i],[n,i],[n,i],[n,i]));t.__super__.constructor.call(this,r)}return extend(t,n),t.prototype.type="Freehand",t.prototype.lineJoin="round",t.prototype.calculateBounds=function(){var n;if(this.points.length<4)return t.__super__.calculateBounds.call(this);try{this.bounds=Geometry.calculateCurvesBounds(this.points)}catch(i){n=i;console.log(n)}},t.prototype.setStyle=function(n){return null!=n.strokeWidth&&(this.pathCache=null),t.__super__.setStyle.apply(this,arguments)},t.prototype.update=function(n,t){var l,r,c,i,u,f,e,o,s,h;i=this.raw;r=i.length;c=new Date/1;r>1?(f=i[r-1][0]-i[r-2][0],e=i[r-1][1]-i[r-2][1],s=n-i[r-1][0],h=t-i[r-1][1],u=Math.sqrt(f*f+e*e),o=Math.sqrt(s*s+h*h),this.minStep=Math.min(this.minStep,o),u>0&&o>0?(l=Math.acos((f*s+e*h)/(u*o)),l>.1*Math.PI&&c-this.lastPointTime>50&&(i.push(i[r-1]),i.push([n,t]),r+=2),u>1.5*this.minStep?i.push([n,t]):i[r-1]=[n,t]):i[r-1]=[n,t]):i.push([n,t]);this.lastPointTime=c;this.raw=i;this.updateBezier()},t.prototype.applyTransform=function(){t.__super__.applyTransform.apply(this,arguments);this.pathCache=null},t.prototype.updateBezier=function(){var i,e,s,r,u,n,t,h,o,f,c,l;for(t=this.raw,n=this.rawPoints,s=t.length,i=e=1,h=s-1;h>=e;i=e+=1)if(t[i][0]===t[i-1][0]&&t[i][1]===t[i-1][0]){c=t.splice(0,i);l=Geometry.linesToBezier(c,this.lastHat);n=n.slice(0,this.fixedLength-1).concat(l);this.fixedLength=n.length;this.lastSerialized>this.fixedLength&&(this.lastSerialized=this.fixedLength);this.lastRawLength=t.length;this.lastHat=[0,0];break}for(r=Geometry.linesToBezier(t,this.lastHat),n.length<4?(n=r,this.lastSerialized=0):(this.lastSerialized>this.fixedLength&&(this.lastSerialized=this.fixedLength),r.length>4&&t.length>3&&(this.fixedLength+=3,t.splice(0,this.lastRawLength-1),this.lastHat=Geometry.v2Normalize(Geometry.v2Sub(n[this.fixedLength-2],n[this.fixedLength-1])),r=Geometry.linesToBezier(t,this.lastHat)),n=n.slice(0,this.fixedLength-1).concat(r)),i=u=o=this.lastSerialized,f=n.length-1;f>=o?f>=u:u>=f;i=f>=o?++u:--u)n[i]=[MyMath.round2(n[i][0]),MyMath.round2(n[i][1])];this.lastRawLength=t.length;this.raw=t;this.points=this.rawPoints=n;this.pathCache=null;this.rebound()},t.prototype.makePath=function(n){Geometry.makeCurvesPath(n,this.points)},t.prototype.makePath2=function(n){var st,y,s,t,f,e,r,ht,tt,p,it,o,rt,h,c,l,w,u,ut,ft,ct,lt,at,vt,et,b,i,a,ot,k,d,v,g,nt;if(o=this.points,s=.5*this.style.strokeWidth,!this.pathCache){for(w=[],y=[],u=[],t=tt=1,ct=o.length-1;ct>=tt;t=tt+=3)u=u.concat(Geometry.bezierPoints(o.slice(t-1,t+3)));if(u.length){for(i=[u[0]],r=u[1],p=0,t=it=2,lt=u.length-1;lt>=it;t=it+=1)k=u[t][0]-r[0],d=u[t][1]-r[1],g=r[0]-i[p][0],nt=r[1]-i[p][1],ot=Math.sqrt(k*k+d*d),v=Math.sqrt(g*g+nt*nt),ot>0&&v>0&&(st=Math.acos((k*g+d*nt)/(ot*v))),(st>.05&&v>2||v>10)&&(i.push(r),p++),r=u[t];for(1===i.length&&i.push([(i[0][0]+r[0])/2,(i[0][1]+r[1])/2]),i.push(r),e=i.length,t=ut=0,at=e-1;at>=ut;t=ut+=1)l=rt=i[t],0===t?(h=i[t+1],c=rt,f=.3):t===e-1?(c=i[t-1],h=rt,f=.3):(h=i[t+1],c=i[t-1],f=7>e||t>2&&e-3>t?1:Math.min(t+1,e-t)/4),a=Geometry.v2Normalize([c[1]-h[1],h[0]-c[0]]),w.push([l[0]+f*s*a[0],l[1]+f*s*a[1]]),y.push([l[0]-f*s*a[0],l[1]-f*s*a[1]]);for(t=ft=vt=y.length-1;ft>=0;t=ft+=-1)w.push(y[t])}this.pathCache=w}for(n.beginPath(),n.moveTo(this.pathCache[0][0],this.pathCache[0][1]),et=this.pathCache,b=0,ht=et.length;ht>b;b++)o=et[b],n.lineTo(o[0],o[1])},t.prototype.prepareDraw=function(){},t.prototype.drawFill=function(n){return this.makePath(n),t.__super__.drawFill.apply(this,arguments)},t.prototype.drawStroke=function(n){this.style.strokeWidth>3||4===this.points.length&&this.points[0][0]===this.points[3][0]&&this.points[0][1]===this.points[3][1]?(this.makePath(n),t.__super__.drawStroke.apply(this,arguments)):(this.makePath2(n),n.fillStyle=null!=this.strokeStyle?this.strokeStyle:this.strokeStyle=DrawObject.makeColor(this.style.strokeColor,this.style.strokeAlpha),n.fill())},t.prototype.drawHighlight=function(n){return this.makePath(n),t.__super__.drawHighlight.apply(this,arguments)},t.prototype.pickStrokeLocal=function(n,t){for(var r,o,s,u,h,c,f,l,a,e,v,y,p,i=p=0,w=this.points.length-4;w>=p;i=p+=3)if(r=this.points[i],o=r[0],s=r[1],u=this.points[i+1],h=u[0],c=u[1],f=this.points[i+2],l=f[0],a=f[1],e=this.points[i+3],v=e[0],y=e[1],this.isOver(Math.min(o,h,l,v)-n)&&this.isOver(Math.min(s,c,a,y)-t)&&this.isOver(n-Math.max(o,h,l,v))&&this.isOver(t-Math.max(s,c,a,y))&&this.isOver(Geometry.distanceFromBezier([n,t],[r,u,f,e])))return!0;return!1},t.prototype.pickFillLocal=function(n,t){var r,u,c,s,f,e,i,h,l,a,v,y,o;for(i=this.points,u=i[i.length-1],o=0,t+=1e-5,r=s=0,l=i.length-2;l>=s;r=s+=3)if(u[0]<n&&i[r][0]<n&&i[r+1][0]<n&&i[r+2][0]<n&&i[r+3][0]<n||u[1]<t==(y=i[r][1]<t)&&y===(v=i[r+1][1]<t)&&v===(a=i[r+2][1]<t)&&a===i[r+3][1]<t)u=i[r+3];else for(h=Geometry.bezierPoints([i[r],i[r+1],i[r+2],i[r+3]]),e=0,c=h.length;c>e;e++)f=h[e],u[1]<=t?f[1]>t&&Geometry.isLeft(u,f,[n,t])&&o++:f[1]<=t&&Geometry.isLeft(f,u,[n,t])&&o--,u=f;return 0!==o},t.prototype.rectangleContains=function(n){for(var i,t=i=0,r=this.points.length;r>=i;t=i+=3)if(Geometry.pointInRectangle(this.points[t],n))return!0;return!1},t.prototype.rectangleOverLine=function(n){var o,t,r,f,e,i,u,s,h;for(i=this.points,t=f=0,s=i.length-2;s>=f;t=f+=3)if(o=Geometry.bounding(i[t],i[t+1],i[t+2],i[t+3]),Geometry.rectangleOverRectangle(n,o))for(u=Geometry.bezierPoints([i[t],i[t+1],i[t+2],i[t+3]]),r=e=1,h=u.length-1;h>=e;r=e+=1)if(Geometry.lineOverRectangle(u[r-1],u[r],n))return!0;return!1},t.prototype.changes=function(){var n;return n=t.__super__.changes.apply(this,arguments),this.lastSerialized!==this.rawPoints.length&&(n._={p0:this.lastSerialized,p:this.rawPoints.slice(this.lastSerialized)},this.lastSerialized=this.rawPoints.length),n},t.prototype.restoreChange=function(n){t.__super__.restoreChange.apply(this,arguments);null!=n._&&(this.points=this.rawPoints=this.rawPoints.slice(0,n._.p0).concat(n._.p));null==n._&&null==n.P&&null==n.M||(this.lastSerialized=this.rawPoints.length,this.pathCache=null);null!=n._&&this.rebound()},t}(DrawObject);extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};hasProp={}.hasOwnProperty;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawObject=ref.DrawObject;DrawRectangle=ref.DrawRectangle;Unicode=ref.Unicode;MyMath=ref.MyMath;("undefined"!=typeof window&&null!==window?window:module.exports).DrawText=DrawText=function(n){function t(){this.setState();t.__super__.constructor.apply(this,arguments)}var e,f,o,s,h,c,l,a,v,y,p,w,b,k,d,i,r,u;return extend(t,n),e="#000",f=1,k="rgba(0,0,255,.2)",b=1.3,u={"true":Unicode.findWBRight,"false":Unicode.findGCBRight},r={"true":Unicode.findWBLeft,"false":Unicode.findGCBLeft},i=null,"undefined"!=typeof document&&null!==document&&(d=document.createElement("canvas"),i=d.getContext("2d")),t.KB=[o=8,y=33,v=34,c=35,l=36,a=37,w=38,p=39,h=40,s=46],t.prototype.type="Text",t.prototype.changeCaller=!0,t.prototype.canDelete=!0,t.prototype.fixOrientation=function(){var r,u,n,t,f,e,i;i=this.rawPoints;n=i[0];t=i[1];f=i[2];e=i[3];r=n[0]>t[0];u=n[1]>t[1];r&&u?this.rawPoints=[t,n,e,f]:r?this.rawPoints=[f,e,n,t]:u&&(this.rawPoints=[e,f,t,n]);(r||u)&&this.setPointChanged(0,1,2,3);this.points=this.rawPoints.slice(0)},t.prototype.repair=function(){return this.allowAutosize=!0,this.reMeasure=!0,this.autosize=this.isAutosizeAllowed(),t.__super__.repair.apply(this,arguments)},t.prototype.getState=function(){return this.reMeasure&&this.measure(),{text:this.text,points:this.rawPoints.slice(0),minHeight:this.minHeight,caretFrom:this.caret.from,caretTo:this.caret.to}},t.prototype.setState=function(n){this.lines=[];this.lastLines=[];this.reLines=!1;this.reMeasure=!0;this.autosize=!1;this.updateMinHeight=!1;null!=n?(this.rawPoints=n.points.slice(0),this.setPointChanged(0,1,2,3),this.text=n.text,this.minHeight=n.minHeight,this.resetCaret(n.caretFrom,n.caretTo),this.reMeasureCaret=!0,this.changed.text=!0,this.changed.minHeight=!0,this.refreshPoints(),this.allowAutosize=!0):(this.text="",this.lastText="",this.minHeight=0,this.resetCaret(0,0))},t.prototype.resetCaret=function(n,t){return null==n&&(n=0),null==t&&(t=0),this.caret={from:n,to:t,start:{line:0,pos:0},end:{line:0,pos:0}}},t.prototype.update=function(){t.__super__.update.apply(this,arguments);this.autosize=this.isAutosizeAllowed();this.updateMinHeight=!0;this.reMeasure=!0;this.changed.minHeight=!0;this.autosize||(this.canDelete=!1)},t.prototype.scale=function(){var n;t.__super__.scale.apply(this,arguments);this.reMeasure=!0;this.updateMinHeight=!0;n=Geometry.distanceFromPoint(this.points[0],this.points[3])},t.prototype.applyTransform=function(){t.__super__.applyTransform.apply(this,arguments);this.reMeasure||this.updateTextLocation()},t.prototype.isAutosizeAllowed=function(){return""===this.text&&Geometry.distanceFromPoint(this.points[0],this.points[2])<3*this.style.textSize},t.prototype.callChange=function(){},t.prototype.insertText=function(n){var t,i,r;this.autosize&&(n.length>1&&-1!==n.indexOf("\n")||n.length>20)&&(this.pasteEndAutosize=!0);i=MyMath.minmax(this.caret.from,this.caret.to);t=i[0];r=i[1];this.text=this.text.substr(0,t)+n+this.text.substr(r);this.caret.to=this.caret.from=t+n.length;this.reMeasure=!0;this.changed.text=!0;this.allowAutosize=!0;this.canDelete=!1},t.prototype.setStyle=function(n){var r,i,f,u,e;for(r=!1,u=["font","textSize","textColor","textAlpha"],i=0,f=u.length;f>i;i++)e=u[i],r|=this.trySetStyle(e,n);return(r||null!=n.strokeWidth)&&(this.reMeasure=this.allowAutosize=!0),t.__super__.setStyle.apply(this,arguments)},t.prototype.selectedText=function(){return this.text.substring(this.caret.from,this.caret.to)},t.prototype.selectAll=function(){this.caret.from=0;this.caret.to=this.text.length;this.reMeasureCaret=!0},t.prototype.handleKeyDown=function(n,t){var k,b,i,nt,d,g,rt,f,e,tt,it;switch(k=t.ctrl,f=t.shift,rt=MyMath.minmax(this.caret.from,this.caret.to),i=rt[0],e=rt[1],n){case o:return i===e&&(i=r[k](this.text,i)),this.text=this.text.substr(0,i)+this.text.substr(e),this.caret.from=this.caret.to=i,this.reMeasure=!0,this.changed.text=!0,this.allowAutosize=!0,!0;case s:return i===e&&(e=u[k](this.text,e)),this.text=this.text.substr(0,i)+this.text.substr(e),this.caret.from=this.caret.to=i,this.reMeasure=!0,this.changed.text=!0,this.allowAutosize=!0,!0;case y:return this.caret.to=0,f||(this.caret.from=0),void(this.reMeasureCaret=!0);case v:return this.caret.to=this.text.length,f||(this.caret.from=this.caret.to),void(this.reMeasureCaret=!0);case c:return k?(this.caret.to=this.text.length,f||(this.caret.from=this.caret.to)):(f||this.caret.from<=this.caret.to?(d=this.caret.end,g=this.caret.to):(d=this.caret.start,g=this.caret.from),nt=d.line,this.caret.to=g+this.lines[nt].text.length-d.pos-(this.lines[nt].forced||nt>this.lines.length-2?0:1),f||(this.caret.from=this.caret.to)),void(this.reMeasureCaret=!0);case l:return k?(this.caret.to=0,f||(this.caret.from=0)):(f||this.caret.from>this.caret.to?(d=this.caret.end,g=this.caret.to):(d=this.caret.start,g=this.caret.from),nt=d.line,this.caret.to=g-d.pos,f||(this.caret.from=this.caret.to)),void(this.reMeasureCaret=!0);case a:return f?i=r[k](this.text,this.caret.to):i===e&&(i=r[k](this.text,i)),this.caret.to=i,f||(this.caret.from=i),void(this.reMeasureCaret=!0);case w:return this.caret.end.line<1?void 0:(b=this.caret.end,tt=b.pos?this.lines[b.line].chars[b.pos-1]:0,it=(b.line-.5)*this.lineHeight,this.caret.to=this.coordsToCaret(tt,it),f||(this.caret.from=this.caret.to),void(this.reMeasureCaret=!0));case p:return f?e=u[k](this.text,this.caret.to):i===e&&(e=u[k](this.text,e)),this.caret.to=e,f||(this.caret.from=e),void(this.reMeasureCaret=!0);case h:return this.caret.end.line>this.lines.length-2?void 0:(b=this.caret.end,tt=b.pos?this.lines[b.line].chars[b.pos-1]:0,it=(b.line+1.5)*this.lineHeight,this.caret.to=this.coordsToCaret(tt,it),f||(this.caret.from=this.caret.to),void(this.reMeasureCaret=!0))}},t.prototype.coordsToCaret=function(n,t){var r,i,o,s,v,y,u,f,e,h,c,l,a;if(e=Math.floor(t/this.lineHeight),0>e)return 0;if(e>this.lines.length-1)return this.text.length;for(u=0,l=this.lines,r=o=0,v=l.length;v>o;r=++o){if(f=l[r],r===e){for(c=0,a=f.chars,i=s=0,y=a.length;y>s;i=++s){if(h=a[i],(h+c)/2-1>n)return Unicode.findGCBRight(this.text,u+i-1);c=h}return u+i-(f.forced?0:1)}u+=f.text.length}return this.text.length},t.prototype.mouseFix=function(n,t){var i;return i=Geometry.transformPoint([n-this.x0,t-this.y0],this.contentTransformInverse),n=i[0],t=i[1],[n-this.paddingLR,t-this.paddingTB]},t.prototype.mousedown=function(n,t,i){var r;null==i&&(i={});r=this.mouseFix(n,t);n=r[0];t=r[1];this.caret.to=this.coordsToCaret(n,t);i.shift||(this.caret.from=this.caret.to);this.reMeasureCaret=!0},t.prototype.mousemove=function(n,t){var i;i=this.mouseFix(n,t);n=i[0];t=i[1];this.caret.to=this.coordsToCaret(n,t);this.reMeasureCaret=!0},t.prototype.mouseup=function(n,t){var i;i=this.mouseFix(n,t);n=i[0];t=i[1]},t.prototype.doubleClick=function(n,t){var i,r;r=this.mouseFix(n,t);n=r[0];t=r[1];i=this.coordsToCaret(n,t);this.caret.from=Unicode.findWBLeft(this.text,i);this.caret.to=Unicode.findWBRight(this.text,i);this.reMeasureCaret=!0},t.prototype.canPickFill=function(){return!0},t.prototype.prepareDraw=function(){return this.reMeasure&&this.measure(),t.__super__.prepareDraw.apply(this,arguments)},t.prototype.drawExtra=function(n,t){var e,i,o,r,h,w,b,u,l,a,v,f,c,s,y,p;for(this.reMeasure&&this.measure(),this.reMeasureCaret&&this.measureCaret(),u=this.lineHeight,n.save(),n.translate(this.x0,this.y0),n.transform.apply(n,this.contentTransform),n.translate(this.paddingLR,this.paddingTB),t.highlight&&(e=this.caret,e.from!==e.to&&(f=e.start,i=e.end,y=this.width-2*this.paddingLR,n.beginPath(),c=f.pos?this.lines[f.line].chars[f.pos-1]:0,s=f.line*u,o=i.pos?this.lines[i.line].chars[i.pos-1]:0,r=(i.line+1)*u,a=s+u,l=r-u,n.moveTo(c,s),i.line===f.line?(n.lineTo(o,s),n.lineTo(o,r),n.lineTo(c,r)):(n.lineTo(y,s),n.lineTo(y,l),n.lineTo(o,l),n.lineTo(o,r),n.lineTo(0,r),n.lineTo(0,a),n.lineTo(c,a)),n.closePath(),n.fillStyle=k,n.fill())),p=this.style.textSize,n.font=this.style.textSize+'px "'+this.style.font+'"',n.fillStyle=null!=this.textStyle?this.textStyle:this.textStyle=DrawObject.makeColor(this.style.textColor,this.style.textAlpha),v=this.lines,h=0,w=v.length;w>h;h++)b=v[h],n.fillText(b.text,0,p),p+=u;n.restore()},t.prototype.drawCaret=function(n){var t,i;this.reMeasure&&this.measure();this.reMeasureCaret&&this.measureCaret();n.save();n.translate(this.x0,this.y0);n.transform.apply(n,this.contentTransform);n.translate(this.paddingLR,this.paddingTB);t=(this.caret.end.pos?this.lines[this.caret.end.line].chars[this.caret.end.pos-1]:0)+f/2;i=this.lineHeight*this.caret.end.line;n.beginPath();n.moveTo(t,i);n.lineTo(t,i+this.lineHeight);n.lineWidth=f;n.lineCap="butt";n.strokeStyle=e;n.stroke();n.restore()},t.prototype.updateTextLocation=function(){var o,u,f,n,t,r,i,e;i=this.points;n=i[0];o=i[1];t=i[2];r=i[3];this.x0=n[0];this.y0=n[1];this.width=Geometry.distanceFromPoint(n,t);this.height=Geometry.distanceFromPoint(n,r);this.width&&this.height?(u=Geometry.angleBetweenVectors(n,[this.x0+1,this.y0],t),f=Math.PI/2-Geometry.angleBetweenVectors(n,t,r)):(u=0,f=0);e=Geometry.angleBetweenVectors(n,t,r)<0?[1,0,0,-1,0,0]:[1,0,0,1,0,0];this.contentTransform=Geometry.transform(Geometry.rotateMatrix(u),Geometry.skewXMatrix(f),e);this.contentTransformInverse=Geometry.inverseMatrix(this.contentTransform)},t.prototype.measure=function(){var v,y,o,p,s,rt,w,r,bt,u,ut,l,k,ft,kt,dt,n,et,d,g,c,ot,f,a,st,ri,e,ht,ct,lt,ui,gt,fi,ni,at,vt,ti,yt,nt,ii,t,h,pt,tt,wt,it;if(this.reMeasure=!1,this.reMeasureCaret=!0,i){if(s=i,s.font=this.style.textSize+'px "'+this.style.font+'"',this.lineHeight=Math.round(this.style.textSize*b),this.paddingTB=Math.ceil(this.style.strokeWidth/2+this.style.textSize/8),this.paddingLR=Math.ceil(this.style.strokeWidth/2+this.style.textSize/4),this.updateTextLocation(),d=this.autosize?99999:this.width-2*this.paddingLR,e=0,this.lines=[],n={},ut=function(){return function(){return n={text:"",chars:[]}}}(this),c=function(t){return function(){return t.lines.push(n),ut()}}(this),ut(),v=!1,y=0,this.allowAutosize&&this.autosize&&(ii=this.text.length-1,"\n"===this.text[ii]&&(v=!0),this.pasteEndAutosize&&(d=400,v=!0)),this.reLines){for(this.reLines=!1,ht=this.lastLines,k=0,kt=ht.length;kt>k;k++){for(r=ht[k],(n.forced=0>r)&&(r=-r),u=ft=ui=e,gt=e+r;gt>ft;u=ft+=1)n.chars.push(s.measureText(n.text+=this.text[u]).width);e+=r;c()}for(u=et=fi=e,ni=this.text.length;ni>et;u=et+=1)n.chars.push(s.measureText(n.text+=this.text[u]).width);n.forced=!0;c()}else for(at=Unicode.findLBRPoints(this.text+"\n"),g=0,dt=at.length;dt>g;g++){for(vt=at[g],r=vt[0],bt=vt[1],f=this.text.slice(e,r),h=s.measureText(n.text+f).width,n.text&&h>d&&c(),ot=0,u=st=1,ti=r-e;ti>=st;u=st+=1)l=u-ot,h=s.measureText(n.text+f.substr(0,l)).width,l>1&&h>d&&(n.text+=f.substr(0,l-1),n.forced=!0,c(),f=f.substr(l-1),ot=u-1,h=s.measureText(f.substr(0,1)).width),n.chars.push(h);n.text+=f;e=r;y=Math.max(y,h);bt&&c()}if(yt=t=Geometry.transformPoints(this.points,this.contentTransformInverse),ct=yt[0],pt=ct[0],wt=ct[1],lt=yt[1],tt=lt[0],it=lt[1],this.updateMinHeight&&(this.minHeight=Geometry.distanceFromPoint(t[0],t[3]),this.changed.minHeight=!0,this.updateMinHeight=!1),this.allowAutosize&&(p=!1,o={},nt=!1,this.autosize&&(w=y+2*this.paddingLR,w!==this.width&&(this.width=w,o[1]=t[1]=[tt=pt+w,it],o[2]=t[2]=[tt,wt],nt=!0),v&&(this.autosize=!1),p=!0),rt=Math.ceil(this.lines.length*this.lineHeight+2*this.paddingTB),rt!==this.height&&(this.height=Math.max(this.minHeight,rt),o[1]=t[1]=[tt,it=wt+this.height],o[3]=t[3]=[pt,it],nt=p=!0),this.allowAutosize=!1,p)){if(nt){this.transform&&(t=Geometry.transformPoints(t,this.contentTransform),t=Geometry.transformPoints(t,Geometry.inverseMatrix(this.transform)));for(a in o)ri=o[a],this.rawPoints[a]=t[a],this.setPointChanged(a);this.refreshPoints()}this.callChange(!0)}}},t.prototype.measureCaret=function(){var e,t,i,n,o,c,r,s,u,f,h;for(this.reMeasureCaret=!1,r=u=0,i=t=!1,h=this.lines,n=o=0,c=h.length;c>o;n=++o){if(s=h[n],u=s.text.length,e=s.forced?1:0,f=r+u,!i&&(i=f+e>this.caret.from)&&(this.caret.start.line=n,this.caret.start.pos=this.caret.from-r),!t&&(t=f+e>this.caret.to)&&(this.caret.end.line=n,this.caret.end.pos=this.caret.to-r),i&&t)return;r=f}i||(this.caret.start.line=n-1,this.caret.start.pos=u);t||(this.caret.end.line=n-1,this.caret.end.pos=u)},t.prototype.serialize=function(){var n;return this.reMeasure&&this.measure(),n=t.__super__.serialize.apply(this,arguments),n.t=this.text,n.l=this.lineLengths(),this.minHeight>0&&(n.h=this.minHeight),null==n.S&&(n.S={}),this.style.font!==DrawObject.defaultStyle.font&&(n.S.f=this.style.font),this.style.textSize!==DrawObject.defaultStyle.textSize&&(n.S.s=this.style.textSize),idroo.utils.colorsEqual(this.style.textColor,DrawObject.defaultStyle.textColor)||(n.S.c=this.style.textColor),this.style.textAlpha!==DrawObject.defaultStyle.textAlpha&&(n.S.a=this.style.textAlpha),n},t.prototype.lineLengths=function(){var n,u,i,t,r;for(t=[],r=this.lines,n=0,u=r.length;u>n;n++)i=r[n],t.push(i.chars.length*(i.forced?-1:1));return t.pop(),t},t.prototype.changes=function(){var f,e,o,r,u,s,n,i;if(this.reMeasure&&this.measure(),n=t.__super__.changes.apply(this,arguments),null!=this.changed.style&&(null==n.S&&(n.S={}),null!=this.changed.style.font&&(n.S.f=this.style.font),null!=this.changed.style.textSize&&(n.S.s=this.style.textSize),null!=this.changed.style.textColor&&(n.S.c=this.style.textColor),null!=this.changed.style.textAlpha&&(n.S.a=this.style.textAlpha)),null!=this.changed.minHeight&&(n.h=this.minHeight),null!=this.changed.text&&this.text!==this.lastText){for(i=0,u=this.lastText.length-1,r=this.text.length-1;u>=i&&r>=i&&this.lastText[i]===this.text[i];)i++;for(;u>=i&&r>=i&&this.lastText[u]===this.text[r];)u--,r--;u++;r++;this.lastText=this.text;n._={p:i,l:u-i,s:this.text.substr(i,r-i)}}if(this.lines.length!==this.lastLines.length+1)n.l=this.lastLines=this.lineLengths();else for(f=e=0,s=this.lines.length;s>e;f=e+=1)if(o=this.lines[f].chars.length,o!==this.lastLines[f]&&-o!==this.lastLines[f]){n.l=this.lastLines=this.lineLengths();break}return n},t.prototype.restoreChange=function(n){var i;t.__super__.restoreChange.call(this,n);null!=n.S&&(null!=n.S.f&&(this.style.font=n.S.f),null!=n.S.s&&(this.style.textSize=n.S.s),null==n.S.c&&null==n.S.a||(null!=n.S.c&&(this.style.textColor=n.S.c),null!=n.S.a&&(this.style.textAlpha=n.S.a),this.textStyle=null));null!=n.t&&(this.lastText=this.text=n.t);null!=n._&&(this.lastText=this.text=this.text.substr(0,n._.p)+n._.s+this.text.substr(n._.p+n._.l));null!=n.l&&(this.lastLines=n.l);null!=n.h&&(this.minHeight=n.h,this.updateMinHeight=!1);this.reLines=!0;this.reMeasure=!0;null==n.t&&null==n._||(this.autosize=this.isAutosizeAllowed());null!=(null!=(i=n.S)?i.f:void 0)&&"undefined"!=typeof Fonts&&null!==Fonts&&Fonts.unlessLoaded(this.style.font,function(n){return function(){return n.measure(),n.callChange()}}(this));this.canDelete=!1},t}(DrawRectangle);extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};hasProp={}.hasOwnProperty;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawRectangle=ref.DrawRectangle;ImageLoader=ref.ImageLoader;("undefined"!=typeof window&&null!==window?window:module.exports).DrawImage=DrawImage=function(n){function t(){t.__super__.constructor.apply(this,arguments);this.img="undefined"!=typeof document&&null!==document?document.createElement("img"):{}}return extend(t,n),t.prototype.type="Image",t.prototype.changeCaller=!0,t.prototype.source="",t.prototype.setSource=function(n,t){null==t&&(t=!0);this.img.src=this.source=n;t&&(this.changed.source=!0);this.img.onload=function(n){return function(){n.callChange()}}(this)},t.prototype.callChange=function(){},t.prototype.canPickFill=function(){return!0},t.prototype.refreshPoints=function(){t.__super__.refreshPoints.apply(this,arguments);this.calculateTransform()},t.prototype.calculateTransform=function(){var u,f,n,e,t,r,i,o;i=this.points;n=i[0];e=i[1];t=i[2];r=i[3];this.imageWidth=Geometry.distanceFromPoint(n,t);this.imageHeight=Geometry.distanceFromLine(n,r,e,!0);this.imageWidth&&this.imageHeight?(u=Geometry.angleBetweenVectors(n,[n[0]+1,n[1]],t),f=Math.PI/2-Geometry.angleBetweenVectors(n,t,r)):(u=0,f=0);o=Geometry.angleBetweenVectors(n,t,r)<0?[1,0,0,-1,0,0]:[1,0,0,1,0,0];this.imageTransform=Geometry.transform(Geometry.rotateMatrix(u),Geometry.skewXMatrix(f),o)},t.prototype.drawExtra=function(n,t){var i,r;if(null==t&&(t={}),this.source){n.save();n.translate.apply(n,this.points[0]);this.imageTransform||this.refreshPoints();n.transform.apply(n,this.imageTransform);try{if("undefined"!=typeof window&&null!==window){try{n.drawImage(this.img,0,0,this.imageWidth,this.imageHeight)}catch(u){r=u}n.restore()}else i=function(){return function(){}}(this),this.waitDraw=function(){return function(n){i=n}}(this),ImageLoader.load(this.source,function(t){return function(r,u){r?console.log(r):u&&n.drawImage(u,0,0,t.imageWidth,t.imageHeight);delete t.waitDraw;n.restore();i()}}(this))}catch(u){r=u;console.log(r)}}},t.prototype.serialize=function(){var n;return n=t.__super__.serialize.apply(this,arguments),n.s=this.source,n},t.prototype.changes=function(){var n;return n=t.__super__.changes.apply(this,arguments),null!=this.changed.source&&(n.s=this.source,n._=!0),n},t.prototype.restoreChange=function(n){t.__super__.restoreChange.apply(this,arguments);null!=n.s&&this.setSource(n.s,!1)},t}(DrawRectangle);var AJson,DrawFormula,DrawObject,DrawRectangle,Geometry,MyMath,Unicode,ref,extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},hasProp={}.hasOwnProperty,slice=[].slice;ref="undefined"!=typeof window&&null!==window?window:require("./classes");Geometry=ref.Geometry;DrawObject=ref.DrawObject;DrawRectangle=ref.DrawRectangle;MyMath=ref.MyMath;AJson=ref.AJson;Unicode=ref.Unicode;("undefined"!=typeof window&&null!==window?window:module.exports).DrawFormula=DrawFormula=function(n){function t(){this.setState();t.__super__.constructor.apply(this,arguments)}var ut,vt,yt,oi,si,hi,ci,li,ai,vi,w,a,o,g,it,b,s,nt,r,c,l,v,i,yi,ft,pi,wi,pt,wt,bi,ki,di,gi,nr,tr,ir,rr,ur,e,fr,et,ot,st,bt,ht,ct,kt,rt,dt,gt,er,or,ni,lt,sr,ti,ii,ri,ui,lr,h,u,k,hr,cr,f,p,y,at,fi,d,tt,ei;return extend(t,n),hi="#000",ai=1,ci=1.1,li=-.6,er="rgba(0,0,255,.2)",yi="rgba(0,0,0,.08)",vi="rgba(200,0,0,.1)",h=-.1,e=1.3,lr=1,gt="⬚",rt=.1,dt=.2,si=.75,k=20,u=.71,ft=1.6,pi=.2,wi=.5,or=.5,r=0,i=1,s=2,g=3,o=4,c=5,l=6,v=7,nt=8,it=9,b=10,a=11,w=12,ii=0,ui=1,lt=2,ri=3,ti=4,sr=5,at=1/18,fi=2/18,d=4/18,tt=5/18,ni=[[at,0,d,tt,fi,0],[0,0,d,0,0,0],[d,d,0,0,d,0],[tt,tt,0,0,tt,0],[0,0,0,0,0,0],[fi,at,d,tt,at,0]],vt={"*":"∗","-":"−","...":"…",":":"∶","'":"′","!!":"‼"},yt={"∶∶":"∷","∶=":"≔","<=":"≤",">=":"≥","<<":"≪",">>":"≫","−>":"→","+−":"±","−+":"∓"},oi={"∶":1,"=":1,"<":1,">":1,"−":1,"+":1},hr={0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",A:"",B:"",C:"",D:"",E:"",F:"",G:"",H:"",I:"",J:"",K:"",L:"",M:"",N:"",O:"",P:"",Q:"",R:"",S:"",T:"",U:"",V:"",W:"",X:"",Y:"",Z:"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"ℎ",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:""},ei=function(n){var i,t,u,f,r;for(r="",t=0,u=n.length;u>t;t++)i=n[t],r+=null!=(f=hr[i])?f:i;return r},ut={},f=function(n){var t,i;for(t in n)i=n[t],ut[t]=i;return n},p=function(n,t){var i,r;for(i in t)r=t[i],n[r]=1;return t},kt={"+":1,"−":1,"∓":1,"±":1},et={"<":1,"=":1,">":1},p(et,f({ast:"∗",bullet:"∙",cap:"∩",cdot:"⋅",circ:"∘",cup:"∪",diamond:"⋄",div:"÷",mp:"∓",pm:"±",odot:"⊙",ominus:"⊖",oplus:"⊕",oslash:"⊘",otimes:"⊗",sdivide:"⁄",setminus:"∖",sqcap:"⊓",sqcup:"⊔",star:"⋆",times:"×",uplus:"⊎",vee:"∨",wedge:"∧",wr:"≀"})),ht={"∷":1,"≔":1},p(ht,f({angle:"∠",approx:"≈",asymp:"≍",because:"∵",bot:"⊥",bowtie:"⋈",cong:"≅",dashv:"⊣",ddots:"⋱",doteq:"≐",downarrow:"↓",Downarrow:"⇓",equiv:"≡",ge:"≥",geq:"≥",gets:"←",gg:"≫",hookleftarrow:"↩",hookrightarrow:"↪","in":"∈",le:"≤",leftarrow:"←",Leftarrow:"⇐",leftharpoondown:"↽",leftharpoonup:"↼",leftrightarrow:"↔",Leftrightarrow:"⇔",leq:"≤",ll:"≪",mapsto:"↦",mid:"∣",models:"⊨",ne:"≠",nearrow:"↗",ni:"∋",nwarrow:"↖",parallel:"∥",ratio:"∶",prec:"≺",preceq:"≼",propto:"∝",rddots:"⋰",rightarrow:"→",Rightarrow:"⇒",rightharpoondown:"⇁",rightharpoonup:"⇀",searrow:"↘",sim:"∼",simeq:"≃",sqsubseteq:"⊑",sqsuperseteq:"⊒",subset:"⊂",subseteq:"⊆",succ:"≻",succeq:"≽",superset:"⊃",superseteq:"⊇",swarrow:"↙",therefore:"∴",to:"→",top:"⊤",uparrow:"↑",Uparrow:"⇑",updownarrow:"↕",Updownarrow:"⇕",vdash:"⊢",vdots:"⋮",cdots:"⋯"})),bt={},p(bt,f({int:"∫",iint:"∬",iiint:"∭",iiiint:"⨌",oint:"∮",oiint:"∯",oiiint:"∰",amalg:"∐",prod:"∏",sum:"∑"})),ct={},p(ct,f({emptyset:"∅",exists:"∃",forall:"∀",inc:"∆",nabla:"∇",partial:"∂",neg:"¬"})),fr={},p(fr,f({acute:"́",bar:"̅",Bar:"̿",breve:"̆",check:"̌",ddddot:"⃜",dddot:"⃛",ddot:"̈",dot:"̇",grave:"̀",hat:"̂",hvec:"⃑",tvec:"⃡",vec:"⃗",tilde:"̃"})),st={"|":1},p(st,f({open:"├",lopen:"(",lbrace:"{",lbrack:"[",lceil:"⌈",lfloor:"⌊",bra:"⟨"})),ot={"|":1},p(ot,f({close:"┤",rclose:")",rbrace:"}",rbrack:"]",rceil:"⌉",rfloor:"⌋",ket:"⟩"})),f({zwsp:"​",hairsp:" ",thinsp:" ",medsp:" ",thicksp:" ",vthicksp:" ",ensp:" ",emsp:" ",nbsp:" ",zwnj:"‌"}),f({Alpha:"",alpha:"",Beta:"",beta:"",Gamma:"",gamma:"",Delta:"",delta:"",Epsilon:"",epsilon:"",Zeta:"",zeta:"",Eta:"",eta:"",Theta:"",theta:"",Iota:"",iota:"",Kappa:"",kappa:"",Lambda:"",lambda:"",Mu:"",mu:"",Nu:"",nu:"",Xi:"",xi:"",Omicron:"",omicron:"",Pi:"",pi:"",Rho:"",rho:"",Sigma:"",sigma:"",Tau:"",tau:"",Upsilon:"",upsilon:"",Phi:"",phi:"",Chi:"",chi:"",Psi:"",psi:"",Omega:"",omega:""}),f({A:"",B:"",C:"ℂ",D:"",E:"",F:"",G:"",H:"ℍ",I:"",J:"",K:"",L:"",M:"",N:"ℕ",O:"",P:"ℙ",Q:"ℚ",R:"ℝ",S:"",T:"",U:"",V:"",W:"",X:"",Y:"",Z:"ℤ"}),f({euler:"ℇ",ohm:"Ω",aleph:"ℵ",beth:"ℶ",daleth:"ℸ",ell:"ℓ",gimel:"ℷ",hbar:"ℏ",Im:"ℑ",imath:"ı",jmath:"ȷ",Re:"ℜ",wp:"℘"}),f({sqrt:"√",above:"┴",below:"┬",box:"□",matrix:"■"}),f({atop:"¦",degree:"°",infty:"∞",overbar:"¯",ppprime:"‴",pprime:"″",prime:"′",rect:"▭",underbar:"▁",vbar:"│",Vert:"‖"}),ur={sin:1,cos:1,tan:1,csc:1,sec:1,cot:1,arcsin:1,arccos:1,arctan:1,sinh:1,cosh:1,tanh:1,csch:1,sech:1,coth:1,lim:1,liminf:1,limsup:1,log:1,ln:1,min:1,max:1,deg:1,dim:1,gcd:1,inf:1,sup:1,ker:1,Pr:1},y=null,"undefined"!=typeof document&&null!==document&&(cr=document.createElement("canvas"),y=cr.getContext("2d")),t.KB=[pt=8,tr=33,nr=34,ki=35,di=36,gi=37,rr=38,ir=39,bi=40,wt=46],t.prototype.type="Formula",t.prototype.changeCaller=!0,t.prototype.canDelete=!0,t.prototype.formula=null,t.prototype.measured=null,t.prototype.caret=null,t.prototype.fixOrientation=function(){var r,u,n,t,f,e,i;i=this.rawPoints;n=i[0];t=i[1];f=i[2];e=i[3];r=n[0]>t[0];u=n[1]>t[1];r&&u?this.rawPoints=[t,n,e,f]:r?this.rawPoints=[f,e,n,t]:u&&(this.rawPoints=[e,f,t,n]);(r||u)&&this.setPointChanged(0,1,2,3);this.points=this.rawPoints.slice(0)},t.prototype.repair=function(){return this.reMeasure=!0,t.__super__.repair.apply(this,arguments)},t.prototype.getState=function(){return this.reMeasure&&this.measure(),{text:this.text,points:this.rawPoints.slice(0),caret:{path:this.caret.path.slice(0),from:this.caret.from,to:this.caret.to}}},t.prototype.setState=function(n){this.reMeasure=!0;null!=n?(this.rawPoints=n.points.slice(0),this.setPointChanged(0,1,2,3),this.text=n.text,this.formula=AJson.parse(this.text),this.setCaret(n.caret),this.changed.text=!0,this.refreshPoints()):(this.text="",this.formula=[r,[]],this.lastText="",this.setCaret())},t.prototype.resetCaret=function(){return this.setCaret()},t.prototype.setCaret=function(n){null==n&&(n={path:[],from:0,to:0});this.caret={path:n.path.slice(0),from:n.from,to:n.to}},t.prototype.getFormula=function(n){var t,i,r,u;for(t=this.formula,i=0,r=n.length;r>i;i++)u=n[i],t=t[1][u];return t},t.prototype.getCaretFormula=function(){return this.getFormula(this.caret.path)},t.prototype.moveToStart=function(){this.caret.from=this.caret.to=0;this.caret.path.length=0;this.fixCaret()},t.prototype.moveToEnd=function(){this.caret.from=this.caret.to=this.formula[1].length;this.caret.path.length=0;this.fixCaret()},t.prototype.moveBy=function(n){var t,i,r,u;if(0>n)for(t=r=n;0>t;t+=1)this.moveLeft();else for(i=u=n;i>0;i+=-1)this.moveRight()},t.prototype.moveLeft=function(){var t,c,n,u,e,o,h,f;if(u=function(i){return function(){i.caret.path.push(n-1);i.caret.from=i.caret.to=t[n-1][1].length}}(this),e=c=this.getCaretFormula(),f=e[0],t=e[1],o=this.caret,n=o.from,h=o.to,n===h){if(n>0)switch(f){case i:this.caret.from=this.caret.to-=1+(n>1&&Unicode.isLowSurrogate(t[n-1]));break;case r:switch(t[n-1][0]){case s:this.caret.from=this.caret.to=n-1;break;case i:u();break;default:return u(),this.moveLeft()}break;default:u()}else if(this.caret.path.length&&(this.caret.from=this.caret.to=this.caret.path.pop(),f===i||f===r))return this.moveLeft()}else this.caret.to=n;this.fixCaret()},t.prototype.moveRight=function(){var t,c,n,u,e,o,h,f;if(u=function(t){return function(){t.caret.path.push(n);t.caret.from=t.caret.to=0}}(this),e=c=this.getCaretFormula(),f=e[0],t=e[1],o=this.caret,n=o.from,h=o.to,n===h){if(n<t.length)switch(f){case i:this.caret.from=this.caret.to+=1+(n<t.length-1&&Unicode.isHighSurrogate(t[n]));break;case r:switch(t[n][0]){case s:this.caret.from=this.caret.to=n+1;break;case i:u();break;default:return u(),this.moveRight()}break;default:u()}else if(this.caret.path.length&&(this.caret.from=this.caret.to=this.caret.path.pop()+1,f===i||f===r))return this.moveRight()}else this.caret.from=h;this.fixCaret()},t.prototype.updateSelection=function(n){var c,d,g,f,s,l,e,t,a,nt,tt,it,v,y,p,w,b,rt,ut,h,o,k,u;for(a=this.selectionStartCaret,o=a[0],h=a[1],f=n[0],s=n[1],e=h,u=s,t=0;o[t]===(nt=f[t])&&void 0!==nt;)t++;(tt=this.getFormula(f.slice(0,t))[0])!==r&&tt!==i&&t--;t===(it=o.length)&&it===f.length?(v=MyMath.minmax(e,u),e=v[0],u=v[1]):(y=this.getFormula(o),k=y[0],ut=y[1],p=this.getFormula(f),l=p[0],g=p[1],o.length>t&&(e=o[t],o.length!==t+1||k!==r&&k!==i||(b=h===ut.length,rt=0===h,b&&e++)),f.length>t&&(u=f[t],f.length!==t+1||l!==r&&l!==i||(c=s===g.length,d=0===s,c&&u++)),e>u?(w=[u,e],e=w[0],u=w[1],o.length>t&&!b&&!rt&&u++):u>e?f.length>t&&!c&&!d&&u++:u++);this.caret.path=f.slice(0,t);this.caret.from=e;this.caret.to=u},t.prototype.selectedFormula=function(){var f,n,o,t,e,u,s;return t=this.caret,o=t.path,n=t.from,u=t.to,n===u?null:(e=this.getFormula(o),s=e[0],f=e[1],s===i?[r,[[i,f.slice(n,u)]]]:[r,f.slice(n,u)])},t.prototype.selectedText=function(){return""},t.prototype.callChange=function(){},t.prototype.insertChar=function(n){var at,ei,si,e,hi,ci,u,tt,lt,li,h,ai,rt,y,wt,vi,yi,pi,wi,lr,ri,bi,ki,kr,p,pt,dt,d,t,f,k,ar,di,gi,nr,dr,vr,gr,yr,nu,pr,tr,ni,ti,ir,tu,iu,ru,wr,ft,gt,ui,fi,br,rr,fr,ii,er,or,sr,hr,cr;switch(delete this.caret.confirmRemove,nr=ci=this.getCaretFormula(),er=nr[0],e=nr[1],tr=this.caret,u=tr.from,ii=tr.to,er){case r:return u!==ii&&(e.splice(u,ii-u),ii=u),u>0&&e[u-1][0]===i?(this.caret.path.push(u-1),this.caret.from=this.caret.to=e[u-1][1].length,this.insertChar(n)):u<e.length&&e[u][0]===i?(this.caret.path.push(u),this.caret.from=this.caret.to=0,this.insertChar(n)):(e.splice(u,0,[i,""]),this.caret.path.push(u),this.caret.from=this.caret.to=0,this.insertChar(n));case i:e=e.slice(0,u)+n+e.slice(ii);u+=n.length;for(ft in vt)gt=vt[ft],ft===e.substr(u-ft.length,ft.length)&&(e=e.slice(0,u-ft.length)+gt+e.slice(u),u+=gt.length-ft.length);if((" "===n||"\n"===n)&&(pi=/\\([^ \n]*)[ \n]?$/.exec(e.substr(0,u)))&&(ui=pi[0],ft=pi[1],ft in ut&&(gt=ut[ft],e=e.slice(0,u-ui.length)+gt+e.slice(u),u+=gt.length-ui.length),ft in ur))return ni=this.caret.path,t=2<=ni.length?slice.call(ni,0,vi=ni.length-1):(vi=0,[]),f=ni[vi++],this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),this.addSub(t,f,[it,[[r,[[i,ft]]],[r,[]]]]),u>1&&this.addSub(t,f,[i,e.slice(0,u-ui.length)]),this.caret.path=slice.call(t).concat([f+(u>1)],[1]),void(this.caret.from=this.caret.to=0);if(ti=this.caret.path,t=2<=ti.length?slice.call(ti,0,yi=ti.length-1):(yi=0,[]),f=ti[yi++],p=this.getFormula(t),hi=e.slice(0,u),hi in oi&&1===u&&f>0&&(k=p[1][f-1],k[0]===s&&(fr=k[1]+hi,fr in yt)))return k[1]=yt[fr],u===e.length?(this.removeSub(t,f),this.caret.path=t,this.caret.from=this.caret.to=f):(ci[1]=e.slice(u),this.caret.from=this.caret.to=0),void this.fixCaret();switch(n=e[u-1],!0){case n in ct:case n in et:case n in kt:case n in ht:return this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),this.addSub(t,f,[s,n]),u>1&&this.addSub(t,f,[i,e.slice(0,u-1)]),this.caret.path=t,this.caret.from=this.caret.to=f+1+(u>1),void this.fixCaret();case"/"===n:return ir=this.getFormula(t),kr=ir[0],ki=ir[1],li=!0,u>1?fi=[r,[[i,e.slice(0,u-1)]]]:f>0&&ki[f-1][0]!==s?(fi=[r,[ki[f-1]]],this.removeSub(t,--f)):(fi=[r,[]],li=!1),br=u<e.length?[i,e.slice(u)]:[r,[]],lr=[g,[fi,br]],this.removeSub(t,f),this.addSub(t,f,lr),this.caret.path=slice.call(t).concat([f],[+li]),this.caret.from=this.caret.to=0,void this.fixCaret();case"√"===n:return this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),this.addSub(t,f,[nt,[[r,[]],[r,[]]]]),u>1&&this.addSub(t,f,[i,e.slice(0,u-1)]),this.caret.path=slice.call(t).concat([f+(u>1)],[1]),void(this.caret.from=this.caret.to=0);case"\n"===n:return p=this.getFormula(t),lt=2<=t.length?slice.call(t,0,wi=t.length-1):(wi=0,[]),pt=t[wi++],tt=this.getFormula(lt),k=p[1].slice(0,f),u>1&&k.push([i,e.slice(0,u-1)]),ri=p[1].slice(f+1),u<e.length&&ri.unshift([i,e.slice(u)]),tt[0]===a?(tt[1].splice(pt,1,[r,k],[r,ri]),this.caret.path=slice.call(lt).concat([pt+1])):(p[1]=[[a,[[r,k],[r,ri]]]],this.caret.path=slice.call(t).concat([0],[1])),this.caret.from=this.caret.to=0,void this.fixCaret();case"^"===n:if(p=this.getFormula(t),lt=2<=t.length?slice.call(t,0,bi=t.length-1):(bi=0,[]),pt=t[bi++],tt=this.getFormula(lt),this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),1===u){if(f>0)switch(k=p[1][f-1],ar=k[0]){case c:return k[0]=v,k[1].push([r,[]]),this.caret.path=slice.call(t).concat([f-1],[2]),void(this.caret.from=this.caret.to=0);case o:return this.removeSub(t,f-1),this.addSub(t,f-1,[l,[[r,[k]],[r,[]]]]),void(this.caret.path=slice.call(t).concat([f-1],[1]))}this.addSub(t,f,[l,[[r,[]],[r,[]]]]);this.caret.path=slice.call(t).concat([f],[1]);this.caret.from=this.caret.to=0}else{if(tt[0]===c&&f===p[1].length&&u===e.length)return this.addSub(t,f,[i,e.slice(0,u-1)]),tt[0]=v,tt[1].push([r,[]]),this.caret.path=slice.call(lt).concat([2]),void(this.caret.from=this.caret.to=0);this.addSub(t,f,[l,[[r,[[i,e.slice(0,u-1)]]],[r,[]]]]);this.caret.path=slice.call(t).concat([f],[1]);this.caret.from=this.caret.to=0}return;case"_"===n:if(p=this.getFormula(t),lt=2<=t.length?slice.call(t,0,di=t.length-1):(di=0,[]),pt=t[di++],tt=this.getFormula(lt),this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),1===u){if(f>0)switch(k=p[1][f-1],ar=k[0]){case l:return k[0]=v,k[1].splice(1,0,[r,[]]),this.caret.path=slice.call(t).concat([f-1],[1]),void(this.caret.from=this.caret.to=0);case o:return this.removeSub(t,f-1),this.addSub(t,f-1,[c,[[r,[k]],[r,[]]]]),void(this.caret.path=slice.call(t).concat([f-1],[1]))}this.addSub(t,f,[c,[[r,[]],[r,[]]]]);this.caret.path=slice.call(t).concat([f],[1]);this.caret.from=this.caret.to=0}else{if(tt[0]===l&&f===p[1].length&&u===e.length)return this.addSub(t,f,[i,e.slice(0,u-1)]),tt[0]=v,tt[1].splice(1,0,[r,[]]),this.caret.path=slice.call(lt).concat([1]),void(this.caret.from=this.caret.to=0);this.addSub(t,f,[c,[[r,[[i,e.slice(0,u-1)]]],[r,[]]]]);this.caret.path=slice.call(t).concat([f],[1]);this.caret.from=this.caret.to=0}return;case"┬"===n:return this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),u>1?at=[[i,e.slice(0,u-1)]]:f>0?(at=[this.getFormula(slice.call(t).concat([f-1]))],this.removeSub(t,--f)):at=[],this.addSub(t,f,[w,[[r,at],[r,[]],[r,[]]]]),this.caret.path=slice.call(t).concat([f],[2]),void(this.caret.from=this.caret.to=0);case"┴"===n:return this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),u>1?at=[[i,e.slice(0,u-1)]]:f>0?(at=[this.getFormula(slice.call(t).concat([f-1]))],this.removeSub(t,--f)):at=[],this.addSub(t,f,[w,[[r,at],[r,[]],[r,[]]]]),this.caret.path=slice.call(t).concat([f],[1]),void(this.caret.from=this.caret.to=0);case n in bt:if(lt=2<=t.length?slice.call(t,0,gi=t.length-1):(gi=0,[]),pt=t[gi++],tt=this.getFormula(lt),tt[0]===b&&0===pt)break;return this.removeSub(t,f),u<e.length&&this.addSub(t,f,[i,e.slice(u)]),this.addSub(t,f,[b,[[r,[[i,n]]],[r,[]],[r,[]],[r,[]]]]),u>1&&this.addSub(t,f,[i,e.slice(0,u-1)]),this.caret.path=slice.call(t).concat([f+(u>1)],[3]),void(this.caret.from=this.caret.to=0);case n in ot:if(p=this.getFormula(t),p[0]===r)for(h=rr=tu=f;rr>=0;h=rr+=-1)if(dt=p[1][h],dt[0]===i)for(h===f?(ei=u-2,d=e):(d=dt[1],ei=d.length-1),y=or=iu=ei;or>=0;y=or+=-1)if(d[y]in st){if(this.removeSub(t,h),rt=[],h===f)u-y>2&&rt.push([i,e.slice(y+1,u-1)]);else{for(y<d.length-1&&rt.push([i,d.slice(y+1)]),wt=sr=ru=h+1,wr=f;wr>sr;wt=sr+=1)rt.push(p[1][h]),this.removeSub(t,h);u>1&&rt.push([i,e.slice(0,u-1)]);this.removeSub(t,h)}return u<e.length&&this.addSub(t,h,[i,e.slice(u)]),this.addSub(t,h,[o,[[r,rt]],[d[y],n]]),y>0&&this.addSub(t,h,[i,d.slice(0,y)]),this.caret.path=t,this.caret.from=this.caret.to=h+(y>0)+1,void this.fixCaret()}break;case n in st:if(p=this.getFormula(t),p[0]===r)for(h=hr=dr=f,vr=p[1].length;vr>hr;h=hr+=1)if(dt=p[1][h],dt[0]===i)for(h===f?(si=u,d=e):(si=0,d=dt[1]),y=cr=gr=si,yr=d.length;yr>cr;y=cr+=1)if(d[y]in ot){if(this.removeSub(t,h),rt=[],h===f)y-u>0&&rt.push([i,e.slice(u,y)]);else{for(y>0&&rt.push([i,d.slice(0,y)]),wt=ai=nu=h-1,pr=f;ai>pr;wt=ai+=-1)rt.unshift(p[1][wt]),this.removeSub(t,wt);u<e.length&&rt.unshift([i,e.slice(u)]);this.removeSub(t,f)}return y<d.length-1&&this.addSub(t,f,[i,d.slice(y+1)]),this.addSub(t,f,[o,[[r,rt]],[n,d[y]]]),u>1&&this.addSub(t,f,[i,e.slice(0,u-1)]),this.caret.path=slice.call(t).concat([f+(u>1)],[0]),this.caret.from=this.caret.to=0,void this.fixCaret()}}return this.caret.from=this.caret.to=u,void(ci[1]=e);default:console.log("insertChar missing for ",er)}},t.prototype.insertText=function(n){var i,t,u;if(0===n.length)this.insertFormula([r,[]]);else for(t=0,u=n.length;u>t;t++)i=n[t],this.insertChar(i);this.reMeasure=!0;this.canDelete=!1},t.prototype.insertFromToolbar=function(n,i,r){var o,u,s,f,e;if(null!=i&&this.caret.from!==this.caret.to&&(f=this.selectedFormula()),f&&f.length)e=new t,e.insertText(n),e.selectAll(),this.insertFormula(e.selectedFormula()),this.moveBy(i),this.insertFormula(f),this.moveBy(r);else for(u=0,s=n.length;s>u;u++)o=n[u],this.insertChar(o);this.reMeasure=!0;this.canDelete=!1},t.prototype.insertFormula=function(n){var d,t,l,u,f,b,a,v,e,o,h,y,s,p,w,c,k;if("string"==typeof n&&(n=AJson.parse(n)),b=n[0],f=n[1],b===r){switch(h=this.caret,e=h.path,u=h.from,c=h.to,y=l=this.getFormula(e),k=y[0],t=y[1],k){case i:v=t.slice(0,u);w=t.slice(c);s=e;e=2<=s.length?slice.call(s,0,a=s.length-1):(a=0,[]);o=s[a++];p=l=this.getFormula(e);d=p[0];t=p[1];t.splice(o,1);v&&t.splice(o++,0,[i,v]);w&&t.splice(o,0,[i,w]);u=o;break;case r:t.splice(u,c-u)}f.length&&(u>0&&t[u-1][0]===i&&f[0][0]===i&&(t[u-1][1]=t[u-1][1]+f[0][1],f.splice(0,1)),t.splice.apply(t,[u,0].concat(slice.call(f))),u+=f.length,u<t.length&&t[u-1][0]===i&&t[u][0]===i&&(o=t[u-1][1].length,t[u-1][1]=t[u-1][1]+t[u][1],t.splice(u,1),e.push(u-1),u=c=o));l[1]=t;this.caret.path=e;this.caret.from=this.caret.to=u;this.fixCaret();this.reMeasure=!0;this.canDelete=!1}},t.prototype.removeByPath=function(n){var t,i,r;n.length&&(i=2<=n.length?slice.call(n,0,t=n.length-1):(t=0,[]),r=n[t++],this.caret.path=i,this.caret.from=this.caret.to=r,this.removeSub(i,r),this.fixCaret(),this.joinStrings())},t.prototype.removeSub=function(n,t){var u,r,i;i=this.getFormula(n);u=i[0];r=i[1];r.splice(t,1)},t.prototype.addSub=function(n,t,i){var f,u,r;r=this.getFormula(n);f=r[0];u=r[1];u.splice(t,0,i)},t.prototype.fixCaret=function(){var t,n,f,e,u,o;if(f=this.getCaretFormula(),o=f[0],t=f[1],e=this.caret,n=e.from,u=e.to,n===u)switch(o){case r:if(n>0&&t[n-1][0]===i)return this.caret.path.push(n-1),void(this.caret.from=this.caret.to=t[n-1][1].length);if(n<t.length&&t[n][0]===i)return this.caret.path.push(n),void(this.caret.from=this.caret.to=0);break;case i:return n<t.length&&Unicode.isLowSurrogate(t[n])&&this.caret.from++,void(u<t.length&&Unicode.isLowSurrogate(t[u])&&this.caret.to++)}},t.prototype.joinStrings=function(){var o,a,f,s,t,e,v,n,h,u,c,l,y,p;return h=a=this.getCaretFormula(),p=h[0],o=h[1],u=this.caret.path,e=2<=u.length?slice.call(u,0,s=u.length-1):(s=0,[]),n=u[s++],c=this.getFormula(e),v=c[0],t=c[1],l=this.caret,f=l.from,y=l.to,p===i&&v===r&&f===y?0===f&&n>0&&t[n-1][0]===i?(this.caret.path[this.caret.path.length-1]--,this.caret.from=this.caret.to=t[n-1][1].length,t[n-1][1]+=o,this.removeSub(e,n),void(this.reMeasure=!0)):f===o.length&&n<t.length-1&&t[n+1][0]===i?(a[1]+=t[n+1][1],this.removeSub(e,n+1),void(this.reMeasure=!0)):void 0:void 0},t.prototype.setStyle=function(n){var i,u,r,f;for(r=["formulaColor","formulaAlpha"],i=0,u=r.length;u>i;i++)f=r[i],this.trySetStyle(f,n);return null!=n.strokeWidth&&(this.reMeasure=this.allowAutosize=!0),t.__super__.setStyle.apply(this,arguments)},t.prototype.applyTransform=function(){t.__super__.applyTransform.apply(this,arguments);this.reMeasure||this.updateTextLocation()},t.prototype.selectAll=function(){this.caret.path=[];this.caret.from=0;this.caret.to=this.formula[1].length},t.prototype.confirmRemovePath=function(n,t){null!=n&&null!=t?this.caret.confirmRemove={path:t,button:n}:null!=this.caret.confirmRemove&&(this.removeByPath(this.caret.confirmRemove.path),delete this.caret.confirmRemove)},t.prototype.joinArrayAt=function(n){var c,f,e,t,i,l,r,u,o,s,h;return i=2<=n.length?slice.call(n,0,f=n.length-1):(f=0,[]),r=n[f++],s=this.getFormula(i),c=s[0],t=s[1],this.caret.path=n,this.caret.from=this.caret.to=t[r][1].length,Array.prototype.push.apply(t[r][1],t[r+1][1]),t.splice(r+1,1),1===t.length&&(o=2<=i.length?slice.call(i,0,e=i.length-1):(e=0,[]),l=i[e++],h=this.getFormula(o),c=h[0],u=h[1],1===u.length&&(u.splice.apply(u,[0,1].concat(slice.call(t[0][1]))),this.caret.path=o)),this.fixCaret(),this.joinStrings()},t.prototype.deleteAtBeginning=function(n){var i,e,t,f,r,u;t=2<=n.length?slice.call(n,0,i=n.length-1):(i=0,[]);r=n[i++];u=this.getFormula(t);f=u[0];e=u[1];f===a&&r>0?this.joinArrayAt(slice.call(t).concat([r-1])):this.confirmRemovePath(pt,t)},t.prototype.deleteAtEnd=function(n){var t,u,i,f,e,r;i=2<=n.length?slice.call(n,0,t=n.length-1):(t=0,[]);e=n[t++];r=this.getFormula(i);f=r[0];u=r[1];f===a&&e<u.length?this.joinArrayAt(n):this.confirmRemovePath(wt,i)},t.prototype.tryRemovePath=function(n,t){var i;i=this.getFormula(t)[0];i===s?this.removeByPath(t):this.confirmRemovePath(n,t)},t.prototype.handleKeyDown=function(n,t){var g,c,f,nt,o,u,y,p,d,s,h,w,b,l,a,k,tt,e,v;if(nt=t.ctrl,tt=t.shift,w=o=this.getCaretFormula(),v=w[0],f=w[1],b=this.caret,u=b.from,e=b.to,null!=this.caret.confirmRemove){if(this.caret.confirmRemove.button===n)return this.confirmRemovePath(),this.reMeasure=!0,!0;delete this.caret.confirmRemove}switch(n){case di:this.moveToStart();break;case ki:this.moveToEnd();break;case gi:this.moveLeft();break;case ir:this.moveRight();break;case pt:switch(v){case r:u===e?0===u?this.deleteAtBeginning(this.caret.path):this.tryRemovePath(n,slice.call(this.caret.path).concat([u-1])):(o[1].splice(u,e-u),this.caret.to=u,this.fixCaret(),this.joinStrings());this.reMeasure=!0;break;case i:u===e?0===u?(l=this.caret.path,s=2<=l.length?slice.call(l,0,y=l.length-1):(y=0,[]),h=l[y++],0===h?this.deleteAtBeginning(s):this.tryRemovePath(n,slice.call(s).concat([h-1]))):(c=1+(u>1&&Unicode.isLowSurrogate(f[u-1])),o[1]=f.slice(0,u-c)+f.slice(e),this.caret.from=this.caret.to-=c):(o[1]=f.slice(0,u)+f.slice(e),this.caret.to=u);0===o[1].length&&(this.caret.from=this.caret.to=this.caret.path.pop(),this.removeSub(this.caret.path,this.caret.from));this.reMeasure=!0;break;default:console.log("handleKeyDown BACKSPACE missing for ",v)}return!0;case wt:switch(v){case r:u===e?u===f.length?this.deleteAtEnd(this.caret.path):this.tryRemovePath(n,slice.call(this.caret.path).concat([u])):(o[1].splice(u,e-u),this.caret.to=u,this.fixCaret(),this.joinStrings());this.reMeasure=!0;break;case i:u===e?u===f.length?(a=this.caret.path,s=2<=a.length?slice.call(a,0,p=a.length-1):(p=0,[]),h=a[p++],k=this.getFormula(s),g=k[0],d=k[1],h===d.length-1?this.deleteAtEnd(s):this.tryRemovePath(n,slice.call(s).concat([h+1]))):(c=1+(u<f.length-1&&Unicode.isHighSurrogate(f[u])),o[1]=f.slice(0,u)+f.slice(e+c)):(o[1]=f.slice(0,u)+f.slice(e),this.caret.to=u);0===o[1].length&&(this.caret.from=this.caret.to=this.caret.path.pop(),this.removeSub(this.caret.path,this.caret.from));this.reMeasure=!0;break;default:console.log("handleKeyDown DEL missing for ",v)}return!0;case tr:return;case nr:return;case rr:return;case bi:return}},t.prototype.inverseTransformCoords=function(n,t){var i;return i=Geometry.transformPoint([n,t],this.contentTransformInverse),n=i[0],t=i[1],[n-this.paddingLR-this.x0,t-this.paddingTB-this.y0]},t.prototype.coordsToCaret=function(n,t,u,f){var at,tt,y,h,p,rt,ut,ht,ft,et,k,e,ot,ct,lt,st,d;switch(null==f&&(f=[]),st=u.type,y=u.content,e=u.positions,d=u.width,h=function(i){return function(r){var u,o,s;return f.push(r),u=e[r],o=u[0],s=u[1],i.coordsToCaret(n-o,t-s,y[r],f)}}(this),st){case i:for(ut=n,k=rt=0,ht=e.length;ht>rt;k=++rt){if(tt=e[k],(tt+ut)/2>=n&&!(k<y.length&&Unicode.isHighSurrogate(y[k])))return[f,Math.max(0,k-1)];ut=tt}return[f,y.length];case r:if(n>d)return[f,y.length];for(p=ft=e.length-1;ft>=0;p=ft+=-1)if(ct=e[p][0],n>=ct)return h(p);return[f,0];case o:return h(0);case s:return[f,f.pop()+(n>d/2)];case g:return h(+(t>u.baseline));case it:return h(+(n>e[1][0]));case nt:return h(+(n>d-y[1].width));case a:for(p=et=e.length-1;et>=0;p=et+=-1)if(ot=e[p],at=ot[0],lt=ot[1],t>=lt)return h(p);return h(0);case l:return h(+(n>e[1][0]));case c:return h(+(n>e[1][0]));case v:return h(+(n>e[1][0])*(1+(t<e[1][1])));case w:return h(+(t<e[0][1])+2*(t>e[2][1]));case b:return h(n>Math.max(y[0].width,y[1].width,y[2].width)?3:t>e[1][1]?1:t>e[0][1]?0:2);default:return console.log("coordsToCaret missing for ",st),[f,0]}},t.prototype.mousedown=function(n,t,i){var f,e,r,u;null==i&&(i={});r=this.inverseTransformCoords(n,t);n=r[0];t=r[1];u=this.selectionStartCaret=this.coordsToCaret(n,t,this.measured);f=u[0];e=u[1];this.caret.path=f;this.caret.from=this.caret.to=e;delete this.caret.confirmRemove},t.prototype.mousemove=function(n,t){var i;i=this.inverseTransformCoords(n,t);n=i[0];t=i[1];this.updateSelection(this.coordsToCaret(n,t,this.measured))},t.prototype.mouseup=function(n,t){this.mousemove(n,t);delete this.selectionStartCaret;this.fixCaret();delete this.caret.confirmRemove},t.prototype.doubleClick=function(n,t){var i;i=this.inverseTransformCoords(n,t);n=i[0];t=i[1]},t.prototype.canPickFill=function(){return!0},t.prototype.prepareDraw=function(){return this.reMeasure&&this.measure(),t.__super__.prepareDraw.apply(this,arguments)},t.prototype.drawExtra=function(n,t){this.reMeasure&&this.measure();n.save();n.transform.apply(n,this.contentTransform);n.translate(this.x0,this.y0);n.translate(this.paddingLR,this.paddingTB);t.highlight&&this.drawCaretDeep(n,0,this.measured,0,0,k,!0);n.strokeStyle=n.fillStyle=null!=this.formulaStyle?this.formulaStyle:this.formulaStyle=DrawObject.makeColor(this.style.formulaColor,this.style.formulaAlpha);this.drawDeep(n,t.active,this.measured,0,0,k);n.restore()},t.prototype.drawDeep=function(n,t,f,y,p,k,d){var yt,lt,pt,ut,wt,tt,ot,ht,et,kt,st,ii,ri,dt,ui,ni,vt,fi,at,bt,oi,ti,ct;switch(ti=f.type,ut=f.content,wt=f.extra,lt=f.baseline,ni=f.positions,ct=f.width,ot=f.height,tt=function(i){return function(r,u,f){var e,o,s;return null==u&&(u=k),null==f&&(f=d),e=ni[r],o=e[0],s=e[1],i.drawDeep(n,t,ut[r],o,s,u,f)}}(this),n.save(),n.translate(y,p),n.font=k+'px "IDroo Math"',ti){case i:d||(ut=ei(ut));n.fillText(ut,0,k*(1+h));break;case r:if(ut.length)for(ht=kt=0,ii=ut.length;ii>kt;ht=++kt)yt=ut[ht],tt(ht);else t&&(oi=n.globalAlpha,n.globalAlpha=.5,n.fillText(gt,wt,k*(1+h)),n.globalAlpha=oi);break;case s:n.fillText(ut,0,k*(1+h));break;case g:tt(0);tt(1);n.beginPath();n.moveTo(0,lt);n.lineTo(ct,lt);n.lineWidth=.05*k;n.lineCap="butt";n.stroke();break;case it:tt(0,null,!0);tt(1);break;case nt:n.beginPath();fi=ut[0];at=ut[1];ui=k*rt;et=.05*k;y=ct-at.width-ui;p=ot-at.height-2*et;n.moveTo(y-12*et,lt+2*et);n.lineTo(y-12.5*et,lt+et);n.lineTo(y-8.5*et,lt);n.lineTo(y-5.5*et,ot-2*et-.01*ot);n.lineTo(y-et,p);n.lineTo(ct,p);n.lineTo(ct,p+4*et);n.lineTo(ct-et,p+4*et);n.lineTo(ct-et,p+et);n.lineTo(y,p+et);n.lineTo(y-5*et,ot);n.lineTo(y-6*et,ot);n.lineTo(y-9.4*et,lt+1.5*et);n.fill();(fi.content.length>0||t)&&tt(0,k*u);tt(1);break;case a:for(ht=dt=0,ri=ut.length;ri>dt;ht=++dt)yt=ut[ht],tt(ht);break;case l:case c:tt(0);tt(1,k*u);break;case v:tt(0);tt(1,k*u);tt(2,k*u);break;case w:yt=ut[0];at=ut[1];bt=ut[2];tt(0);(at.content.length>0||t)&&tt(1,k*u);(bt.content.length>0||t)&&tt(2,k*u);break;case b:yt=ut[0];at=ut[1];bt=ut[2];tt(0,k*ft);(at.content.length>0||t)&&tt(1,k*u);(bt.content.length>0||t)&&tt(2,k*u);tt(3);break;case o:tt(0);st=wt[0];vt=wt[1];ot>k*(e+h)?(pt=.3*k,n.beginPath(),"├"!==st&&"┤"!==st&&Geometry.makeBracketPath(n,st,[0,0],pt,ot,k),"├"!==vt&&"┤"!==vt&&Geometry.makeBracketPath(n,vt,[ct-pt,0],pt,ot,k),n.fill()):("├"!==st&&"┤"!==st&&n.fillText(st,0,k*(1+h)),"├"!==st&&"┤"!==st&&n.fillText(vt,ni[0][0]+ut[0].width,k*(1+h)));break;default:console.log("drawDeep missing for ",ti)}n.restore()},t.prototype.drawCaret=function(n){this.reMeasure&&this.measure();n.save();n.transform.apply(n,this.contentTransform);n.translate(this.x0,this.y0);n.translate(this.paddingLR,this.paddingTB);this.drawCaretDeep(n,0,this.measured,0,0,this.style.textSize);n.restore()},t.prototype.drawCaretDeep=function(n,t,f,e,o,s,h){var rt,k,st,a,d,p,et,ot,g,tt,y,ut,it;if(null==h&&(h=!1),tt=f.type,rt=f.content,p=f.positions,d=function(n){return n<p.length?tt===i?p[n]:n>0?(p[n-1][0]+rt[n-1].width+p[n][0])/2:p[n][0]:tt===r&&0===rt.length?f.width/2:f.width},n.save(),n.translate(e,o),h&&this.caret.confirmRemove&&t===this.caret.confirmRemove.path.length-1&&(a=this.caret.confirmRemove.path[t],y=d(a),ut=d(a+1),n.fillStyle=vi,n.fillRect(y,0,ut-y,f.height)),et=this.caret,g=et.to,k=et.from,st=t===this.caret.path.length-1&&tt===r&&h&&g===k,t===this.caret.path.length||st)y=d(g),h?g>k?(ut=d(k),n.fillStyle=er,n.fillRect(y,0,ut-y,f.height)):!this.caret.path.length||this.selectionStartCaret||this.caret.confirmRemove||(n.fillStyle=yi,n.fillRect(0,0,f.width,f.height)):g===k&&(it=f.baseline+li*s,n.beginPath(),n.moveTo(y,it),n.lineTo(y,it+ci*s),n.lineWidth=ai,n.lineCap="butt",n.strokeStyle=hi,n.stroke());else{switch(a=this.caret.path[t],ot=p[a],y=ot[0],it=ot[1],tt){case nt:0===a&&(s*=u);break;case l:case c:1===a&&(s*=u);break;case v:case w:1!==a&&2!==a||(s*=u);break;case b:0===a&&(s*=ft);1!==a&&2!==a||(s*=u)}this.drawCaretDeep(n,t+1,rt[a],y,it,s,h)}n.restore()},t.prototype.updateTextLocation=function(){var r,u,f,n,t,i,e,o;n=this.rawPoints;i=n[0];e=n[1];o=n[2];t=this.points;r=t[0];u=t[1];f=t[2];this.x0=i[0];this.y0=i[1];this.contentTransform=Geometry.transformFromToMatrix(i,e,o,r,u,f);this.contentTransformInverse=Geometry.inverseMatrix(this.contentTransform)},t.prototype.measure=function(){var s,h,u,f,o,i,n,r,t;this.reMeasure=!1;this.updateTextLocation();this.lineHeight=Math.round(k*e);this.paddingTB=Math.ceil(this.style.strokeWidth/2+k/8);this.paddingLR=Math.ceil(this.style.strokeWidth/2+k/4);this.measured=this.measureDeep(this.formula,k);this.text=AJson.stringify(this.formula);this.changed.text=!0;u=this.rawPoints;f=u[0];i=f[0];r=f[1];o=u[1];n=o[0];t=o[1];s=n>i?1:-1;h=t>r?1:-1;n=i+s*(this.measured.width+2*this.paddingLR);t=r+h*(this.measured.height+2*this.paddingTB);this.rawPoints[1]=[n,t];this.rawPoints[2]=[n,r];this.rawPoints[3]=[i,t];this.setPointChanged(1,2,3);this.refreshPoints();this.callChange()},t.prototype.measureDeep=function(n,t,f,p,k){var ui,st,hi,et,fi,ci,yr,ht,kt,yt,at,nr,ti,ur,fr,er,sr,hr,cr,li,d,ai,tr,vt,vi,ct,yi,bi,wt,lr,ki,ii,ar,di,gi,pt,tt,ut,lt,bt,vr,ri,ir,rr,ot,oi;if(ri=n[0],et=n[1],fi=n[2],null==f&&(f=[]),ot=0,ht=0,st=t*(si+h),d=[],ct=[],y){switch(y.font=t+'px "IDroo Math"',ri){case r:case g:case o:case a:if(et.length)for(yt=nr=0,ur=et.length;ur>nr;yt=++nr)vr=et[yt],d.push(this.measureDeep(vr,t,slice.call(f).concat([yt]),p,k))}switch(ri){case i:for(ar="",ct.push(0),li=0,fr=et.length;fr>li;li++)hi=et[li],p||(hi=ei(hi)),ct.push(ot=y.measureText(ar+=hi).width);ht=t*(e+h);d=et;break;case r:if(kt=0,et.length||ri===o){for(ai=0,er=d.length;er>ai;ai++)pt=d[ai],st=Math.max(st,pt.baseline),kt=Math.max(kt,pt.height-pt.baseline);for(yt=tr=0,sr=d.length;sr>tr;yt=++tr)pt=d[yt],ct.push([ot,st-pt.baseline]),ot+=pt.width,yt<d.length-1&&(rr=this.formulaTypeRight(et[yt],slice.call(f).concat([yt])),ir=this.formulaTypeLeft(et[yt+1],slice.call(f).concat([yt+1])),ot+=k?t*ni[rr][ir]*or:t*ni[rr][ir]);ht=st+kt}else fi=y.measureText(gt).width/-2,ot=0,ht=t*(e+h);break;case s:ot=y.measureText(et).width;ht=t*(e+h);d=et;break;case g:vt=t*rt;tt=d[0];ut=d[1];ot=2*vt+Math.max(tt.width,ut.width);ht=2*vt+tt.height+ut.height;st=tt.height+vt;ct.push([(ot-tt.width)/2,0]);ct.push([(ot-ut.width)/2,tt.height+2*vt]);break;case it:vt=t*dt;d.push(this.measureDeep(et[0],t,slice.call(f).concat([0]),!0,k));d.push(this.measureDeep(et[1],t,slice.call(f).concat([1]),p,k));tt=d[0];ut=d[1];ot=tt.width+vt+ut.width;st=Math.max(tt.baseline,ut.baseline);kt=Math.max(tt.height-tt.baseline,ut.height-ut.baseline);ht=st+kt;ct.push([0,st-tt.baseline]);ct.push([tt.width+vt,st-ut.baseline]);break;case nt:d.push(this.measureDeep(et[0],t*u,slice.call(f).concat([0]),p,!0));d.push(this.measureDeep(et[1],t,slice.call(f).concat([1]),p,k));tt=d[0];ut=d[1];at=.05*t;ci=tt.content.length>0;st=ut.height-ut.baseline;vt=t*rt;ot=vt+Math.max(10*at+ut.width,5*at+tt.width*ci+ut.width);ht=Math.max(tt.height*ci+st,ut.height+2*at);st=ht-st;ct.push([tt.width*!ci/-2,st-tt.height]);ct.push([ot-ut.width-vt,ht-ut.height]);break;case a:for(ot=0,vt=t*rt,yi=0,hr=d.length;hr>yi;yi++)pt=d[yi],ot=Math.max(ot,pt.width);for(ht=0,bi=0,cr=d.length;cr>bi;bi++)pt=d[bi],ct.push([(ot-pt.width)/2,ht]),ht+=pt.height+vt;ht-=vt;st=1===et.length?d[0].baseline:ht/2;break;case l:d.push(this.measureDeep(et[0],t,slice.call(f).concat([0]),p,k));d.push(this.measureDeep(et[1],t*u,slice.call(f).concat([1]),p,!0));tt=d[0];ut=d[1];at=.05*t;yr=ut.content.length>0;ot=tt.width+ut.width+at;ht=tt.height+ut.height-t*e/2;st=tt.baseline+ut.height-t*e/2;ct.push([0,ht-tt.height]);ct.push([tt.width+at,0]);break;case c:d.push(this.measureDeep(et[0],t,slice.call(f).concat([0]),p,k));d.push(this.measureDeep(et[1],t*u,slice.call(f).concat([1]),p,!0));tt=d[0];ut=d[1];at=.05*t;ot=tt.width+ut.width+at;ht=tt.height+ut.height-t*e/2;st=tt.baseline;ct.push([0,0]);ct.push([tt.width+at,ht-ut.height]);break;case v:d.push(this.measureDeep(et[0],t,slice.call(f).concat([0]),p,k));d.push(this.measureDeep(et[1],t*u,slice.call(f).concat([1]),p,!0));d.push(this.measureDeep(et[2],t*u,slice.call(f).concat([2]),p,!0));tt=d[0];ut=d[1];lt=d[2];at=.05*t;ot=tt.width+at+Math.max(ut.width,lt.width);ht=tt.height+ut.height+lt.height-t*e;st=tt.baseline+lt.height-t*e/2;ct.push([0,ut.height-t*e/2]);ct.push([tt.width+at,ht-lt.height]);ct.push([tt.width+at,0]);break;case w:d.push(this.measureDeep(et[0],t,slice.call(f).concat([0]),p,k));d.push(this.measureDeep(et[1],t*u,slice.call(f).concat([1]),p,!0));d.push(this.measureDeep(et[2],t*u,slice.call(f).concat([2]),p,!0));tt=d[0];ut=d[1];lt=d[2];ht=tt.height;st=tt.baseline;ui=0;ut.content.length&&(ht+=ut.height,st+=ut.height,ui=ut.height);lt.content.length&&(ht+=lt.height);ot=Math.max(tt.width,ut.width,lt.width);ct.push([(ot-tt.width)/2,ui]);ct.push([(ot-ut.width)/2,ui-ut.height]);ct.push([(ot-lt.width)/2,ui+tt.height]);break;case b:d.push(this.measureDeep(et[0],t*ft,slice.call(f).concat([0]),p,!0));d.push(this.measureDeep(et[1],t*u,slice.call(f).concat([1]),p,!0));d.push(this.measureDeep(et[2],t*u,slice.call(f).concat([2]),p,!0));d.push(this.measureDeep(et[3],t,slice.call(f).concat([3]),p,k));di=gi=0;"∫"!==(wt=null!=(lr=et[0][1][0])?lr[1]:void 0)&&"∬"!==wt&&"∭"!==wt&&"⨌"!==wt&&"∮"!==wt&&"∯"!==wt&&"∰"!==wt||(di=t*pi,gi=t*wi);tt=d[0];ut=d[1];lt=d[2];bt=d[3];oi=2*Math.max(tt.width/2,ut.width/2+di,lt.width/2+gi);ot=oi+bt.width+t*dt;st=Math.max(tt.baseline+lt.height,bt.baseline);ht=st+Math.max(tt.height-tt.baseline+ut.height,bt.height-bt.baseline);ct.push([(oi-tt.width)/2,st-tt.baseline-.05*t]);ct.push([(oi-ut.width)/2-di,st+tt.height-tt.baseline]);ct.push([(oi-lt.width)/2+gi,st-tt.baseline-lt.height]);ct.push([ot-bt.width,st-bt.baseline]);break;case o:ki=d[0];ot=ki.width;ht=ki.height;st=ki.baseline;ti=fi[0];ii=fi[1];vi=0;ht>t*(e+h)?("├"!==ti&&"┤"!==ti&&(ot+=vi=.3*t),"├"!==ii&&"┤"!==ii&&(ot+=.3*t)):("├"!==ti&&"┤"!==ti&&(ot+=vi=y.measureText(ti).width),"├"!==ii&&"┤"!==ii&&(ot+=y.measureText(ii).width));ct.push([vi,0]);break;default:console.log("measureDeep missing for ",ri)}return{type:ri,content:d,extra:fi,positions:ct,width:ot,height:ht,baseline:st}}},t.prototype.formulaTypeLeft=function(n,t){var r,h,f,e,y,i,u,c,l,a,v;switch(v=n[0],r=n[1],v){case o:return ti;case s:if(r in kt)return t.length&&(u=t,t=2<=u.length?slice.call(u,0,h=u.length-1):(h=0,[]),i=u[h++],c=this.getFormula(t),y=c[0],f=c[1],e=i>f.length-2?null:f[i+1],(1>i||(l=this.formulaTypeRight(f[i-1],slice.call(t).concat([i-1])))===lt||l===ri)&&(null===e||e[0]!==s&&((a=this.formulaTypeLeft(e,slice.call(t).concat([i+1])))===ii||a===ti)))?ui:lt;if(r in et)return lt;if(r in ht)return ri;if(r in ct)return ui}return ii},t.prototype.formulaTypeRight=function(n,t){var r,i;switch(i=n[0],r=n[1],i){case o:return sr}return this.formulaTypeLeft(n,t)},t.prototype.serialize=function(){var n;return this.reMeasure&&this.measure(),n=t.__super__.serialize.apply(this,arguments),n.t=this.text,null==n.S&&(n.S={}),idroo.utils.colorsEqual(this.style.formulaColor,DrawObject.defaultStyle.formulaColor)||(n.S.c=this.style.formulaColor),this.style.formulaAlpha!==DrawObject.defaultStyle.formulaAlpha&&(n.S.a=this.style.formulaAlpha),n},t.prototype.changes=function(){var i,r,u,n;if(this.reMeasure&&this.measure(),u=t.__super__.changes.apply(this,arguments),null!=this.changed.style&&(null==u.S&&(u.S={}),null!=this.changed.style.formulaColor&&(u.S.c=this.style.formulaColor),null!=this.changed.style.formulaAlpha&&(u.S.a=this.style.formulaAlpha)),null!=this.changed.text&&this.text!==this.lastText){for(n=0,r=this.lastText.length-1,i=this.text.length-1;r>=n&&i>=n&&this.lastText[n]===this.text[n];)n++;for(;r>=n&&i>=n&&this.lastText[r]===this.text[i];)r--,i--;r++;i++;this.lastText=this.text;u._={p:n,l:r-n,s:this.text.substr(n,i-n)}}return u},t.prototype.restoreChange=function(n){var i;t.__super__.restoreChange.call(this,n);null!=n.S&&(null==n.S.c&&null==n.S.a||(null!=n.S.c&&(this.style.formulaColor=n.S.c),null!=n.S.a&&(this.style.formulaAlpha=n.S.a),this.formulaStyle=null));null!=n.t&&(this.lastText=this.text=n.t);null!=n._&&(this.lastText=this.text=this.text.substr(0,n._.p)+n._.s+this.text.substr(n._.p+n._.l));try{this.formula=AJson.parse(this.text)}catch(u){i=u;this.formula=[r,[]]}try{"undefined"!=typeof Fonts&&null!==Fonts&&Fonts.unlessLoaded("IDroo Math",function(n){return function(){return n.measure(),n.callChange()}}(this))}catch(u){i=u}this.reMeasure=!0;this.canDelete=!1},t}(DrawRectangle);("undefined"!=typeof exports&&null!==exports?exports:this).Layer=Layer=function(){function n(n){this.board=n;this.canvas=$("<canvas>")[0];this.context=this.canvas.getContext("2d");this.changed=!0}return n.prototype.draw=function(n){var t,i;if(this.changed)return this.changed=!1,t=this.context,t.clearRect(0,0,this.canvas.width,this.canvas.height),t.save(),i=1/this.board.zoom,t.scale(i,i),t.translate(this.board.x,this.board.y),n(t),t.restore(),this},n}();extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};hasProp={}.hasOwnProperty;("undefined"!=typeof exports&&null!==exports?exports:this).BoardLayer=BoardLayer=function(n){function t(n,r){this.board=n;this.options=$.extend(!0,{},i,r);this.index=[];this.objects={};t.__super__.constructor.apply(this,arguments)}var i;return extend(t,n),i={followBoardIndex:!1,draw:{stroke:!0,fill:!0,extra:!0,highlight:!1,points:!1}},t.prototype.add=function(n){var i,t,r;if("string"==typeof n)this.index.push(n),this.objects[n]=1;else for(this.index=this.index.concat(n),t=0,r=n.length;r>t;t++)i=n[t],this.objects[i]=1;return this.changed=!0,this},t.prototype.remove=function(n){var i,t,r;if("string"==typeof n)this.index.removeItem(n),delete this.objects[n];else for(this.index.removeItems(n),t=0,r=n.length;r>t;t++)i=n[t],delete this.objects[i];return this.changed=!0,this},t.prototype.empty=function(){return this.index.length?(this.index=[],this.objects={},this.changed=!0,this):this},t.prototype.isEmpty=function(){return!this.index.length},t.prototype.draw=function(){var n,i,r;return i=[n=-this.board.viewport.x,r=-this.board.viewport.y,n+this.board.viewport.width,r+this.board.viewport.height],t.__super__.draw.call(this,function(n){return function(t){n.each(function(r,u){if(Geometry.rectangleOverRectangle(i,u.outerBounds))return u.draw(t,n.options.draw)})}}(this)),this},t.prototype.each=function(n){var r,e,t,i,f,u;for(e="function"==typeof n,r=this.options.followBoardIndex?this.board.index:this.index,t=0,f=r.length;f>t;t++)i=r[t],this.objects[i]&&(u=this.board.objects[i],n.call(u,i,u));return this},t.prototype.pickObjectPoint=function(n,t,i){var u,f,e,r,o;for(null==i&&(i=!0),f=this.options.followBoardIndex?this.board.index:this.index,u=e=o=f.length-1;e>=0;u=e+=-1)if(r=f[u],this.objects[r]&&this.board.objects[r].pickPoint(n,t,i))return r;return!1},t.prototype.pickObject=function(n,t){for(var f,i,e,u=this.options.followBoardIndex?this.board.index:this.index,r=f=e=u.length-1;f>=0;r=f+=-1)if(i=u[r],this.objects[i]&&this.board.objects[i].pickUp(n,t))return i;return!1},t.prototype.pickObjects=function(n){var t;return t=[],this.each(function(i,r){if(r.rectangleOver(n))return t.push(i)}),t},t.prototype.to=function(n,t){return this.splitTo(this.index,n,t),this.empty()},t.prototype.splitTo=function(n,t,i){var r,u,o,f,e;if(i){for(e=[],f=[],r=0,o=n.length;o>r;r++)u=n[r],this.board.objects[u].locked?f.push(u):e.push(u);t.add(e);i.add(f)}else t.add(this.index)},t.prototype.toMap=function(n){return this.each(function(t,i){n[t]=i})},t}(Layer);extend=function(n,t){function r(){this.constructor=n}for(var i in t)hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};hasProp={}.hasOwnProperty;("undefined"!=typeof exports&&null!==exports?exports:this).BoardGroupedLayer=BoardGroupedLayer=function(n){function t(){t.__super__.constructor.apply(this,arguments);this.index={}}return extend(t,n),t.prototype.add=function(n,t){var r,i,u,f;if(null==(r=this.index)[n]&&(r[n]=[]),"string"==typeof t)this.index[n].push(t),this.objects[t]=1;else for(this.index[n]=this.index[n].concat(t),i=0,f=t.length;f>i;i++)u=t[i],this.objects[u]=1;return this.changed=!0,this},t.prototype.remove=function(n,t){var i,u,f,r;if(n in this.index){if(t)this.index[n].remove(t),delete this.objects[t];else{for(r=this.index[n],i=0,f=r.length;f>i;i++)u=r[i],delete this.objects[u];delete this.index[n]}this.changed=!0}return this},t.prototype.empty=function(){return this.index={},this.changed=!0,this},t.prototype.isEmpty=function(){var i,n,t=this.index;for(n in t)return i=t[n],!1;return!0},t.prototype.each=function(n){var t,r,s,i,o,u,f,e;s="function"==typeof n;f=this.index;for(u in f)for(r=f[u],this.options.perGroup&&$.extend(!0,this.options,this.options.perGroup(u)),t=0,o=r.length;o>t;t++)i=r[t],this.objects[i]&&(e=this.board.objects[i],n.call(e,i,e));return this},t.prototype.pickObject=function(){return!1},t.prototype.to=function(n,t,i){return n in this.index&&(this.splitTo(this.index[n],t,i),this.remove(n)),this},t}(BoardLayer);var idroo,ui,bind=function(n,t){return function(){return n.apply(t,arguments)}},indexOf=[].indexOf||function(n){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===n)return t;return-1},slice=[].slice;idroo=this.idroo;ui=idroo.ui=idroo.ui||{};this.Board=function(){function n(n,t){this.name=n;this.deleteAll=bind(this.deleteAll,this);this.deleteUnderEraser=bind(this.deleteUnderEraser,this);this.lock("load",2e3);this.userId=null;this.editorId=null;this.editors={};this.index=[];this.objects={};this.x=this.y=0;this.width=this.height=0;this.viewport={x:0,y:0,width:0,height:0};this.bounds={left:0,top:0,width:0,height:0};this.pointer={x:0,y:0,startX:0,startY:0,shadowX:0,shadowY:0,offsetX:0,offsetY:0};this.syncPointer=!1;this.action="";this.zoomLevel=0;this.zoom=1;this.selection=!1;this.activeBounds=!1;this.activeBoundsOffset=!1;this.scaleHandles={};this.scaleFrom=[];this.scaleTo=[];this.activeScaleHandle=!1;this.rotateCenter=[];this.rotateFrom=[];this.rotateTo=!1;this.background=new Layer(this);this.locked=new BoardLayer(this,{followBoardIndex:!0});this.fixed=new BoardLayer(this,{followBoardIndex:!0});this.others=new BoardGroupedLayer(this,{perGroup:function(){return function(n){return{draw:{highlight:idroo.utils.editorColor(n,.3)}}}}(this)});this.active=new BoardLayer(this,{draw:{highlight:r,active:!0}});this.highlights=new BoardLayer(this,{draw:{highlight:r,fill:!1,stroke:!1,extra:!1}});this.overlay=new Layer(this);this.backgroundImage="";this.overlays={};this.overlayId=0;this.allowSync=!1;this.syncNew={};this.syncChanged={};this.syncDelete={};this.syncActive=!1;this.syncOrder=[];this.socket={};this.reconnects=0;this.name="javad6";this.userId=1218010;var i={nr:6,id:1218010,pic:null,name:"javad6",mouse:[50,100],active:[]};this.editorId=6;this.allowSync=!0;ui.sharing.setAccess("own");this.editorNr=6;ui.editors.add(i);ui.phone.addUser(i);ui.toolbar.setTitle("hhhhhhhh");this.access="own";this.editors[i.nr]=i;$("#lock-reason-reconnect-manual .button").click(function(n){return function(){n.socket.connect();n.reconnects=0;n.lock("load")}}(this));this.androidInput=!1;navigator.userAgent.toLowerCase().indexOf("android")>-1?(this.androidInput=!0,this.input=$('<textarea id="input-element" class="allow-propagation" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">')):this.input=$('<div id="input-element" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true">');this.textActive=null;this.caretVisible=0;this.previousTextState={text:null};this.cursorOverHandle=!1;this.container=$(t);this.container.append([this.background.canvas,this.locked.canvas,this.fixed.canvas,this.others.canvas,this.active.canvas,this.highlights.canvas,this.overlay.canvas,this.input[0]]);this.clipboard=null;ui.pointer.init(this.container);this.container.on("wheel",function(n){return function(){return;var t}}(this)());this.refresh();this.draw()}var i,t,r,f,u,e,o;return r="hsla(210,100%,50%,.3)",t=5,i=8,f={tl:"br",tr:"bl",bl:"tr",br:"tl"},u=Math.tan(Math.PI/8),o=-3,e=3,n.prototype.init=function(){var n,i,r,t;for(this.releaseAll(),t=[this.locked,this.fixed,this.others,this.active,this.highlights],n=0,r=t.length;r>n;n++)i=t[n],i.empty();this.backgroundImage="";this.emptyEditors();this.index.length=0;this.objects={};this.selection=!1;this.syncNew={};this.syncChanged={};this.syncDelete={};this.syncActive=!1;this.nextSync();idroo.history.clear()},n.prototype.nextSync=function(){var n;return n=Date.now(),this.sync(function(t){return function(){var u,i,r;return r=250,i=Date.now()-n,u=Math.max(5,Math.min(r-i)),setTimeout(function(){return t.nextSync()},400)}}(this))},n.prototype.save=function(n){return this.socket.emit("save"),this.socket.once("saved",n)},n.prototype.lock=function(n,t){return null==t&&(t=0),this.lockTimeout&&(clearTimeout(this.lockTimeout),this.lockTimeout=!1),this.lockTimeout=setTimeout(function(){return $("#lock-message .lock-reason").hide().filter("#lock-reason-"+n).show(),$("#lock").fadeIn()},t)},n.prototype.unlock=function(){return this.lockTimeout&&(clearTimeout(this.lockTimeout),this.lockTimeout=!1),$("#lock").fadeOut()},n.prototype.canEdit=function(){var n;return"own"===(n=this.access)||"edit"===n},n.prototype.setAccess=function(n){this.socket.emit("set","access",n);ui.sharing.setAccess(n)},n.prototype.grantAccess=function(n,t){this.socket.emit("grant access",n,t)},n.prototype.sendChat=function(n){this.socket.emit("chat",n)},n.prototype.removeEditor=function(n){ui.editors.remove(n);ui.phone.removeUser(n);delete this.editors[n];this.others.to(n,this.fixed,this.locked).remove(n);this.overlay.changed=!0},n.prototype.emptyEditors=function(){for(var n in this.editors)ui.editors.remove(n),ui.phone.removeUser(n);this.editors={}},n.prototype.changeBackground=function(n){this.socket.emit("set background",n);this.setBackground(n)},n.prototype.changeTitle=function(n){this.socket.emit("set","title",n)},n.prototype.setBackground=function(n){var t;ui.settings.selectBackground(n);""===n?(this.backgroundImage="",this.background.changed=!0):(t=new Image,t.onload=function(n){return function(){return n.backgroundImage=t,n.background.changed=!0}}(this),t.src=n)},n.prototype.uid=function(){for(var t,n="",i=t=1;4>=t;i=++t)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()));return this.objects[n]?this.uid():n},n.prototype.refresh=function(){var n,t,r,i;for(this.width=this.container.width(),this.height=this.container.height(),i=[this.background,this.locked,this.fixed,this.others,this.active,this.highlights,this.overlay],n=0,r=i.length;r>n;n++)t=i[n],t.canvas.width=this.width,t.canvas.height=this.height,t.changed=!0;this.updateViewport()},n.prototype.coordsFromPointer=function(n,t){return[MyMath.round2(n*this.zoom-this.x),MyMath.round2(t*this.zoom-this.y)]},n.prototype.pickActiveHandle=function(n,t){var i;return this.active.index.length?(i=this.pickScaleHandle(n,t))?(this.activeScaleHandle=i,this.action="scale",this.scaleFrom=this.scaleTo=this.activeBounds.slice(0),!0):this.pickRotateHandle(n,t)?(this.rotateCenter=[(this.activeBounds[0]+this.activeBounds[2])/2,(this.activeBounds[1]+this.activeBounds[3])/2],this.rotateFrom=this.rotateTo=[n,t],this.action="rotate",!0):!1:!1},n.prototype.pointerDown=function(n,t){var o,i,f,e,s,r,u;if(e=this.coordsFromPointer(n,t),r=e[0],u=e[1],f=this.pointer,f.offsetX=n,f.offsetY=t,f.startX=f.x=f.shadowX=r,f.startY=f.y=f.shadowY=u,!this.canEdit())return void(this.action="pan");switch(this.syncPointer=!0,ui.keyboard.modifiers.shift||ui.keyboard.modifiers.ctrl||ui.keyboard.modifiers.meta?this.highlight():this.highlightOff(),this.action=idroo.action,this.action){case"draw":if("Text"===(s=idroo.objectType)||"Formula"===s){if(this.pickActiveHandle(r,u))return;if((i=this.active.pickObject(r,u))?this.objects[i].type!==idroo.objectType&&(i=null):(i=this.fixed.pickObject(r,u))&&(this.objects[i].type===idroo.objectType?(this.releaseAll(),this.selectObjects(i),this.beginTextInput(i)):i=null),i)return this.objects[i].mousedown(r,u,ui.keyboard.modifiers),this.active.changed=!0,this.action="text-mouse",this.caretVisible=0,void this.setCursor()}this.releaseAll();i=this.uid();o=new(DrawObject.byType(idroo.objectType))(r,u,idroo.style);this.addObject(i,o,this.active);break;case"point":ui.keyboard.modifiers.shift||ui.keyboard.modifiers.ctrl||ui.keyboard.modifiers.meta?(this.selection=[r,u,r,u],this.overlay.changed=!0,this.action="select"):this.pickActiveHandle(r,u)||((i=this.active.pickObject(r,u))?i===this.textActive?(this.objects[this.textActive].mousedown(r,u,ui.keyboard.modifiers),this.active.changed=!0,this.action="text-mouse",this.caretVisible=0):this.action="move":(i=this.fixed.pickObject(r,u))?(this.selectObjects(i),this.action="move"):(this.active.isEmpty()||this.releaseAll(),this.selection=[r,u,r,u],this.overlay.changed=!0,this.action="select"));break;case"erase":this.deleteUnderEraser(r,u)}this.setCursor();"text-mouse"!==this.action&&this.endTextInput();$(":input:focus").blur()},n.prototype.setPointerTo=function(n,t){var i;this.pointer.offsetX=n;this.pointer.offsetY=t;i=this.coordsFromPointer(n,t);this.pointer.x=i[0];this.pointer.y=i[1]},n.prototype.pointerMove=function(n,t){if(!(n<1)&&!(t<1)&&!(n>=this.viewport.width-5)&&!(t>=this.viewport.height-5)){var i;return"pan"===this.action?void this.panTo(n,t):(this.setPointerTo(n,t),void(this.canEdit()&&(this.syncPointer=!0,this.action?this.handlePointerMove():"point"!==idroo.action&&"Text"!==(i=idroo.objectType)&&"Formula"!==i||this.highlight())))}},n.prototype.panTo=function(n,t){return this.panBy(n-this.pointer.offsetX,t-this.pointer.offsetY),this.setPointerTo(n,t),this.panBy},n.prototype.panBy=function(){return},n.prototype.handlePointerMove=function(){var b,l,a,k,ft,et,d,g,ot,s,nt,st,tt,v,y,it,rt,ut,h,c,i,r,e,o,n,p,t,w;if(s=this.pointer,e=s.startX,o=s.startY,n=s.x,t=s.y,i=s.shadowX,r=s.shadowY,l=i,a=r,i=n,r=t,"move"===this.action||"draw"===this.action&&"Line"===idroo.objectType?(p=1,w=t>o==n>e?1:-1,k=Math.abs((t-o)/(n-e)),ui.keyboard.modifiers.shift&&(u>k?r=o:k>3*u?i=e:(nt=Geometry.directionalDistance([n,t],[e+p,o+w],[e,o]),h=nt[0],c=nt[1],i=MyMath.round2(e+h),r=MyMath.round2(o+c)))):"draw"===(st=this.action)&&this.activeObject()[1]instanceof DrawRectangle?(p=1,w=t>o==n>e?1:-1,ui.keyboard.modifiers.shift&&(tt=Geometry.directionalDistance([n,t],[e+p,o+w],[e,o]),h=tt[0],c=tt[1],i=MyMath.round2(e+h),r=MyMath.round2(o+c))):"scale"!==this.action||"tl"!==(v=this.activeScaleHandle)&&"tr"!==v&&"bl"!==v&&"br"!==v||(b=!1,1!==this.active.index.length||"Line"!==(y=this.activeObject()[1].type)&&"Rectangle"!==y&&"Ellipse"!==y&&"Text"!==y||(b=!0),b===ui.keyboard.modifiers.shift&&(it=this.scaleHandleOffset(),d=it[0],g=it[1],rt=ot=this.getScaleOrigin(f[this.activeScaleHandle]),ft=rt[0],et=rt[1],ut=Geometry.directionalDistance([n-d,t-g],this.getScaleOrigin(this.activeScaleHandle),ot),h=ut[0],c=ut[1],i=MyMath.round2(ft+h+d),r=MyMath.round2(et+c+g))),s.shadowX=i,s.shadowY=r,l=i-l,a=r-a,l||a)switch(this.action){case"draw":this.active.each(function(){return function(n,t){return t.update(i,r)}}(this));this.active.toMap(this.syncChanged);this.active.changed=!0;break;case"move":this.active.each(function(){return function(n,t){return t.move(l,a)}}(this));this.active.toMap(this.syncChanged);this.active.changed=!0;this.calculateActiveBounds();this.refreshBounds();break;case"scale":this.moveScaleHandleTo(i,r);this.active.each(function(n){return function(t,i){return i.scale(n.scaleTo,n.activeBounds)}}(this));this.active.toMap(this.syncChanged);this.active.changed=!0;this.scaleTo=this.activeBounds.slice(0);this.refreshBounds();break;case"rotate":this.active.each(function(i){return function(r,u){return u.rotate(i.rotateCenter,i.rotateTo,[n,t])}}(this));this.active.toMap(this.syncChanged);this.active.changed=!0;this.rotateTo=[n,t];this.overlay.changed=!0;this.refreshBounds();break;case"select":this.selection[2]=n;this.selection[3]=t;this.overlay.changed=!0;this.highlight();break;case"text-mouse":this.active.each(function(){return function(i,r){return r.mousemove(n,t)}}(this));this.active.changed=!0;this.overlay.changed=!0;break;case"erase":this.deleteUnderEraser(n,t)}},n.prototype.pointerUp=function(){var n,t,r,i;switch(this.action){case"draw":i=this.activeObject();t=i[0];n=i[1];this.active.each(function(n,t){return t.repair()});this.active.toMap(this.syncChanged);this.active.changed=!0;n instanceof DrawText||n instanceof DrawFormula?(n.fixOrientation(),this.beginTextInput(t)):this.active.to(this.fixed);this.syncActive=!0;idroo.history.addCreate(t);break;case"move":this.highlight();idroo.history.addMove(this.active.index,this.pointer.shadowX-this.pointer.startX,this.pointer.shadowY-this.pointer.startY);break;case"scale":this.active.each(function(n,t){return t.repair()});this.active.changed=!0;this.highlight();this.calculateActiveBounds();this.activeScaleHandle=!1;idroo.history.addScale(this.active.index,this.scaleFrom,this.scaleTo);break;case"rotate":this.highlight();this.calculateActiveBounds();idroo.history.addRotate(this.active.index,this.rotateCenter,this.rotateFrom,this.rotateTo);break;case"select":r=this.getSelectionObjectKeys();this.selectObjects(r);this.selection=!1;this.overlay.changed=!0;this.highlights.empty();this.highlight();break;case"text-mouse":this.active.each(function(n){return function(t,i){return i.mouseup(n.pointer.x,n.pointer.y)}}(this));this.active.changed=!0;this.overlay.changed=!0;break;case"erase":idroo.history.addDelete()}this.action="";this.focusInput()},n.prototype.pointerDblAction=function(n,t){var i,r,u,f,e,o;return u=this.activeObject(),r=u[0],i=u[1],(i instanceof DrawText||i instanceof DrawFormula)&&(this.textActive===r?(f=this.coordsFromPointer(n,t),e=f[0],o=f[1],i.doubleClick(e,o),this.redrawActiveOverlay()):this.beginTextInput(r)),!1},n.prototype.insertUploadFile=function(n,t,i){return null==t&&(t=this.pointer.x),null==i&&(i=this.pointer.y),idroo.plan.f_advanced_tools?this.addOverlay(t,i,idroo.drawer.uploadFile(n,function(n){return function(r,u){if("DUPLICATE"!==r){if(r)return alert(r);n.insertImageByURL(t,i,"/doc/"+u.id+"/0");u.isImage||idroo.drawer.openDocument(u)}}}(this))):void $("#paid-f-advanced-tools").fadeIn()},n.prototype.handleDrop=function(n){var s,h,t,c,i,l,a,r,u,f,v,e,o;if(n.preventDefault(),r=ui.pointer.fetchOffset(n),l=r.offsetX,a=r.offsetY,u=this.coordsFromPointer(l,a),e=u[0],o=u[1],v=n.dataTransfer.getData("text"))return void((i=v.match(/^idroo(:fit)?:(.*)$/))&&(s=":fit"===i[1],this.insertImageByURL(e,o,i[2],s)));for(f=n.dataTransfer.files,t=0,c=f.length;c>t;t++)h=f[t],this.insertUploadFile(h,e,o)},n.prototype.contextmenu=function(){return},n.prototype.contextmenuForActive=function(){return},n.prototype.setCursor=function(){var n,t,i;n=["cursor"];n.push("action-"+(this.action||idroo.action));ui.keyboard.modifiers.shift||ui.keyboard.modifiers.ctrl||ui.keyboard.modifiers.meta||((t=this.cursorOverHandle||this.activeScaleHandle)?n.push("handle-"+t):(i=this.highlights.index.length)?1===i?this.textActive&&this.textActive===this.highlights.index[0]?n.push("text-beam"):"draw"===idroo.action&&this.objects[this.highlights.index[0]].type===idroo.objectType?n.push("text-beam"):n.push("move"):n.push("move"):idroo.objectType&&n.push(idroo.objectType));this.container.attr("class",n.join(" "))},n.prototype.zoomTo=function(){return},n.prototype.zoomBy=function(n,t,i){null==t&&(t=this.pointer.offsetX);null==i&&(i=this.pointer.offsetY);this.zoomTo(this.zoomLevel+n,t,i)},n.prototype.updateViewport=function(){this.viewport.x=this.x;this.viewport.y=this.y;this.viewport.width=this.width*this.zoom;this.viewport.height=this.height*this.zoom},n.prototype.pointToViewport=function(n){var t,i;return t=n[0],i=n[1],[(t+this.x)/this.zoom,(i+this.y)/this.zoom]},n.prototype.rectangleToViewport=function(n){var t,i,r,u;return t=n[0],r=n[1],i=n[2],u=n[3],[(t+this.x)/this.zoom,(r+this.y)/this.zoom,(i+this.x)/this.zoom,(u+this.y)/this.zoom]},n.prototype.addOverlay=function(n,t,i){var r;r=this.overlayId++;this.overlays[r]=i;this.positionOverlay(i.data({x:n,y:t}));this.container.append(i.addClass("overlay"));i.on("done",function(n){return function(){return i.fadeOut(500,function(){return delete n.overlays[r]})}}(this))},n.prototype.positionOverlay=function(n){return n.css({left:(this.x+n.data("x"))/this.zoom,top:(this.y+n.data("y"))/this.zoom})},n.prototype.positionOverlays=_.throttle(function(){var i,r,n,t;n=this.overlays;t=[];for(i in n)r=n[i],t.push(this.positionOverlay(r));return t},50,{leading:!1}),n.prototype.beginTextInput=function(n){var i,t,r;t=this.objects[n];this.textActive=n;this.caretVisible=1;this.overlay.changed=!0;this.previousTextState=t.getState();t instanceof DrawFormula&&ui.style.toggleFormulaButtons(!0);i=!1;r=function(){return i=!0,setTimeout(function(){return i=!1},1)};this.caretBlink&&clearInterval(this.caretBlink);this.caretBlink=setInterval(function(n){return function(){return n.textActive?(n.caretVisible++,n.caretVisible%=3,n.overlay.changed=!0):(clearInterval(n.caretBlink),void delete n.caretBlink)}}(this),300);this.input.on("keydown.input",function(i){return function(u){var f;if(ui.keyboard.trackModifiers(u),i.caretVisible=1,f=u.which,indexOf.call(DrawText.KB,f)>=0)return i.previousTextState=t.getState(),t.handleKeyDown(f,ui.keyboard.modifiers)&&(i.syncChanged[n]=t),i.redrawActiveOverlay(),i.recordTextHistory(),!1;switch(idroo.utils.extractShortcut(u)){case"space":u.stopPropagation();break;case"tab":return i.insertText("\t");case"return":return i.insertText("\n");case"esc":return i.endTextInput(),!1;case"ctrl+a":case"meta+a":return t.selectAll(),i.redrawActiveOverlay(),!1;case"ctrl+c":case"ctrl+shift+c":case"ctrl+insert":case"meta+c":case"meta+shift+c":return void r();case"ctrl+v":case"ctrl+shift+v":case"shift+insert":case"meta+v":case"meta+shift+v":return void r();case"ctrl+x":case"meta+x":return void r();case"ctrl+z":case"ctrl+shift+z":case"ctrl+y":case"meta+z":case"meta+shift+z":case"meta+y":return u.preventDefault(),!0}u.stopPropagation()}}(this));this.androidInput?this.input.on("input.input",function(n){return function(){return n.insertText(n.input.val()),n.input.val("").blur().focus(),!1}}(this)):this.input.on("keypress.input",function(n){return function(t){if(!i)return(t.charCode&&n.insertText(String.fromCharCode(t.charCode)),!1)}}(this));this.input.on("keyup.input",function(){return function(n){var t,i;return t=n.keyCode,indexOf.call(DrawText.KB,t)>=0?!1:void(32===(i=n.keyCode)&&n.stopPropagation())}}(this));$("body").on("focus.input",":input:not(#input-element)",function(n){return function(){n.endTextInput()}}(this));t.mousedown(this.pointer.x,this.pointer.y);t.mouseup(this.pointer.x,this.pointer.y);this.active.changed=!0;this.focusInput()},n.prototype.endTextInput=function(){var t,n;this.textActive&&(n=this.objects[t=this.textActive],n.resetCaret(),n.autosize=!1,this.recordTextHistory(),this.textActive=null,$("body").off(".input"),this.input.off(".input"),this.input.empty(),this.overlay.changed=!0,this.active.changed=!0,n.canDelete&&(this.deleteObjects([t]),idroo.history.forget(t)),ui.style.toggleFormulaButtons(!1))},n.prototype.insertText=function(n){var t;if(this.textActive)return t=this.objects[this.textActive],this.previousTextState=t.getState(),t.insertText(n),this.syncChanged[this.textActive]=t,this.redrawActiveOverlay(),this.recordTextHistory(),!1},n.prototype.recordTextHistory=function(){var n;this.textActive&&(n=this.objects[this.textActive].getState(),n.text!==this.previousTextState.text&&(idroo.history.addText(this.textActive,this.previousTextState,n),this.previousTextState=n))},n.prototype.addObject=function(n,t,i,r){null==i&&(i=this.fixed);null==r&&(r=!0);this.index.push(n);this.objects[n]=t;r&&(delete this.syncDelete[n],this.syncNew[n]=t,this.syncActive=!0);i.add(n);t.changeCaller&&(t.callChange=function(i){return function(r){if(n in i.objects)return(r&&(i.syncChanged[n]=i.objects[n],(t instanceof DrawText||t instanceof DrawFormula)&&idroo.history.fixScale(n,t.bounds)),i.markObjectLayersChanged(n),i.checkActiveTouched(n),i.highlights.changed=!0,i.highlight(),i.refreshBounds())}}(this));i===this.active&&"draw"!==this.action&&this.calculateActiveBounds()},n.prototype.insertImageByURL=function(n,t,i,r){var u;null==r&&(r=!1);u=document.createElement("img");u.src=i;$(u).on("load",function(f){return function(){var e,l,a,s,h,c,v,o;o=u.width;e=u.height;r&&(h=Math.max(.8*f.width,500),s=Math.max(.8*f.height,500),o>h&&(e=e*h/o,o=h),e>s&&(o=o*s/e,e=s),o=Math.floor(o),e=Math.floor(e));l=n-Math.floor(o/2);a=t-Math.floor(e/2);v=f.uid();c=new DrawImage(l,a,idroo.style);c.setSource(i);c.update(l+o,a+e,{});f.addObject(v,c);idroo.history.addCreate(v);f.redraw()}}(this))},n.prototype.highlight=_.throttle(function(n){var f,o,s,t,i,e,h,c,r,u;n!==!1&&this.canEdit()&&(c=this.cursorOverHandle,this.cursorOverHandle=!1,e=this.pointer,r=e.x,u=e.y,f=function(n){return function(t,i){var r;return n.active.index.length?(r=n.pickScaleHandle(t,i))?(n.cursorOverHandle=r,n.active.index):n.pickRotateHandle(t,i)?(n.cursorOverHandle="rotate",n.active.index):!1:!1}}(this),"point"===idroo.action||"select"===this.action?(i=[],"select"===this.action||ui.keyboard.modifiers.shift||ui.keyboard.modifiers.ctrl||ui.keyboard.modifiers.meta?i=this.getSelectionObjectKeys():(s=f(r,u))?i.push.apply(i,s):(t=this.active.pickObject(r,u))?i.push.apply(i,this.active.index):(t=this.fixed.pickObject(r,u))&&i.push(t),o=this.cursorOverHandle?c!==this.cursorOverHandle:!t||t!==this.highlights.pickObject(r,u),o&&(this.highlights.empty(),i.length&&this.highlights.add(i))):"draw"!==idroo.action||this.action||"Text"!==(h=idroo.objectType)&&"Formula"!==h?this.highlights.empty():((t=f(r,u)[0])||(t=this.active.pickObject(r,u))||(t=this.fixed.pickObject(r,u))&&this.objects[t].type!==idroo.objectType&&(t=null),t!==this.highlights.index[0]&&(this.highlights.empty(),t&&this.highlights.add(t))),this.setCursor())},50),n.prototype.highlightOff=function(){this.highlight(!1);this.highlights.empty()},n.prototype.changeObjectText=function(n,t){var i;i=this.objects[n];i.setState(t);this.markObjectLayersChanged(n);n===this.textActive&&(this.previousTextState=t);this.redrawActiveOverlay();this.syncChanged[n]=i;this.checkActiveTouched(n);this.highlight();this.refreshBounds()},n.prototype.formulaInsert=function(){var n,t,r,i;r=1<=arguments.length?slice.call(arguments,0):[];i=this.activeObject();t=i[0];n=i[1];t===this.textActive&&n instanceof DrawFormula&&(this.previousTextState=n.getState(),n.insertFromToolbar.apply(n,r),this.recordTextHistory(),this.syncChanged[t]=n)},n.prototype.selectAll=function(){this.active.to(this.fixed,this.locked);this.selectObjects(this.fixed.index.slice(0))},n.prototype.selectObjects=function(n){this.endTextInput();this.active.to(this.fixed,this.locked);this.locked.remove(n);this.fixed.remove(n);this.active.add(n);this.syncActive=!0;this.highlights.index.length&&(this.highlights.empty(),this.highlight());this.calculateActiveBounds();this.updateToolbars()},n.prototype.updateToolbars=function(){var t,n,i,e,o,u,f,r;for(r={},r[idroo.objectType]=1,u=this.active.index,t=0,e=u.length;e>t;t++)n=u[t],r[this.objects[n].type]=1;for(ui.style.types(r),f=this.active.index,i=0,o=f.length;o>i;i++)n=f[i],this.objects[n]instanceof DrawGroup||ui.style.set(this.objects[n].style)},n.prototype.checkActiveTouched=function(n){var i,t,r,u;if(i=this.active.objects,"string"==typeof n)return void(n in i&&this.calculateActiveBounds());for(t=0,u=n.length;u>t;t++)if(r=n[t],r in i)return void this.calculateActiveBounds()},n.prototype.releaseAll=function(){return this.selectObjects([])},n.prototype.activeObject=function(){var n,t;return 1===(n=this.active.index).length?[t=n[0],this.objects[t]]:[null,null]},n.prototype.getSelectionOnLayer=function(n){var i,t,r;return(t=this.selection)?(r=t[0]===t[2]&&t[1]===t[3],r?(i=n.pickObject(t[0],t[1]))?[i]:[]:n.pickObjects(t)):(i=n.pickObject(this.pointer.x,this.pointer.y))?[i]:[]},n.prototype.getSelectionObjectKeys=function(){var t,n;return n=this.getSelectionOnLayer(this.fixed),t=this.getSelectionOnLayer(this.active),(ui.keyboard.modifiers.shift||ui.keyboard.modifiers.ctrl||ui.keyboard.modifiers.meta)&&n.push.apply(n,this.active.index),t.length&&(ui.keyboard.modifiers.ctrl||ui.keyboard.modifiers.meta?n.removeItems(t):ui.keyboard.modifiers.shift||n.push.apply(n,t)),n},n.prototype.refreshBounds=_.throttle(function(){this.bounds={left:0,top:0,width:this.viewport.width,height:this.viewport.height}},50,{leading:!1}),n.prototype.calculateActiveBounds=function(){var y,p,w,b,h,k,rt,ut,n,d,g,nt,tt,c,l,a,v,it,t,i,r,u,f,e,o,s;if(!this.active.index.length)return void(this.activeBounds&&(this.overlay.changed=!0,this.activeBounds=!1,this.activeBoundsOffset=!1));for(it=this.active.index,h=k=0,ut=it.length;ut>k;h=++k)rt=it[h],n=this.objects[rt],h?(t=n.bounds,y=t[0],w=t[1],p=t[2],b=t[3],f>y&&(f=y),o>w&&(o=w),p>e&&(e=p),b>s&&(s=b),i=n.outerBounds,d=i[0],nt=i[1],g=i[2],tt=i[3],c>d&&(c=d),a>nt&&(a=nt),g>l&&(l=g),tt>v&&(v=tt)):(r=n.bounds,f=r[0],o=r[1],e=r[2],s=r[3],u=n.outerBounds,c=u[0],a=u[1],l=u[2],v=u[3]);this.activeBounds=[f,o,e,s];this.activeBoundsOffset=[c-f,a-o,l-e,v-s];this.calculateScalePoints()},n.prototype.outerActiveBounds=function(){var s,h,c,l,f,e,o,a,v,n,i,r,u;return e=this.activeBounds,n=e[0],r=e[1],i=e[2],u=e[3],o=this.activeBoundsOffset,s=o[0],c=o[1],h=o[2],l=o[3],a=i>n?[n+s,i+h]:[i-h,n-s],n=a[0],i=a[1],v=u>r?[r+c,u+l]:[u-l,r-c],r=v[0],u=v[1],f=t,[n-f,r-f,i+f,u+f]},n.prototype.getScaleOrigin=function(n){var t,i,r,u,f;switch(t=this.scaleFrom,i=t[0],u=t[1],r=t[2],f=t[3],n){case"tl":return[i,u];case"tr":return[r,u];case"bl":return[i,f];case"br":return[r,f]}},n.prototype.scaleHandleOffset=function(){var n,f,e,l,a,v,y,r,u,i,o,s,h,c;return r=this.activeBounds,o=r[0],h=r[1],s=r[2],c=r[3],u=this.activeBoundsOffset,l=u[0],v=u[1],a=u[2],y=u[3],i=this.activeScaleHandle,"l"===i||"tl"===i||"bl"===i?(n=l-t,f=s>o?n:-n):(n=a+t,f=s>o?n:-n),"t"===i||"tl"===i||"tr"===i?(n=v-t,e=c>h?n:-n):(n=y+t,e=c>h?n:-n),[f,e]},n.prototype.calculateScalePoints=function(){var n,s,o,h,e,r,u,i,f;e=this.outerActiveBounds();r=e[0];i=e[1];u=e[2];f=e[3];o=(r+u)/2;h=(i+f)/2;n={tl:[r,i],tr:[u,i],bl:[r,f],br:[u,f]};s=10;f-i>s&&(n.l=[r,h],n.r=[u,h]);u-r>s&&(n.t=[o,i],n.b=[o,f]);n.o=[o,i-5*t];this.scaleHandles=n;this.overlay.changed=!0},n.prototype.pickScaleHandle=function(n,r){var o,s,h,c,l,u,f,b,k,a,v,e,y,p,w;if((l=i*this.zoom,v=t*this.zoom,u=l-v,f=2*v+u,e=this.outerActiveBounds(),o=e[0],h=e[1],s=e[2],c=e[3],a=[n,r],Geometry.pointInRectangle(a,[o+u,h+u,s-u,c-u]))||!Geometry.pointInRectangle(a,[o-f,h-f,s+f,c+f]))return!1;y=this.scaleHandles;for(w in y)if(p=y[w],b=p[0],k=p[1],Geometry.pointInSquare(n,r,b,k,l))return w;return!1},n.prototype.pickRotateHandle=function(n,t){var u,f,r;if(null!=this.scaleHandles.o)return r=this.scaleHandles.o,u=r[0],f=r[1],Geometry.pointInSquare(n,t,u,f,i*this.zoom)},n.prototype.moveScaleHandleTo=function(n,i){var u,l,a,v,y,h,c,r,f,e,o,s;r=this.activeScaleHandle;h=this.activeBounds;f=h[0];o=h[1];e=h[2];s=h[3];c=this.activeBoundsOffset;l=c[0];v=c[1];a=c[2];y=c[3];"l"!==r&&"tl"!==r&&"bl"!==r||(u=t-l,f=e>n?Math.min(e+.01,n+u):Math.max(e-.01,n-u));"t"!==r&&"tl"!==r&&"tr"!==r||(u=t-v,o=s>i?Math.min(s+.01,i+u):Math.max(s-.01,i-u));"r"!==r&&"tr"!==r&&"br"!==r||(u=t+a,e=n>f?Math.max(f-.01,n-u):Math.min(f+.01,n+u));"b"!==r&&"bl"!==r&&"br"!==r||(u=t+y,s=i>o?Math.max(o-.01,i-u):Math.min(o+.01,i+u));this.activeBounds=[f,o,e,s];this.calculateScalePoints()},n.prototype.deleteSelected=function(){this.active.index.length&&(idroo.history.addDelete(this.active.index),this.deleteObjects(this.active.index.slice(0)),this.setCursor(),this.syncActive=!0)},n.prototype.deleteObjects=function(n,t){var e,r,i,u,o,s,f;if(null==t&&(t=!0),f=!1,e=this.active.objects,t)for(r=0,o=n.length;o>r;r++)i=n[r],delete this.syncNew[i],delete this.syncChanged[i],this.syncDelete[i]=!0,!f&&i in e&&(f=!0);for(1===n.length&&n[0]===this.textActive&&this.endTextInput(),this.locked.remove(n),this.fixed.remove(n),this.active.remove(n),this.highlights.remove(n),u=0,s=n.length;s>u;u++)i=n[u],delete this.objects[i];this.index.removeItems(n);f&&(this.calculateActiveBounds(),this.syncActive=!0);this.highlight();this.updateToolbars()},n.prototype.deleteUnderEraser=function(n,t){var i;i=this.fixed.pickObjects([n-11,t-11,n+11,t+11]);i.length&&(idroo.history.addDelete(i,!0),this.deleteObjects(i))},n.prototype.deleteAll=function(){this.releaseAll();idroo.history.addDelete(this.index);this.deleteObjects(this.index.slice(0),!0)},n.prototype.focusInput=function(n){var t,i;(this.textActive||n)&&(this.input.focus(),this.androidInput||(0===this.input.text().length&&this.input.text("nada"),t=document.createRange(),t.selectNodeContents(this.input[0]),i=window.getSelection(),i.removeAllRanges(),i.addRange(t)))},n.prototype.copy=function(n,t){var i,r;if(!this.active.index.length)return!1;if(this.textActive){if(r=this.objects[this.textActive],r instanceof DrawFormula)return(i=r.selectedFormula())&&(n("idroo/formula",AJson.stringify(i)),t&&this.insertText("")),!1;if(r instanceof DrawText)return(i=r.selectedText())&&(n("text/plain",i),t&&this.insertText("")),!1}return i=[],this.active.each(function(){return function(n,t){return i.push(t.serialize())}}(this)),n("idroo/objects",AJson.stringify(i)),i.length&&t&&this.deleteSelected(),!1},n.prototype.pasteText=function(n){var t,i,r,u,f;r=this.pointer;u=r.x;f=r.y;n=n.replace(/\r/g,"");this.textActive?this.insertText(n):(t=this.uid(),this.addObject(t,i=new DrawText(u,f)),i.update(u,f),i.insertText(n),i.measure(),this.centerPastedOnMouse(t),idroo.history.addCreate(t),this.selectObjects(t))},n.prototype.pasteObjects=function(n){var i,r,t,u,e,f;for(t=[],i=0,u=n.length;u>i;i++)f=n[i],t.push(r=this.uid()),this.addObject(r,e=DrawObject.restore(f));this.centerPastedOnMouse(t);idroo.history.addCreate(t);this.selectObjects(t)},n.prototype.pasteFormula=function(n){var i,t;(t=this.objects[this.textActive])instanceof DrawFormula?(this.previousTextState=t.getState(),t.insertFormula(n),this.syncChanged[this.textActive]=t,this.redrawActiveOverlay(),this.recordTextHistory()):(i=this.uid(),this.addObject(i,t=new DrawFormula(this.pointer.x,this.pointer.y)),t.insertFormula(n),t.measure(),this.centerPastedOnMouse(i),idroo.history.addCreate(i),this.selectObjects(i))},n.prototype.centerPastedOnMouse=function(n){var c,a,v,r,u,f,y,p,l,t,i,e,o,s,h;for("string"==typeof n&&(n=[n]),c=[],r=0,y=n.length;y>r;r++)u=n[r],t=this.objects[u].bounds,e=t[0],s=t[1],o=t[2],h=t[3],c.push([e,s],[o,h]);for(i=Geometry.bounding.apply(Geometry,c),e=i[0],s=i[1],o=i[2],h=i[3],a=this.pointer.x-(e+o)/2,v=this.pointer.y-(s+h)/2,f=0,p=n.length;p>f;f++)u=n[f],l=this.objects[u],l.move(a,v),l.serializeChange()},n.prototype.groupSelected=function(){var n;n=this.active.index.slice(0);n.length<2||(idroo.history.addDelete(n),idroo.history.link(),idroo.history.addCreate(this.groupObjects(n)))},n.prototype.groupObjects=function(n,t){var r,u,i,f;return null==t&&(t=!0),f=function(){var t,u,i;for(i=[],t=0,u=n.length;u>t;t++)r=n[t],i.push(this.objects[r]);return i}.call(this),i=this.uid(),u=function(n,t,i){i.prototype=n.prototype;var u=new i,r=n.apply(u,t);return Object(r)===r?r:u}(DrawGroup,f,function(){}),this.deleteObjects(n),this.addObject(i,u,this.active),i},n.prototype.ungroupSelected=function(){var t,n;this.active.index.length&&(n=function(){var n,u,i,r;for(i=this.active.index,r=[],n=0,u=i.length;u>n;n++)t=i[n],this.objects[t]instanceof DrawGroup&&r.push(t);return r}.call(this),n.length&&(idroo.history.addDelete(n),idroo.history.link(),idroo.history.addCreate(this.ungroupObjects(n))))},n.prototype.ungroupObjects=function(n){var f,t,e,i,o,s,h,c,r,u;for(r=[],t=0,o=n.length;o>t;t++)for(e=n[t],h=this.objects[e],u=h.objects,i=0,s=u.length;s>i;i++)f=u[i],r.push(c=this.uid()),this.addObject(c,f,this.active);return this.deleteObjects(n),r},n.prototype.applyStyle=function(n){this.active.isEmpty()||(idroo.history.addStyle(this.active.index,n),this.active.each(function(){return function(t,i){return i.setStyle(n)}}(this)),this.active.toMap(this.syncChanged),this.active.changed=!0,null==n.stroke&&null==n.strokeWidth||this.calculateActiveBounds())},n.prototype.changeObjectStyle=function(n,t){var i;(i=this.objects[n])&&(i.setStyle(t),this.syncChanged[n]=i,this.markObjectLayersChanged(n),null==t.stroke&&null==t.strokeWidth||this.checkActiveTouched(n))},n.prototype.changeObjectsStyle=function(n,t){for(var r,u,i=0,f=n.length;f>i;i++)r=n[i],(u=this.objects[r])&&(u.setStyle(t),this.syncChanged[r]=u);this.markObjectLayersChanged(n);null==t.stroke&&null==t.strokeWidth||this.checkActiveTouched(n)},n.prototype.moveSelected=function(n,t){this.active.isEmpty()||(this.active.each(function(){return function(i,r){return r.move(n,t)}}(this)),this.active.toMap(this.syncChanged),this.active.changed=!0,idroo.history.addMove(this.active.index,n,t),this.calculateActiveBounds(),this.afterChangeObjects())},n.prototype.moveObjects=function(n,t,i){for(var u,f,r=0,e=n.length;e>r;r++)u=n[r],(f=this.objects[u])&&(f.move(t,i),this.syncChanged[u]=f);this.afterChangeObjects(n)},n.prototype.scaleObjects=function(n,t,i){for(var u,f,r=0,e=n.length;e>r;r++)u=n[r],(f=this.objects[u])&&(f.scale(t,i),this.syncChanged[u]=f);this.afterChangeObjects(n)},n.prototype.rotateObjects=function(n,t,i,r){for(var f,e,u=0,o=n.length;o>u;u++)f=n[u],(e=this.objects[f])&&(e.rotate(t,i,r),this.syncChanged[f]=e);this.afterChangeObjects(n)},n.prototype.afterChangeObjects=function(n){n&&(this.markObjectLayersChanged(n),this.checkActiveTouched(n));this.highlightOff();this.highlight()},n.prototype.bringSelectedToFront=function(){var n;return n=this.active.index.slice(0),this.syncOrder.push(["front",n]),this.bringObjectsToFront(n)},n.prototype.sendSelectedToBack=function(){var n;return n=this.active.index.slice(0),this.syncOrder.push(["back",n]),this.sendObjectsToBack(n)},n.prototype.moveSelectedForward=function(){var n;return n=this.active.index.slice(0),this.syncOrder.push(["forward",n]),this.moveObjectsForward(n)},n.prototype.moveSelectedBackward=function(){var n;return n=this.active.index.slice(0),this.syncOrder.push(["backward",n]),this.moveObjectsBackward(n)},n.prototype.bringObjectsToFront=function(n){var t;return this.index.removeItems(n),(t=this.index).push.apply(t,n)},n.prototype.sendObjectsToBack=function(n){var t;return this.index.removeItems(n),(t=this.index).unshift.apply(t,n)},n.prototype.moveObjectsForward=function(n){var t,i;return t=1+this.index.indexOf(n[n.length-1]),0!==t&&t!==this.index.length?(this.index.removeItems(n),(i=this.index).splice.apply(i,[t-n.length+1,0].concat(slice.call(n)))):void 0},n.prototype.moveObjectsBackward=function(n){var t,i;return t=this.index.indexOf(n[0]),1>t?void 0:(this.index.removeItems(n),(i=this.index).splice.apply(i,[t-1,0].concat(slice.call(n))))},n.prototype.lockSelected=function(){return idroo.history.addLock(this.active.index),this.setLockObjects(this.active.index,!0),this.releaseAll()},n.prototype.unlockSelected=function(){return idroo.history.addUnlock(this.active.index),this.setLockObjects(this.active.index,!1),this.releaseAll()},n.prototype.setLockObjects=function(n,t){var i,r,f,u;for(this.markObjectLayersChanged(n),i=0,f=n.length;f>i;i++)r=n[i],(u=this.objects[r])&&(u.setLocked(t),this.syncChanged[r]=u);return this.correctLocks(n)},n.prototype.correctLocks=function(n){var u,t,f,e,i,r;for(i=[],r=[],u=0,f=n.length;f>u;u++)t=n[u],(e=this.objects[t])&&(e.locked?t in this.fixed.objects&&i.push(t):t in this.locked.objects&&r.push(t));i.length&&(this.fixed.remove(i),this.locked.add(i));r.length&&(this.locked.remove(r),this.fixed.add(r));(i.length||r.length)&&(this.fixed.changed=!0,this.locked.changed=!0)},n.prototype.draw=function(){return this.drawBackground(),this.locked.draw(),this.fixed.draw(),this.others.draw(),this.active.draw(),this.highlights.draw(),this.drawOverlay(),requestAnimationFrame(function(n){return function(){return n.draw()}}(this)),this},n.prototype.drawToDataURL=function(){var n,f,i,s,r,h,v,y,p,e,u,c,w,o,l,a,b,t;for(e=400,o=this.bounds,v=o.left,b=o.top,t=o.width,i=o.height,t>i?(i=e*i/t|0,t=e):(t=e*t/i|0,i=e),f=$("<canvas>")[0],f.width=t,f.height=i,n=f.getContext("2d"),r=t/this.bounds.width,n.scale(r,r),this.backgroundImage&&(w=n.createPattern(this.backgroundImage,"repeat"),n.fillStyle=w,n.fillRect(0,0,this.bounds.width,this.bounds.height)),n.translate(-v,-b),c={stroke:!0,fill:!0,extra:!0,highlight:!1,points:!1},l=this.index,s=0,y=l.length;y>s;s++)r=l[s],(u=this.objects[r])&&u.locked&&u.draw(n,c);for(a=this.index,h=0,p=a.length;p>h;h++)r=a[h],(u=this.objects[r])&&(u.locked||u.draw(n,c));return f.toDataURL()},n.prototype.drawBackground=function(){return this.background.draw(function(n){return function(t){var i;""===n.backgroundImage?(t.width=t.width,t.clearRect(-n.viewport.x,-n.viewport.y,n.viewport.width,n.viewport.height)):(i=t.createPattern(n.backgroundImage,"repeat"),t.fillStyle=i,t.fillRect(-n.viewport.x,-n.viewport.y,n.viewport.width,n.viewport.height))}}(this)),this},n.prototype.drawOverlay=function(){return this.overlay.draw(function(n){return function(i){var ft,et,ot,a,v,r,y,l,p,w,b,u,st,ht,k,d,g,nt,ct,tt,it,rt,ut,f,e,o,s,lt,h,c;if(n.textActive&&n.caretVisible&&n.objects[n.textActive].drawCaret(i),i.restore(),n.activeBounds){i.save();"rotate"===n.action&&(r=n.pointToViewport(n.rotateCenter),p=n.pointToViewport(n.rotateFrom),rt=n.pointToViewport(n.rotateTo),Graphics.drawRotationHelper(i,r,p,rt),i.translate(r[0],r[1]),i.rotate(Geometry.angleBetweenVectors(r,p,rt)),i.translate(-r[0],-r[1]));Graphics.drawActiveBounds(i,n.rectangleToViewport(n.outerActiveBounds()));k=n.scaleHandles;for(ft in k)u=k[ft],Graphics.drawHandlePoint(i,n.pointToViewport(u),t);i.restore()}s=10;c=10;h=n.width-10-ui.aside.elem.width();o=n.height-10;a=(s+h)/2;v=(c+o)/2;lt=Geometry.v2Length([h-s,o-c])/2;d=n.editors;for(b in d)l=d[b],l.nr!==n.editorNr&&(y=idroo.utils.editorColor(b),g=u=n.pointToViewport(l.mouse),st=g[0],ht=g[1],Geometry.pointInRectangle(u,[s,c,h,o])?Graphics.drawEditorCursor(i,u,y,l.name):(nt=Geometry.v2Scale([st-a,ht-v],lt),f=nt[0],e=nt[1],et=Geometry.angleBetweenVectors([0,0],[-1,1],[f,e]),f=MyMath.limit(s,h,f+a),e=MyMath.limit(c,o,e+v),Graphics.drawEditorCursor(i,[f,e],y,"",et,.5)));n.selection&&Graphics.drawSelectionRectangle(i,n.rectangleToViewport(n.selection));it=n.width-11;tt=n.height-11;w=it*MyMath.limit(0,.95,(-n.bounds.left-n.viewport.x)/n.bounds.width);ct=it*MyMath.limit(.05,1,(-n.bounds.left-n.viewport.x+n.viewport.width)/n.bounds.width);ut=tt*MyMath.limit(0,.95,(-n.bounds.top-n.viewport.y)/n.bounds.height);ot=tt*MyMath.limit(.05,1,(-n.bounds.top-n.viewport.y+n.viewport.height)/n.bounds.height);i.fillStyle="rgba(0,0,0,.3)";i.fillRect(2,2+ut,5,ot-ut);i.fillRect(9+w,n.height-7,ct-w,5);i.save()}}(this)),this},n.prototype.redraw=function(){var n,i,r,t;for(t=[this.background,this.locked,this.fixed,this.others,this.active,this.highlights,this.overlay],n=0,r=t.length;r>n;n++)i=t[n],i.changed=!0},n.prototype.redrawActiveOverlay=function(){this.active.changed=!0;this.overlay.changed=!0},n.prototype.markObjectLayersChanged=function(n){var t,e,i,r,u,o,s,f,h;for(h="string"==typeof n,f=[this.locked,this.fixed,this.others,this.active],t=0,o=f.length;o>t;t++)if(r=f[t],u=r.objects,h)n in u&&(r.changed=!0);else for(i=0,s=n.length;s>i;i++)if(e=n[i],e in u){r.changed=!0;break}},n.prototype.serializeChange=function(){var t,e,n,r,o,s,i,h,u,f;i={};f=[];h={};u=[];t=!1;this.syncPointer&&(i.m=[this.pointer.x,this.pointer.y],this.syncPointer=!1,t=!0);this.syncActive&&(i.a=this.active.index,this.syncActive=!1,t=!0);f=function(){var t,i;t=this.syncNew;i=[];for(n in t)r=t[n],null!=this.objects[n]&&(n in this.syncChanged&&(r.serializeChange(),delete this.syncChanged[n]),i.push([n,r.serialize()]));return i}.call(this);f.length&&(i.n=f,t=!0);e=!1;o=this.syncChanged;for(n in o)r=o[n],this.objects[n]&&(e=!0,h[n]=r.serializeChange());e&&(i.c=h,t=!0);s=this.syncDelete;for(n in s)r=s[n],u.push(n);return u.length&&(i.d=u,t=!0),this.syncOrder.length&&(i.o=this.syncOrder.slice(0),t=!0),this.syncNew={},this.syncChanged={},this.syncDelete={},this.syncOrder.length=0,t?i:null},n.prototype.restoreChange=function(n){n.m&&(this.editors[6].mouse=n.m);var u,f,l,o,s,t,a,i,h,g,nt,tt,c,v,e,r,it,y,p,w,b,k,d;if(n.background&&this.setBackground(n.background),n.editors){u={};y=n.editors;for(l in y)f=y[l],u[l]=f.active,delete f.active,ui.editors.add(f),ui.phone.addUser(f);this.editors=n.editors;this.overlay.changed=!0}if(n.m&&(this.editors[6].mouse=n.m,this.overlay.changed=!0),n.n)for(p=n.n,s=0,g=p.length;g>s;s++)w=p[s],t=w[0],e=w[1],e&&(v=DrawObject.restore(e),this.addObject(t,v,v.locked?this.locked:this.fixed,!1));if(n.c){i=[];b=n.c;for(t in b)e=b[t],this.objects[t].restoreChange(e),this.markObjectLayersChanged(t),i.push(t);this.correctLocks(i);idroo.history.forget(i);this.refreshBounds()}if(n.a&&(this.others.to(n.e,this.fixed,this.locked).add(n.e,n.a),this.locked.remove(n.a),this.fixed.remove(n.a),idroo.history.forget(n.a)),u)for(t in u)o=u[t],this.others.add(t,o),this.locked.remove(o),this.fixed.remove(o),idroo.history.forget(n.a);if(n.d&&this.deleteObjects(n.d,!1),n.o)for(k=n.o,h=0,nt=k.length;nt>h;h++){for(d=k[h],it=d[0],i=d[1],r=[],c=0,tt=i.length;tt>c;c++)a=i[c],a in this.objects&&r.push(a);if(r.length)switch(it){case"front":this.bringObjectsToFront(r);break;case"back":this.sendObjectsToBack(r);break;case"forward":this.moveObjectsForward(r);break;case"backward":this.moveObjectsBackward(r)}}},n.prototype.sync=function(n){var t=this.serializeChange();if(t){if(t.t==undefined&&t.e==undefined&&t.u==undefined&&t.i==undefined&&t.o==undefined&&t.r==undefined&&t.n==undefined&&t.s==undefined&&t.a==undefined&&t.h==undefined&&t.c==undefined&&t.d==undefined){CBoard.MousePointer&&board.user.permission.toolBox&&(p={type:"mouse",action:"board",p:bboard.pageID,f:bboard.fileID,m:t,name:board.shortName},mainApp.sendToServer(p));n();return}p={type:"board",action:"board",p:bboard.pageID,f:bboard.fileID,m:t};board.user.permission.toolBox&&mainApp.sendToServer(p)}n();return},n}();hasProp={}.hasOwnProperty;indexOf=[].indexOf||function(n){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===n)return t;return-1};!function(){var o,f,n,r,i,s,h,c,t,e,l,u;return l=$("#undo-button"),h=$("#redo-button"),t=[],n=0,i={keys:[],objects:[]},f=function(n,t){var i,r,u,f;r={};for(i in n)hasProp.call(n,i)&&(u=n[i],null!=t[i]&&(f="function"==typeof u.push?t[i].slice(0):t[i],r[i]=f));return r},c=function(n,t,i){var u,f,r,h,c,e,o,s,l;if(t.length!==n.keys.length)return!1;l={};for(r in i)if(hasProp.call(i,r)&&null==n.style[r])return!1;e=n.style;for(r in e)if(hasProp.call(e,r)&&null==i[r])return!1;for(s={},o=n.keys,u=0,h=o.length;h>u;u++)r=o[u],s[r]=!0;for(f=0,c=t.length;c>f;f++)if(r=t[f],!s[r])return!1;return!0},u=function(){l.toggleClass("disabled",0===n);h.toggleClass("disabled",n===t.length)},this.idroo.history={updateUI:u,clear:function(){t=[];n=0;i={keys:[],objects:[]};u()},push:r=function(i,r){r.type=i;null==r.time&&(r.time=(new Date).getTime());t.length=n;t.push(r);n++;u()},link:function(){n&&(t[n-1].link=!0)},forget:function(i){var f,e,s,h,c,o,v,y,l,a,r;for("string"==typeof i&&(i=[i]),f=s=v=t.length-1;s>-1;f=s+=-1)switch(r=t[f],r.type){case"create":case"delete":case"style":if(c=r.keys.length,r.keys.removeItems(i),c!==r.keys.length)if(r.keys.length)for(o=r.objects,e=h=y=o.length-1;h>-1;e=h+=-1)l=o[e].key,indexOf.call(i,l)>=0&&o.splice(e,1);else t.splice(f,1),n>f&&n--;break;case"move":case"scale":case"rotate":case"lock":r.keys.removeItems(i);r.keys.length||(t.splice(f,1),n>f&&n--);break;case"text":a=r.key;indexOf.call(i,a)>=0&&(t.splice(f,1),n>f&&n--)}u()},undoAfter:function(i){for(;n>0&&t[n-1].time>i;)e();t.length=n;u()},undo:e=function(){var r,o,s,l,a,f,h,c,i;if(n){switch(i=t[--n],r=idroo.board,i.type){case"create":r.deleteObjects(i.keys);break;case"delete":for(h=i.objects,o=0,l=h.length;l>o;o++)f=h[o],r.addObject(f.key,DrawObject.restore(f.data));break;case"move":r.moveObjects(i.keys,-i.dx,-i.dy);break;case"scale":r.scaleObjects(i.keys,i.to,i.from);break;case"rotate":r.rotateObjects(i.keys,i.center,i.to,i.from);break;case"style":for(c=i.objects,s=0,a=c.length;a>s;s++)f=c[s],r.changeObjectStyle(f.key,f.style);break;case"text":r.changeObjectText(i.key,i.oldState);break;case"lock":r.setLockObjects(i.keys,!i.lock)}n&&t[n-1].link?e():(u(),r.updateToolbars())}},redo:s=function(){var r,f,h,e,o,i;if(n<t.length){switch(i=t[n++],r=idroo.board,i.type){case"create":for(o=i.objects,f=0,h=o.length;h>f;f++)e=o[f],r.addObject(e.key,DrawObject.restore(e.data));break;case"delete":r.deleteObjects(i.keys);break;case"move":r.moveObjects(i.keys,i.dx,i.dy);break;case"scale":r.scaleObjects(i.keys,i.from,i.to);break;case"rotate":r.rotateObjects(i.keys,i.center,i.from,i.to);break;case"style":r.changeObjectsStyle(i.keys,i.style);break;case"text":r.changeObjectText(i.key,i.state);break;case"lock":r.setLockObjects(i.keys,i.lock)}i.link?s():(u(),r.updateToolbars())}},addCreate:o=function(n,t,u){var o,f,e,s;for(null==n&&(n=[]),null==t&&(t="create"),null==u&&(u=!1),o=idroo.board.objects,"string"==typeof n&&(n=[n]),f=0,s=n.length;s>f;f++)e=n[f],i.objects.push({key:e,data:o[e].serialize()});i.keys.push.apply(i.keys,n);u||(i.keys.length&&r(t,{keys:i.keys.slice(0),objects:i.objects.slice(0)}),i.keys.length=i.objects.length=0)},addDelete:function(n,t){return null==n&&(n=[]),null==t&&(t=!1),o(n,"delete",t)},addMove:function(n,t,i){if(t||i)return r("move",{keys:n.slice(0),dx:t,dy:i})},addScale:function(n,t,i){r("scale",{keys:n.slice(0),from:t.slice(0),to:i.slice(0)})},addRotate:function(n,t,i,u){r("rotate",{keys:n.slice(0),center:t.slice(0),from:i.slice(0),to:u.slice(0)})},fixScale:function(i,r){var u;n&&(0===n||n<t.length||(u=t[n-1],"scale"===u.type&&1===u.keys.length&&u.keys[0]===i&&(u.to=r.slice(0))))},addStyle:function(i,u){var a,o,h,v,y,l,e,s;if(s=(new Date).getTime(),n&&"style"===(e=t[n-1]).type&&s-e.time<200&&c(e,i,u))return e.time=s,e.style=f(u,u),void(t.length=n);for(l=[],a=idroo.board.objects,o=0,v=i.length;v>o;o++)h=i[o],y=a[h],l.push({key:h,style:f(u,y.style)});return r("style",{time:s,keys:i.slice(0),objects:l,style:f(u,u)})},addText:function(i,u,f){var e,o;return o=(new Date).getTime(),n&&"text"===(e=t[n-1]).type&&o-e.time<500?(e.time=o,e.state=f,void(t.length=n)):r("text",{time:o,key:i,oldState:u,state:f})},addLock:function(n){return r("lock",{keys:n.slice(0),lock:!0})},addUnlock:function(n){return r("lock",{keys:n.slice(0),lock:!1})}}}();idroo=this.idroo=this.idroo||{},function(){var n;return n={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"meta",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/"},idroo.utils={colorsEqual:function(n,t){return n.length===t.length&&n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},editorColor:function(n,t,i){return null==t&&(t=1),null==i&&(i=70),"hsla("+261*(n-1)%360+",80%,"+i+"%,"+t+")"},extractShortcut:function(t){var u,i,r;return r=n[t.which],u=String.fromCharCode(t.which).toLowerCase(),i="",t.altKey&&"alt"!==r&&(i+="alt+"),t.ctrlKey&&"ctrl"!==r&&(i+="ctrl+"),t.metaKey&&"meta"!==r&&(i+="meta+"),t.shiftKey&&"shift"!==r&&(i+="shift+"),i+(r||u)},dataURItoBlob:function(n){var l,r,u,f,o,s,h,c,t,e,i;for(e=n.split(","),h=e[0],f=e[1],i=h.match(/:([^;]*);?(.*)/),l=i[0],c=i[1],o=i[2],u="base64"===o?atob(f):unescape(f),t=u.length,r=new ArrayBuffer(t),s=new Uint8Array(r);t--;)s[t]=u.charCodeAt(t);return new Blob([r],{type:c})},formatTime:function(n){var i,r,t;return t=parseInt(n,10),i=Math.floor(t/3600),r=Math.floor(t%3600/60),t%=60,10>i&&(i="0"+i),10>r&&(r="0"+r),10>t&&(t="0"+t),i+":"+r+":"+t}}}();idroo=this.idroo=this.idroo||{};ui=this.idroo.ui=this.idroo.ui||{},function(){var n,t;return n=$("#ui"),t=".colorpicker.open, .select-button.open, #colorpicker, #context-menu, .menu-button",n.on("pointerdown",".select-button:not(.disabled)",function(){return ui.toggleDropdown(this),!1}),n.on("pointerdown",".select-button .items",!1),n.on("pointerup",".select-button .items .button",function(){var n,t;t=$(this);n=t.closest(".select-button");n.trigger("change",[t.data("value")]);n.removeClass("open")}),n.on("pointerdown",".menu-button",function(){return ui.toggleDropdown(this),!1}),n.on("click",".menu-button .menu .button",function(){$(this).closest(".menu-button").removeClass("open")}),n.on("pointerdown",".menu-button > .menu",function(n){n.stopPropagation()}),n.on("pointerdown",".select-button",function(n){n.stopPropagation()}),ui.closeDropdowns=function(){var n,i;return n=$(t),i=n.filter(".open").length,i&&n.trigger("close").removeClass("open"),i},ui.toggleDropdown=function(n){$(t).not(n).removeClass("open");$(n).toggleClass("open")},idroo.window.on("pointerdown",ui.closeDropdowns),n.on("click",".dialog-box .close.button",function(){return $(this).closest(".dialog-box").fadeOut()})}();$.fn.slider=function(){var f,e,r,o,i,s,h,u,n,c,l,t,a;return n=$(this),t=n.find(".track"),e=n.find(".handle"),r=0,a=0,c=0,i=n.data("min")||0,o=n.data("max")||100,l=n.data("step")||1,h=o-i,f=null,t.attr("touch-action","none").css("touch-action","none"),s=function(n){return MyMath.limit(i,o,i+l*Math.round(h/l*(n-c)/a))},n.set=u=function(t,r){return f===t?n:(f=t,n.attr("data-value",t),e.css({width:100*(t-i)/h+"%"}),r&&n.trigger("change",[t]),n)},t.on("pointerdown",function(i){i.preventDefault();this.setPointerCapture(i.originalEvent.pointerId);r=parseFloat(e.css("border-right-width"));a=t.width()-r;c=t.offset().left+r/2;u(s(i.pageX),!0);n.addClass("sliding")}),t.on("pointermove",function(t){t.preventDefault();n.is(".sliding")&&u(s(t.pageX),!0)}),t.on("pointerup",function(t){t.preventDefault();n.removeClass("sliding")}),u(parseFloat(n.data("value"))),n};$.fn.picker=function(){var i,f,s,e,t,h,n,v,c,r,l,o,u,a;return n=$(this),i=n.find(".area"),v=n.find(".pointer"),a=0,s=0,h=[parseInt(i.css("padding-left"),10),parseInt(i.css("padding-top"),10)],o=[0,0],t=n.data("min")||0,e=n.data("max")||100,u=n.data("step")||1,r=e-t,f=[null,null],n.attr("touch-action","none").css("touch-action","none"),c=function(n){return[MyMath.limit(t,e,t+u*Math.round(r/u*(n.pageX-o[0])/a)),MyMath.limit(t,e,t+u*Math.round(r/u*(n.pageY-o[1])/s))]},n.set=l=function(i,u){return f[0]===i[0]&&f[1]===i[1]?n:(f=i,v.css({left:100*(i[0]-t)/r+"%",top:100*(i[1]-t)/r+"%"}),u&&n.trigger("change",i.slice()),n)},n.on("pointerdown",function(t){var r;t.preventDefault();this.setPointerCapture(t.originalEvent.pointerId);a=i.innerWidth();s=i.innerHeight();r=i.offset();o=[r.left+h[0],r.top+h[1]];l(c(t),!0);n.addClass("sliding")}),n.on("pointermove",function(t){t.preventDefault();n.is(".sliding")&&l(c(t),!0)}),n.on("pointerup",function(t){t.preventDefault();n.removeClass("sliding")}),n};idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.colorpicker=function(){var i,s,u,f,r,e,n,t,h,c,y,l,a,o,v;return t=$("#colorpicker"),r=$(".close",t),y=$("#colorpicker-picker-color"),l=$("#colorpicker-preview"),c=$("#colorpicker-picker").picker(),h=$("#colorpicker-hue").slider(),s=$("#colorpicker-alpha").slider(),n=[0,100,50],i=100,f=null,e=null,r=function(){return e&&e(),f=null,e=null,t.detach()},t.on("pointerdown",function(n){return n.stopPropagation()}),t.on("click",".icon-close",r),l.on("click",r),t.on("dblclick",r),t.on("close",r),t.on("click",".color",function(){a($(this).data("color").slice(),100);u()}),u=function(){if(f)return f(n.slice(),i)},v=function(){return y.css("background-color","hsl("+n[0]+",100%,50%)")},o=function(){return s.css("background-color",DrawObject.makeColor(n)),l.css("background-color",DrawObject.makeColor(n,i))},c.on("change",function(t,i,r){return n[1]=Math.round(i),n[2]=Math.round(100-r),o(),u()}),h.on("change",function(t,i){return n[0]=i,v(),o(),u()}),s.on("change",function(n,t){return i=t,o(),u()}),a=function(t,r){null==r&&(r=100);n=t;i=r;h.set(n[0]);s.set(i);c.set([n[1],100-n[2]]);v();o()},{pick:function(n,i,r,u){f=u.change;e=u.close;a(i,r);t.insertAfter(n);t.addClass("open")}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.progressbar=function(){var t,n,r,i;return n=$('<div class="progress">'),r=$('<div class="text">'),t=$('<div class="bar">'),i=$('<div class="value">'),t.append(i),n.append(r),n.append(t),n.setState=function(n,u){null!=u?(t.removeClass("spin"),i.css("width",100*u+"%")):(t.addClass("spin"),i.css("width",""));r.text(n)},n.done=function(){n.trigger("done")},n};slice=[].slice;idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var it,o,l,k,s,t,r,a,v,n,rt,i,u,y,f,p,w,d,g,h,b,nt,tt,c,e;return it=2,y=$("aside .file-list"),v=$("#documents .list-scroller, #images .list-scroller"),r=$("#documents-list"),l=$("#document-pages"),u=$("#images-list"),s=$("#document"),k=$("#document h2"),c=$("#upload-queue"),nt=$("#documents .file-upload-button, #images .file-upload-button"),b=$("#documents .button.icon-trash, #images .button.icon-trash"),rt=/^image/,n=null,t=[],i=[],e={},y.on("dragstart",".file",function(n){var t,i;t=$(this);t.closest(".drop-target").addClass("disabled");t.addClass("dragging");i=n.originalEvent.dataTransfer;t.data("allowFit")?i.setData("text","idroo:fit:"+t.data("image")):i.setData("text","idroo:"+t.data("image"))}),y.on("dragend",".file",function(){var n;n=$(this);n.closest(".drop-target").removeClass("disabled");n.removeClass("dragging")}),nt.on("change","input",function(n){var r,t,u,i;for(i=n.target.files,t=0,u=i.length;u>t;t++)r=i[t],a(r)}),v.on("dragenter dragover",function(n){return n.preventDefault()}),v.on("drop",function(t){var r,i,u;if(n=t.originalEvent.dataTransfer.files)for(i=0,u=n.length;u>i;i++)r=n[i],a(r)}),b.on("dragenter dragover",function(n){return n.preventDefault()}),b.on("drop",function(r){var f,u,e,o,s;(s=r.originalEvent.dataTransfer.getData("text"))&&(o=s.match(/^idroo:(?:fit:)?\/doc\/(.*)\//))&&(u=o[1],f=$("#doc-"+u),e=f.closest("#images").length,f.remove(),delete n[u],t=t.filter(function(n){return n.id!==u}),i=i.filter(function(n){return n.id!==u}),e&&h(),$.post("/drawer/trash/"+u))}),r.on("click",".file.document",function(){w($(this).data("file"))}),s.on("click",".icon-back",function(){s.removeClass("active")}),a=function(n){var t;t=tt(n,function(n,t){return n?alert(n):p(t)});t.appendTo(c.show());t.on("done",function(){return t.remove(),c.children().length?void 0:c.hide()})},o=function(r){r.id in n||(n[r.id]=r,r.isImage?i.push(r):t.push(r))},f=function(t){return n?t():(n={},void $.getJSON("/drawer/docs",function(n){for(var r,i=0,u=n.length;u>i;i++)r=n[i],o(r);return t()}))},g=function(){var t,e,n,r,f,o;for(u.empty(),i.length&&u.siblings(".empty-list").remove(),e=[],f=0,o=i.length;o>f;f++)n=i[f],r=$("<img>"),r.attr("src","/doc/"+n.id+"/0/thumb"),r.on("load",h),t=$('<div class="list-item image file" id="doc-'+n.id+'" draggable="true">'),$('<div class="image">').append(r).appendTo(t),$('<div class="name">').text(n.name).appendTo(t),t.data({file:n,image:"/doc/"+n.id+"/0",allowFit:!0}),e.push(t);u.append(e);h()},d=function(){var i,n,f,u,e;for(r.empty(),t.length&&r.siblings(".empty-list").remove(),u=0,e=t.length;e>u;u++)n=t[u],f=$("<img>"),f.attr("src","/doc/"+n.id+"/0/thumb"),i=$('<div class="list-item document file" id="doc-'+n.id+'" draggable="true">'),$('<div class="image">').append(f).appendTo(i),$('<div class="name">').text(n.name).appendTo(i),n.pages>1&&$('<div class="pages">').text(n.pages+" pages").appendTo(i),i.data({file:n,image:"/doc/"+n.id+"/0"}),i.appendTo(r)},w=function(n){var t,i,f,r,u;for(l.empty(),s.addClass("active"),k.text(n.name),i=r=0,u=n.pages;u>=0?u>r:r>u;i=u>=0?++r:--r)f=$("<img>"),f.attr("src","/doc/"+n.id+"/"+i+"/thumb"),t=$('<div class="list-item file page" draggable="true">'),$('<div class="image">').append(f).appendTo(t),$('<div class="name">').text(i+1).appendTo(t),t.data("image","/doc/"+n.id+"/"+i),t.appendTo(l)},h=_.throttle(function(){var n,t;n=0;t=0;u.children().removeClass("right").each(function(){var r,i;return i=$(this),r=i.height()+parseInt(i.css("margin-bottom"),10),n>t?(i.addClass("right"),t+=r):n+=r})},200),p=function(n){n.isImage?ui.aside.openSection("images"):ui.aside.openSection("documents",function(){return w(n)})},idroo.drawer={openDocument:function(n){p(n)},uploadFile:tt=function(n,t){var s,i,h,r,u;if(s=!1,i=function(){var n;return n=1<=arguments.length?slice.call(arguments,0):[],s?void 0:(s=!0,t.apply(null,n))},"string"==typeof n)try{n=idroo.utils.dataURItoBlob(n)}catch(c){return h=c,void setTimeout(function(){return i("Unsupported file")},0)}return r=ui.progressbar(),u=new FileReader,u.addEventListener("progress",function(n){r.setState("Reading file",n.loaded/n.total)}),u.addEventListener("loadend",function(t){var u,s;return s=(new Rusha).digestFromBuffer,u=s(t.target.result),null!=e[u]?(r.done(),i("DUPLICATE")):(e[u]=!0,void $.getJSON("/docinfo/"+u,{add:!0,name:n.name},function(t){var h,c,l,a,s;return t?(t.success?(h=t.document,f(function(){return o(h)}),i(null,h)):i(t.error),r.done(),void delete e[u]):(s=new XMLHttpRequest,s.upload.addEventListener("progress",function(n){n.lengthComputable&&(n.loaded===n.total?r.setState("Processing"):r.setState("Uploading",n.loaded/n.total))},!1),s.onload=function(){t=JSON.parse(s.responseText);t.success?200===s.status?(h=t.document,f(function(){return o(h)}),i(null,h)):i("Upload failed for unknown reason"):i(t.error);r.done();delete e[u]},s.open("POST","/doc"),l=null!=(a=n.name)?a:"Pasted "+(n.type.match(/^image/)?"image":"file"),c=new FormData,c.append("file",n,l),void s.send(c))}))}),u.readAsArrayBuffer(n),r}},ui.documents={open:function(n){f(function(){return d(),"function"==typeof n?n():void 0})}},ui.images={open:function(n){f(function(){return g(),"function"==typeof n?n():void 0})}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.sharing=function(){var i,f,t,e,r,u,o,n;return e=$("#sharing"),i=$("#board-access"),f=$("#board-link"),t=$("#board-users"),o=$("#board-user-template").detach().removeAttr("id"),n={},i.on("click",".button",function(){idroo.board.setAccess($(this).data("level"))}),f.on("focus click pointerup",function(){return this.select(),!1}),t.on("click",".rights .button",function(){var n;n=$(this);idroo.board.grantAccess(n.closest(".user").data("id"),n.data("level"))}),u=function(){var i,u;t.empty();for(i in n)u=n[i],r(i,u)},r=function(n,i){var r,u;i.listItem=r=o.clone();r.data("id",n);r.find(".name").text(i.name);i.picture&&r.find(".user-image").css("background-image","url("+i.picture+")");u=r.find(".rights");u.attr("data-value",u.find('[data-level="'+i.level+'"]').text());"own"!==i.level&&n!==idroo.board.userId||u.addClass("disabled");r.appendTo(t)},{setAccess:function(n){i.attr("data-value",i.find('[data-level="'+n+'"]').text())},setUsers:function(t){n=t;e.is(".active")&&u()},addUser:function(i){n[i.id]||(t.is(":visible")&&r(i.id,i),n[i.id]=i)},removeUser:function(t){var i,r;(r=n[t])&&(null!=(i=r.listItem)&&i.remove(),delete n[t])},setUserAccess:function(t,i){var u,r;(r=n[t])&&(r.level=i,r.listItem&&(u=r.listItem.find(".rights"),u.attr("data-value",u.find('[data-level="'+i+'"]').text())))},open:function(n){u();"function"==typeof n&&n()}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.settings=function(){var n,i,t,r;return i=$("#settings"),n=$("#backgrounds"),r={},n.on("click",".background-style",function(){var n;n=$(this).data("background");t(n);idroo.board.changeBackground(n)}),{selectBackground:t=function(t){n.find('.background-style[data-background="'+t+'"]').addClass("active").siblings().removeClass("active")},open:function(n){"function"==typeof n&&n()}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.tutorads=function(){return;var n,t,i,r}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var v,t,r,h,u,f,c,s,e,l,i,n,o,a;for(v=$("#ui"),l={stroke:i={toolbar:$("#stroke-toolbar"),color:$("#stroke-color-button"),picker:$("#stroke-color-picker"),width:$("#stroke-width-slider").slider()},fill:r={toolbar:$("#fill-toolbar"),color:$("#fill-color-button"),picker:$("#fill-color-picker")},text:n={toolbar:$("#text-toolbar"),color:$("#text-color-button"),picker:$("#text-color-picker"),size:$("#text-size-slider").slider(),font:$("#text-font-button")},formula:u={toolbar:$("#formula-toolbar"),color:$("#formula-color-button"),picker:$("#formula-color-picker")}},i.width.on("change",function(n,i){return t({strokeWidth:i})}),n.size.on("change",function(n,i){return t({textSize:i})}),n.font.on("change",function(n,i){return t({font:i})}),s=["stroke","fill","text","formula"],h=function(n){var e,i,u,r,f;return f=l[n],e=f.color,i=f.picker,r=n+"Color",u=n+"Alpha",e.on("pointerdown",function(){return ui.toggleDropdown(i),!1}),i.on("pointerup",".colorwheel",function(f){return f.stopImmediatePropagation(),ui.colorpicker.pick(i,idroo.style[r],idroo.style[u],{change:function(i,f){var e;return e={},0===f?e[n]=!1:(idroo.style[n]===!1&&(e[n]=!0),e[r]=i,e[u]=f),t(e)},close:function(){return i.removeClass("open"),idroo.board.focusInput()}}),i.removeClass("open")}),i.on("pointerup",".color-button",function(){var f,u;f=$(this);u={};f.is(".off")?u[n]=!1:(idroo.style[n]===!1&&(u[n]=!0),u[r]=f.data("color"));t(u);i.removeClass("open")}),i.on("pointerdown",function(n){return n.stopPropagation()})},f=0,c=s.length;c>f;f++)o=s[f],h(o);return e=function(t){$.extend(!0,idroo.style,t);null!=t.strokeWidth&&i.width.set(t.strokeWidth);null!=t.strokeColor&&i.color.css("background-color",DrawObject.makeColor(t.strokeColor,idroo.style.strokeAlpha));null!=t.strokeAlpha&&i.color.css("background-color",DrawObject.makeColor(idroo.style.strokeColor,t.strokeAlpha));null!=t.stroke&&i.color.toggleClass("off",!t.stroke);null!=t.fillColor&&r.color.css("background-color",DrawObject.makeColor(t.fillColor,idroo.style.fillAlpha));null!=t.fillAlpha&&r.color.css("background-color",DrawObject.makeColor(idroo.style.fillColor,t.fillAlpha));null!=t.fill&&r.color.toggleClass("off",!t.fill);null!=t.font&&(n.font.css("font-family","tahoma"),n.font.attr("data-value","tahoma"));null!=t.textSize&&n.size.set(t.textSize);null!=t.textColor&&n.color.css("background-color",DrawObject.makeColor(t.textColor,idroo.style.textAlpha));null!=t.textAlpha&&n.color.css("background-color",DrawObject.makeColor(idroo.style.textColor,t.textAlpha));null!=t.formulaColor&&u.color.css("background-color",DrawObject.makeColor(t.formulaColor,idroo.style.formulaAlpha));null!=t.formulaAlpha&&u.color.css("background-color",DrawObject.makeColor(idroo.style.formulaColor,t.formulaAlpha))},t=function(n){e(n);idroo.board.applyStyle(n);idroo.board.focusInput()},a=function(t){null==t&&(t={});"string"==typeof(o=t)&&(t={},t[o]=1);i.toolbar.toggleClass("enabled",!!(t.Freehand||t.Line||t.Rectangle||t.Ellipse||t.Text||t.Image||t.Formula));r.toolbar.toggleClass("enabled",!!(t.Freehand||t.Rectangle||t.Ellipse||t.Text||t.Image||t.Formula));n.toolbar.toggleClass("enabled",!!t.Text);u.toolbar.toggleClass("enabled",!!t.Formula)},e(DrawObject.defaultStyle),ui.style={apply:t,set:e,types:a,toggleFormulaButtons:function(n){return u.toolbar.find(".formula-select").toggle(n)}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var i,c,n,t,e,r,u,o,f,s,h;return i=$("#ui"),o=$("#toolbar"),c=$("aside"),n=$("#board-title input"),f=$("#zoom"),s=$("#zoom-in"),h=$("#zoom-out"),u=$("#saving-box"),e=$("#download-box"),t=o.find(".button[data-action]"),t.on("click",function(){var n;n=$(this);idroo.action=n.data("action");idroo.objectType=n.data("type");n.addClass("active");t.not(this).removeClass("active");idroo.board.releaseAll();idroo.board.setCursor();idroo.board.focusInput()}),$("#menu-clean-board").on("click",function(){return idroo.board.deleteAll()}),r=function(){return idroo.board.changeTitle(n.val())},n.on("blur",r),n.on("keydown",function(n){"return"===idroo.utils.extractShortcut(n)&&(r(),this.blur(),idroo.board.focusInput())}),$("#undo-button").on("click",function(){idroo.history.undo();idroo.board.focusInput()}),$("#redo-button").on("click",function(){idroo.history.redo();idroo.board.focusInput()}),f.on("click",function(){return idroo.board.zoomTo(0,idroo.board.width/2,idroo.board.height/2)}),s.on("click",function(){return idroo.board.zoomBy(-.5,idroo.board.width/2,idroo.board.height/2)}),h.on("click",function(){return idroo.board.zoomBy(.5,idroo.board.width/2,idroo.board.height/2)}),i.on("click",".save-and-download",function(){return u.fadeIn(),idroo.board.save(function(){return u.fadeOut(),e.fadeIn()}),!1}),ui.toolbar={setLevel:function(t){i.attr("class",t);n.attr("disabled","own"!==t);idroo.board.refresh()},selectTool:function(n){t.filter('[data-name="'+n+'"]').click()},setTitle:function(t){n.val(t)},setZoom:function(n){f.attr("data-value",(100*n).toFixed(0))}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var t,i,r,u,f,e,o,s,n,h,c,l,a,v,y,p,w;return w=$("#formula-toolbar"),l=function(n){var t;return t=$("<div>",{"class":"button select-button formula-select",text:n}),t.appendTo(w)},c=function(n){var t;return t=new DrawFormula(0,0,{stroke:!1,fill:!1,formulaColor:[0,100,100]}),t.insertText(n),t.measure(),t.rebound(),$("<img>",{src:t.toDataURL()})},h=function(n){var i,f,r,e,t,o,u;return"string"!=typeof n&&(t=n,n=t[0],e=t[1],f=null!=(o=t[2])?o:0),(r=n.match(/(.*)\ :\ (.*)/))?(n=r[1],u=r[2]):u=n,i=$("<div>",{"class":"button",title:n}),i.on("click",function(){return idroo.board.formulaInsert(n,e,f),idroo.board.focusInput()}),i.append(c(u))},a=["+","−","\\times ","\\cdot ","\\div ","\\sdivide ","\\setminus ",null,"\\pm ","\\mp ","\\odot ","\\ominus ","\\oplus ","\\oslash ","\\otimes ",null,"\\emptyset ","\\exists ","\\forall ","\\inc ","\\nabla ","\\partial ","\\neg ",null,"\\therefore ","\\because ","\\ddots ","\\rddots ","\\vdots ","\\cdots ",null,"\\bot ","\\top ","\\dashv ","\\vdash ","\\models ","\\mid ","\\parallel "],y=["\\cap ","\\cup ","\\sqcap ","\\sqcup ","\\uplus ","\\vee ","\\wedge ","\\mapsto ",null,"\\subset ","\\superset ","\\in ","\\ni ","\\sqsubseteq ","\\sqsuperseteq ","\\subseteq ","\\superseteq "],v=["=","\\ne ","\\approx ","\\equiv ","\\cong ","\\doteq ","\\simeq ","\\sim ","\\asymp ","\\propto ",null,"<",">","\\le ","\\ge ","\\ll ","\\gg ","\\prec ","\\succ ","\\preceq ","\\succeq "],r=["\\to ","\\nwarrow ","\\uparrow ","\\nearrow ","\\Uparrow ","\\Rightarrow ",null,"\\gets ","\\swarrow ","\\downarrow ","\\searrow ","\\Downarrow ","\\Leftarrow ",null,"\\hookrightarrow ","\\rightharpoondown ","\\rightharpoonup ","\\leftrightarrow ","\\updownarrow ",null,"\\hookleftarrow ","\\leftharpoondown ","\\leftharpoonup ","\\Leftrightarrow ","\\Updownarrow "],f=[["\\sum ",-1],["\\int ",-1],["\\iint ",-1],["\\iiint ",-1],["\\iiiint ",-1],null,["\\oint ",-1],["\\oiint ",-1],["\\oiiint ",-1],["\\amalg ",-1],["\\prod ",-1]],s=["\\alpha ","\\beta ","\\delta ","\\gamma ","\\epsilon ","\\zeta ","\\eta ","\\theta ",null,"\\iota ","\\kappa ","\\lambda ","\\mu ","\\nu ","\\xi ","\\omicron ","\\pi ",null,"\\rho ","\\sigma ","\\tau ","\\upsilon ","\\phi ","\\chi ","\\psi ","\\omega ",null,"\\Alpha ","\\Beta ","\\Delta ","\\Gamma ","\\Epsilon ","\\Zeta ","\\Eta ","\\Theta ",null,"\\Iota ","\\Kappa ","\\Lambda ","\\Mu ","\\Nu ","\\Xi ","\\Omicron ","\\Pi ",null,"\\Rho ","\\Sigma ","\\Tau ","\\Upsilon ","\\Phi ","\\Chi ","\\Psi ","\\Omega "],i=["\\A ","\\B ","\\C ","\\D ","\\E ","\\F ","\\G ",null,"\\H ","\\I ","\\J ","\\K ","\\L ","\\M ","\\N ",null,"\\O ","\\P ","\\Q ","\\R ","\\S ","\\T ","\\U ",null,"\\V ","\\W ","\\X ","\\Y ","\\Z "],p=["\\ast ","\\circ ","\\diamond ","\\star ","\\bowtie ","\\infty ",null,"\\euler ","\\ohm ","\\ell ","\\hbar ","\\imath ","\\jmath ",null,"\\aleph ","\\beth ","\\daleth ","\\gimel ","\\Im ","\\Re ","\\wp ",null,"\\angle ","\\degree ","\\overbar ","\\prime ","\\pprime ","\\ppprime ",null,"\\wr ","\\atop ","\\rect ","\\underbar ","\\vbar ","\\Vert "],o=[["\\log ",-1],["\\ln ",-1],["\\lim ",-1],["\\min ",-1],["\\max ",-1],null,["\\sin ",-1],["\\cos ",-1],["\\tan ",-1],["\\sinh ",-1],["\\cosh ",-1],["\\tanh ",-1],null,["\\csc ",-1],["\\sec ",-1],["\\cot ",-1],["\\csch ",-1],["\\sech ",-1],["\\coth ",-1],null,["\\arcsin ",-1],["\\arccos ",-1],["\\arctan ",-1],null,["\\deg ",-1],["\\dim ",-1],["\\gcd ",-1],["\\Pr ",-1],null,["\\inf ",-1],["\\sup ",-1],["\\liminf ",-1],["\\limsup ",-1],["\\ker ",-1]],t=["\\acute  : \\ensp \\acute ","\\bar  : \\ensp \\bar ","\\Bar  : \\ensp \\Bar ","\\breve  : \\ensp \\breve ","\\check  : \\ensp \\check ",null,"\\ddddot  : \\ensp \\ddddot ","\\dddot  : \\ensp \\dddot ","\\ddot  : \\ensp \\ddot ","\\dot  : \\ensp \\dot ","\\grave  : \\ensp \\grave ",null,"\\hat  : \\ensp \\hat ","\\hvec  : \\ensp \\hvec ","\\tvec  : \\ensp \\tvec ","\\vec  : \\ensp \\vec ","\\tilde  : \\ensp \\tilde "],e=[["/ : a/b",-2,1],["^ : x^...",-2,1],["_ : x_...",-2,1],null,["\\sqrt  : \\sqrt ...",-1],["\\above  : x\\above ...",-3,1],["\\below  : x\\below ...",-3,2]],u=[["() : (...)",-1],["{} : {...}",-1],["[] : [...]",-1],null,["\\bra \\ket  : \\bra ...\\ket ",-1],["\\lceil \\rceil  : \\lceil ...\\rceil ",-1],["\\lfloor \\rfloor  : \\lfloor ...\\rfloor ",-1]],n=function(n,t,i){var f,e,r,u,o;for(null==i&&(i=function(n){return n}),e=l(n),u=$("<div>",{"class":"items"}),r=0,o=t.length;o>r;r++)f=t[r],null!=f?h(f,i).appendTo(u):u.append("<br>");u.appendTo(e)},Fonts.afterLoaded("IDroo Math",function(){n("±",a);n("≅",v);n("∈",y);n("↗",r);n("²",e);n("( )",u);n("∑",f);n("()",o);n("Ψ",s);n("ℕ",i);n("ℵ",p);n(" ̃",t)})}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.contextmenu=function(){var t,n,i,r;return n=$("#context-menu"),t={},n.find(".button").each(function(){var n;n=$(this);t[n.data("name")]=n}),r=$("#context-menu-ordering .button"),i=$("#context-menu-locking"),n.on("contextmenu",!1),n.on("pointerdown",function(n){n.stopPropagation()}),$(window).on("pointerdown",function(){n.removeClass("open")}),n.on("pointerup",".button",function(t){switch(idroo.board.focusInput(),$(t.target).data("name")){case"group":idroo.board.groupSelected();break;case"ungroup":idroo.board.ungroupSelected();break;case"bringfront":idroo.board.bringSelectedToFront();break;case"sendback":idroo.board.sendSelectedToBack();break;case"moveforward":idroo.board.moveSelectedForward();break;case"movebackward":idroo.board.moveSelectedBackward();break;case"delete":idroo.board.deleteSelected();break;case"lock":idroo.board.lockSelected();break;case"unlock":idroo.board.unlockSelected()}n.removeClass("open")}),{open:function(u,f,e,o){var a,s,h,c,v,l;s=e.length>0;r.toggleClass("disabled",!s);t["delete"].toggleClass("disabled",!s);a=o.length>1;v=e.indexOf("Group")>=0;t.group.toggleClass("disabled",!a);t.ungroup.toggleClass("disabled",!v);i.toggle(s);o.length&&(c=idroo.board.objects[o[0]].locked,t.lock.toggle(!c),t.unlock.toggle(c));n.css({left:u,top:f});n.addClass("open");l=n.outerWidth();h=n.outerHeight();l+u>idroo.window.width()&&n.css({left:u-l});h+f>idroo.window.height()&&n.css({top:f-h})}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.chat=function(){var o,r,s,u,n,t,f,i,e;return s=$("#chat"),r=$('aside .button[data-section="chat"]'),t=$("#chat-messages"),n=$("#chat-message"),u=null,e=0,n.on("keydown keyup",function(n){n.stopPropagation()}),n.on("keypress",function(t){var i;if(13===t.which)return((i=n.val())&&idroo.board.sendChat(i),n.val(""),!1)}),n.on("focus",function(){idroo.board.endTextInput()}),f=function(){t.prop("scrollTop",t.prop("scrollHeight"))},i=function(n){null==n&&(n=e+1);r.is(".active")&&(n=0);r.attr("data-unread-messages",n||"");e=n},{add:o=function(n){var r,s,e,o;e=n;o=e.uid;s=e.name;n=e.message;r=$('<div class="message"><\/div>');u!==o&&r.append($('<div class="name"><\/div>').text(s));r.append($('<div class="text"><\/div>').text(n));t.append(r);u=o;f();i()},init:function(n){for(var u,t=0,r=n.length;r>t;t++)u=n[t],o(u);i(0)},open:function(t){f();n.focus();"function"==typeof t&&t();i(0)},blur:function(){return n.blur()}}}();idroo=this.idroo=this.idroo||{},function(){var t,i,n,r,f,u;return u=idroo.ui=idroo.ui||{},t=$("aside"),i=t.children("section"),n=t.children(".toolbar"),n.on("click",".button[data-section]",function(){return f($(this).data("section"))}),t.on("click",".close",function(){return $(this).closest("section").removeClass("active"),n.find(".button.active").removeClass("active")}),f=function(t){var u,i;i=n.find('.button[data-section="'+t+'"]');u="#"+t;i.is(".active")?(i.removeClass("active"),$(u).removeClass("active")):r(t)},u.aside={elem:t,openSection:r=function(t,r){var e,f,o;o=n.find('.button[data-section="'+t+'"]');f=$("#"+t);f.length&&(o.addClass("active").siblings().removeClass("active"),i.not(f).removeClass("active"),f.addClass("active"),null!=(e=u[t])&&e.open(r))},setLevel:function(t){"own"!==t&&"edit"!==t&&($("#chat,#guest-info").is(":visible")||(i.removeClass("active"),n.find(".button").removeClass("active")));"own"===t&&r("sharing")}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var n,i,t;return n=$("#editors"),ui.editors={add:i=function(i){t(i.nr);n.append($("<div>",{"class":"button user-button",id:"editor-"+i.nr,title:i.name,css:{backgroundImage:i.pic?"url("+i.pic+")":"",borderColor:idroo.utils.editorColor(i.nr)}}))},remove:t=function(n){return $("#editor-"+n).remove()}}}();indexOf=[].indexOf||function(n){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===n)return t;return-1};idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var r,u,f,t,e,i,o,s,n,h,c;return t=$(document),h=null,i=null,r=/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*)\s*$/i,c=function(n){return window.btoa(unescape(encodeURIComponent(n)))},u=function(n){return decodeURIComponent(escape(window.atob(n)))},o=function(n){return function(t,r){var f,u;if(null!=(null!=n&&null!=(u=n.clipboardData)?u.setData:void 0))try{n.clipboardData.setData(t,r)}catch(e){f=e;n.clipboardData.setData("text/plain","idroo:"+t+":"+c(r))}else i={type:t,data:r}}},n=function(n){return n.match(r)?void idroo.board.insertUploadFile(n):void idroo.board.pasteText(n)},s=function(t){var e,nt,o,f,s,h,c,w,b,k,d,a,v,y,g,p,l;if(null!=t?t.clipboardData:void 0){if(null!=t.clipboardData.items){for(a=t.clipboardData.items,o=0,w=a.length;w>o;o++)if(f=a[o],"file"===f.kind)return idroo.board.insertUploadFile(f.getAsFile()),!1;for(v=t.clipboardData.items,s=0,b=v.length;b>s;s++)if(f=v[s],"string"===f.kind){if("idroo/objects"===f.type)return f.getAsString(function(){return function(n){return idroo.board.pasteObjects(AJson.parse(n))}}(this)),!1;if("idroo/formula"===f.type)return f.getAsString(function(){return function(n){return idroo.board.pasteFormula(AJson.parse(n))}}(this)),!1}for(y=t.clipboardData.items,h=0,k=y.length;k>h;h++)if(f=y[h],"string"===f.kind&&"text/plain"===f.type)return f.getAsString(function(){return function(t){var i,f,r;if(!(r=t.match(/^idroo:(idroo\/(?:objects|formula)|text\/plain):(.*)$/)))return n(t);try{switch(i=u(r[2]),r[1]){case"idroo/objects":return idroo.board.pasteObjects(AJson.parse(i));case"idroo/formula":return idroo.board.pasteFormula(AJson.parse(i));case"text/plain":return n(i)}}catch(e){return f=e,n(t)}}}(this)),!1}if(null!=(g=t.clipboardData.files)?g.length:void 0){for(p=t.clipboardData.files,c=0,d=p.length;d>c;c++)nt=p[c],idroo.board.insertUploadFile(f.getAsFile());return!1}return l=t.clipboardData.types,indexOf.call(l,"idroo/objects")>=0?idroo.board.pasteObjects(AJson.parse(t.clipboardData.getData("idroo/objects"))):indexOf.call(l,"idroo/formula")>=0?idroo.board.pasteFormula(AJson.parse(t.clipboardData.getData("idroo/formula"))):indexOf.call(l,"text/plain")>=0&&n(t.clipboardData.getData("text/plain")),!1}if(i){switch(e=i.data,i.type){case"idroo/objects":idroo.board.pasteObjects(AJson.parse(e));break;case"idroo/formula":idroo.board.pasteFormula(AJson.parse(e));break;case"text/plain":n(e)}return!1}setTimeout(function(){var f,u,t,e,i;if(!(t=idroo.board.input.find("img"))||!t.length)return n(idroo.board.input.text()),idroo.board.input.empty();for(i=0,e=t.length;e>i;i++)if(u=t[i],u.src.match(r))try{idroo.board.insertUploadFile(u.src)}catch(o){f=o;console.log(f)}finally{idroo.board.input.empty()}},20)},e=function(){t.on("paste.idroo-clipboard",function(n){return s(n.originalEvent)});t.on("copy.idroo-clipboard cut.idroo-clipboard",function(n){return idroo.board.copy(o(n.originalEvent),"cut"===n.type)});t.on("cut.idroo-clipboard copy.idroo-clipboard paste.idroo-clipboard",":input",function(n){n.stopPropagation()})},f=function(){t.off(".idroo-clipboard")},ui.clipboard={setLevel:function(n){h!==n&&("edit"===n||"own"===n?e():f())}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var f,e,o,s,t,n,r,h,u,i;return h=null,n={alt:!1,ctrl:!1,meta:!1,shift:!1},u={p:"pointer",f:"freehand",l:"line",r:"rectangle",c:"ellipse",t:"text",e:"eraser",m:"hand",g:"formula"},t=!1,r="",s=function(){idroo.window.on("keydown.panning",function(){return function(n){32===n.which&&(n.preventDefault(),t||(t=!0,r=idroo.action,idroo.action="pan",idroo.board.setCursor()))}}(this));idroo.window.on("keyup.panning",function(){return function(n){32===n.which&&t&&(n.preventDefault(),t=!1,idroo.action=r,idroo.board.setCursor())}}(this))},e=function(){return idroo.window.off(".panning")},i=function(t){var r,i,u;return r=n.alt!==t.altKey||n.ctrl!==t.ctrlKey||n.meta!==t.metaKey||n.shift!==t.shiftKey,r?(n.alt=t.altKey,n.ctrl=t.ctrlKey,n.meta=t.metaKey,n.shift=t.shiftKey,idroo.board.active.isEmpty()||"draw"!==(i=idroo.board.action)&&"move"!==i&&"scale"!==i||idroo.board.handlePointerMove(),""!==(u=idroo.board.action)&&"select"!==u||idroo.board.highlight(),!0):void 0},o=function(){$("body").on("keydown keyup",":input:not(.allow-propagation)",function(n){n.stopPropagation()});idroo.window.on("keydown.board-editor",function(){return function(t){var r,f,e,o;if(r=idroo.board,i(t)&&(n.ctrl||n.meta||n.shift)&&idroo.board.focusInput(!0),16!==(e=t.which)&&17!==e&&18!==e){if(r.action)return!1;switch(f=n.shift?10:1,t.which){case 38:return r.moveSelected(0,-f),!1;case 40:return r.moveSelected(0,f),!1;case 37:return r.moveSelected(-f,0),!1;case 39:return r.moveSelected(f,0),!1}switch(o=idroo.utils.extractShortcut(t)){case"esc":return ui.closeDropdowns()||r.releaseAll(),!1;case"ctrl+a":case"meta+a":return r.selectAll(),!1;case"del":case"backspace":return r.deleteSelected(),!1;case"ctrl+z":case"meta+z":return idroo.history.undo(),!1;case"ctrl+shift+z":case"ctrl+y":case"meta+shift+z":case"meta+y":return idroo.history.redo(),!1;case"ctrl+c":case"ctrl+shift+c":case"ctrl+insert":case"meta+c":case"meta+shift+c":case"meta+insert":return;case"ctrl+x":case"meta+x":return;case"ctrl+v":case"ctrl+shift+v":case"shift+insert":case"meta+v":case"meta+shift+v":return;case"ctrl+g":case"meta+g":return r.groupSelected(),!1;case"ctrl+u":case"meta+u":return r.ungroupSelected(),!1}return!r.textActive&&o in u?(idroo.ui.toolbar.selectTool(u[o]),!1):void 0}}}(this));idroo.window.on("keyup.board-editor",function(){return function(n){i(n)}}(this))},f=function(){idroo.window.off("keydown.board-editor keyup.board-editor");$("body").off("keydown keyup",":input:not(.allow-propagation)")},ui.keyboard={modifiers:n,trackModifiers:i,setLevel:function(n){h!==n&&("none"===n?e():s(),"edit"===n||"own"===n?o():f())}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{},function(){var c,l,a,v,y,o,p,w,f,u,s,e,t,n,i,h,r;return y=300,v=500,o=10,l=800,a=8,c=500,p=.2,r=0,n=null,i=null,t=null,s=function(n){var t,i,r,u;return t=n.offsetX,i=n.offsetY,null!=t&&null!=i||(u=n.target||n.srcElement,r=u.getBoundingClientRect(),t=n.clientX-r.left,i=n.clientY-r.top),{offsetX:t,offsetY:i}},e=function(n){return function(t){var i,u,f,r;ui.keyboard.trackModifiers(t);i=t.originalEvent;r=s(i);u=r.offsetX;f=r.offsetY;n(i,u,f,(new Date).getTime())}},h=function(){t=requestAnimationFrame(function(){var i;i=(new Date).getTime();i-n.time<l?h():(t=null,idroo.board.contextmenu())})},u=function(){t&&(cancelAnimationFrame(t),t=null)},f=function(n,t,i){return Geometry.distanceFromPoint([n.x,n.y],[t,i])},w=function(n,t){return Geometry.distanceFromPoint([n.x,n.y],[t.x,t.y])},ui.pointer={fetchOffset:s,init:function(s){var tt,nt,b,d,l,k,g;tt=s[0];l=[];b=null;k=0;g=!1;nt=function(){return{x:(l[0].x+l[1].x)/2,y:(l[0].y+l[1].y)/2,distance:w(l[0],l[1])}};d=function(n){for(var i,u,t=i=0,r=l.length;r>i;t=++i)if(u=l[t],u.pointerId===n.pointerId)return l[t]=n,n.preventDefault(),!0;return!1};s.on({pointerdown:e(function(t,i,r,f){switch(t.preventDefault(),tt.setPointerCapture(t.pointerId),idroo.ui.chat.blur(),l.push(t),l.length>1&&u(),l.length){case 1:0===t.button&&idroo.board.pointerDown(i,r);"touch"===t.pointerType&&h();break;case 2:idroo.board.pointerUp();idroo.board.releaseAll();idroo.board.highlightOff();n&&f-n.time<c&&(idroo.history.undoAfter(n.time),b={},b.start=b.last=nt(),k=0,g=!1)}n={x:i,y:r,time:f}}),pointermove:e(function(i,r,e){var o,s,h;if(!l.length)return void idroo.board.pointerMove(r,e);if(d(i))switch(l.length){case 1:4===i.buttons?idroo.board.panTo(r,e):idroo.board.pointerMove(r,e);t&&f(n,r,e)>a&&u();break;case 2:b&&(o=nt(),s={x:o.x-b.last.x,y:o.y-b.last.y},idroo.board.panBy(s.x,s.y),h=Math.log(b.last.distance/o.distance)/Math.log(2),g?idroo.board.zoomBy(h,o.x,o.y):(k+=h,i.pointerId===l[1].pointerId&&Math.abs(k)>p&&Math.abs(o.distance-b.last.distance)>Geometry.v2Length([s.x,s.y])&&(idroo.board.zoomBy(k,o.x,o.y),g=!0)),b.last=o)}}),pointerup:e(function(t,e,s,h){if(d(t)){switch(l.length){case 1:idroo.board.pointerUp();u();f(n,e,s)<o&&h-n.time<y?(i&&f(i,e,s)<o&&h-i.time<v?(r++,2===r&&idroo.board.pointerDblAction(e,s)):r=1,i={x:e,y:s,time:h}):(r=0,i=null);break;case 2:b=null}l.length=0}}),pointercancel:function(t){d(t)&&(u(),l.length=0,n=i=null,r=0,b=null)}})}}}(),function(){var n,t;return t=0,n=$("body"),n.on("dragenter",function(){t||n.addClass("dragging");t++}),n.on("dragleave",function(){t--;t||n.removeClass("dragging")}),n.on("drop dragend",function(i){i.preventDefault();t=0;n.removeClass("dragging")})}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ConvPeerConnection=function(){function n(n){this.nr=n;this.pc=new RTCPeerConnection(r,i);this.pc.onicecandidate=function(n){return function(t){console.log("PC icecandidate");t.candidate&&idroo.board.socket.emit("phone","ice",n.nr,t.candidate)}}(this);this.pc.onaddstream=function(n){return function(t){console.log("PC addstream");n.audio=new Audio;n.audio.srcObject=t.stream;n.audio.play()}}(this);this.pc.onnegotiationneeded=function(n){return function(){return console.log("PC negotiationneeded"),n.createOffer()}}(this)}var i,t,r;return r={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun.services.mozilla.com"}]},i={optional:[]},t=function(n){return n.sdp=n.sdp.replace("UDP/TLS/RTP/SAVPF","RTP/SAVPF"),n},n.prototype.nr=null,n.prototype.pc=null,n.prototype.audio=null,n.prototype.offerer=null,n.prototype.close=function(){this.pc.close();this.pc.onicecandidate=null;this.pc.onaddstream=null;this.pc.onnegotiationneeded=null;this.pc=null;this.audio&&(this.audio.pause(),this.audio.srcObject=null,this.audio=null)},n.prototype.createOffer=function(){return console.log("PC.createOffer"),this.offerer===!1?(console.log("PS asking offerer for an offer"),void idroo.board.socket.emit("phone","refresh",this.nr)):(this.offerer=!0,"stable"!==this.pc.signalingState?void console.log("createOffer NOT STABLE, ABORT!"):void this.pc.createOffer().then(function(n){return function(i){return console.log("PC ... offer created"),i=t(i),n.pc.setLocalDescription(i),idroo.board.socket.emit("phone","offer",n.nr,i)}}(this))["catch"](function(n){return console.log(n.toString())}))},n.prototype.createAnswer=function(n){return console.log("PC.createAnswer"),this.offerer!==!0?(this.offerer=!1,"stable"!==this.pc.signalingState?void console.log("createAnswer NOT STABLE, ABORT!"):void this.pc.setRemoteDescription(n).then(function(n){return function(){return n.pc.createAnswer()}}(this)).then(function(n){return function(i){return console.log("PC ... answer created"),i=t(i),n.pc.setLocalDescription(i),idroo.board.socket.emit("phone","answer",n.nr,i)}}(this))["catch"](function(n){return console.log(n.toString())})):void 0},n.prototype.gotAnswer=function(n){console.log("PC.gotAnswer");this.pc.setRemoteDescription(n)},n.prototype.addIceCandidate=function(n){var t;console.log("PC.addIceCandidate");t=this.pc.addIceCandidate(new RTCIceCandidate(n));t&&t["catch"](function(n){return console.log(n)})},n.prototype.addStream=function(n){console.log("PC.addStream");this.pc.addStream(n)},n.prototype.setMute=function(n){this.audio.muted=n},n}();ConvCall=function(){function n(){this.pcs={}}return n.prototype.pcs=null,n.prototype.stream=null,n.prototype.onStart=null,n.prototype.onEnd=null,n.prototype.start=function(){this.getMediaStream()},n.prototype.getMediaStream=function(){return"function"==typeof this.onStart&&this.onStart(),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(n){return function(t){return n.setLocalStream(t),"function"==typeof cb?cb():void 0}}(this))["catch"](function(n){return function(t){return console.log(t),alert("Could not start call"),n.hangup()}}(this))},n.prototype.setLocalStream=function(n){var r,u,t,i;this.stream=n;n.addEventListener("ended",function(n){return function(t){return console.log(t),n.stream=null,n.hangup()}}(this));t=this.pcs;i=[];for(r in t)u=t[r],i.push(u.addStream(n));return i},n.prototype.add=function(n){var t;n in this.pcs||(this.pcs[n]=t=new ConvPeerConnection(n),this.stream&&t.addStream(this.stream))},n.prototype.offerHandler=function(n,t){this.stream||this.getMediaStream();this.add(n);this.pcs[n].createAnswer(t)},n.prototype.answerHandler=function(n,t){this.pcs[n].gotAnswer(t)},n.prototype.iceHandler=function(n,t){this.add(n);this.pcs[n].addIceCandidate(t)},n.prototype.hangupHandler=function(n){n?(n in this.pcs&&(this.pcs[n].close(),delete this.pcs[n]),0===Object.keys(this.pcs).length&&this.hangup()):this.hangup()},n.prototype.refreshHandler=function(n){n&&n in this.pcs&&this.pcs[n].createOffer()},n.prototype.openHandler=function(){},n.prototype.hangup=function(){var n,t,i=this.pcs;for(n in i)t=i[n],t.close(),delete this.pcs[n];this.pcs={};this.stream&&(this.stream.getTracks().forEach(function(){return function(){return function(n){return n.stop()}}}(this)),this.stream=null);"function"==typeof this.onEnd&&this.onEnd()},n.prototype.setMute=function(n){var t,i,r=this.pcs;for(t in r)i=r[t],i.setMute(n)},n}();ui.phone=function(){var o,t,n,s,u,h,f,i,e,r;return r={},n=new ConvCall,i=$("#phone"),t=$("#phone-call"),u=$("#phone-hangup"),h=$("#phone-info"),f=$("#phone-info-box"),h.on("click",function(){return ga("send","event","Phone","show-prompt",f.fadeIn())}),t.on("click",function(){return ga("send","event","Phone","call",o())}),u.on("click",function(){return ga("send","event","Phone","hangup",s())}),f.on("click",".get-premium",function(){return ga("send","event","Phone","get-premium"),thanksFree.hide()}),n.onStart=function(){u.removeClass("disabled").siblings().addClass("disabled")},n.onEnd=function(){t.removeClass("disabled").siblings().addClass("disabled")},e=function(){Object.keys(r).length>1?i.show():i.hide()},o=function(){var i,u,t,r;if(console.log("Calling..."),"chrome"!==(t=adapter.browserDetails.browser)&&"opera"!==t&&"firefox"!==t&&"safari"!==t)return void alert("Your browser is not supported at the moment");r=idroo.board.editors;for(u in r)i=r[u],i.nr!==idroo.board.editorNr&&n.add(i.nr);n.start()},s=function(){n.hangup();idroo.board.socket.emit("phone","hangup")},{handleMessage:function(i,r,u){if("ice"===i||"offer"===i||"answer"===i||"hangup"===i||"refresh"===i)return n[i+"Handler"](r,u);switch(i){case"open":return void t.removeClass("disabled").siblings().addClass("disabled")}},addUser:function(n){r[n.nr]=1;e()},removeUser:function(n){delete r[n.nr];e()},mute:function(){return n.setMute(!0)},play:function(){return n.setMute(!1)},setLevel:function(n){return i.toggleClass("disabled","own"!==n&&"edit"!==n)}}}();idroo=this.idroo=this.idroo||{};ui=idroo.ui=idroo.ui||{};ui.premiumPrompt=function(){var t,i,n;return t=3e5,n=$("#thanks-free"),n.on("click",".get-premium",function(){return ga("send","event","PremiumPrompt","get-premium"),n.hide()}),n.on("click",".close",function(){return ga("send","event","PremiumPrompt","close")}),i=function(){n.fadeIn();ga("send","event","PremiumPrompt","show",{nonInteraction:!0})},{delayShow:function(){return setTimeout(i,t)}}}();boardName="tV4Q8UGG9P";idroo.board=new Board(boardName,"#canvas");idroo.window.resize(function(){return idroo.board.refresh()});